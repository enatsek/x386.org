<!-- HTML Header Start -->
<!DOCTYPE html>
<html><head>
<title>x386.org: Debian and Ubuntu Documentation</title>
<meta charset="UTF-8">
 
 
 
 
 
 
<style>
/* base.css */
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 40px;
  border: 1px solid transparent;
}

body blockquote {
  background-color: initial;
}

body code {
  color: inherit;
}

body code > div {
  background: none;
}

body.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

body p,
body blockquote,
body ul,
body ol,
body dl,
body table,
body pre {
  margin-top: 16px;
  margin-bottom: 16px;
}

/* github-markdown.css */
body {
  color-scheme: dark;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  margin: 0;
  color: #c9d1d9;
  background-color: #0d1117;
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
  font-size: 16px;
  line-height: 1.5;
  word-wrap: break-word
}
body .octicon {
  display: inline-block;
  fill: currentColor;
  vertical-align: text-bottom
}
body h1:hover .anchor .octicon-link:before,
body h2:hover .anchor .octicon-link:before,
body h3:hover .anchor .octicon-link:before,
body h4:hover .anchor .octicon-link:before,
body h5:hover .anchor .octicon-link:before,
body h6:hover .anchor .octicon-link:before {
  width: 16px;
  height: 16px;
  content: ' ';
  display: inline-block;
  background-color: currentColor;
  -webkit-mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg>");
  mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg>")
}
body details,
body figcaption,
body figure {
  display: block
}
body summary {
  display: list-item
}
body a {
  background-color: transparent;
  color: #58a6ff;
  text-decoration: none
}
body a:active,
body a:hover {
  outline-width: 0
}
body abbr[title] {
  border-bottom: none;
  -webkit-text-decoration: underline dotted;
  text-decoration: underline dotted
}
body b,
body strong {
  font-weight: 600
}
body dfn {
  font-style: italic
}
body h1 {
  margin: .67em 0;
  font-weight: 600;
  padding-bottom: .3em;
  font-size: 1.8em;
  border-bottom: 1px solid #21262d
}
body mark {
  background-color: #ff0;
  color: #c9d1d9
}
body small {
  font-size: 90%
}
body sub,
body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline
}
body sub {
  bottom: -.25em
}
body sup {
  top: -.5em
}
body img {
  border-style: none;
  max-width: 100%;
  box-sizing: content-box;
  background-color: #0d1117
}
body code,
body kbd,
body pre,
body samp {
  font-family: monospace,monospace;
  font-size: 1em
}
body figure {
  margin: 1em 40px
}
body hr {
  box-sizing: content-box;
  overflow: hidden;
  background: 0 0;
  border-bottom: 1px solid #21262d;
  height: .25em;
  padding: 0;
  margin: 24px 0;
  background-color: #30363d;
  border: 0
}
body [type=reset],
body [type=submit],
body html [type=button] {
  -webkit-appearance: button
}
body [type=button]::-moz-focus-inner,
body [type=reset]::-moz-focus-inner,
body [type=submit]::-moz-focus-inner {
  border-style: none;
  padding: 0
}
body [type=button]:-moz-focusring,
body [type=reset]:-moz-focusring,
body [type=submit]:-moz-focusring {
  outline: 1px dotted ButtonText
}
body [type=checkbox],
body [type=radio] {
  box-sizing: border-box;
  padding: 0
}
body [type=number]::-webkit-inner-spin-button,
body [type=number]::-webkit-outer-spin-button {
  height: auto
}
body [type=search] {
  -webkit-appearance: textfield;
  outline-offset: -2px
}
body [type=search]::-webkit-search-cancel-button,
body [type=search]::-webkit-search-decoration {
  -webkit-appearance: none
}
body ::-webkit-input-placeholder {
  color: inherit;
  opacity: .54
}
body ::-webkit-file-upload-button {
  -webkit-appearance: button;
  font: inherit
}
body a:hover {
  text-decoration: underline
}
body hr::before {
  display: table;
  content: ""
}
body hr::after {
  display: table;
  clear: both;
  content: ""
}
body table {
  border-spacing: 0;
  border-collapse: collapse;
  display: block;
  width: max-content;
  max-width: 100%;
  overflow: auto
}
body td,
body th {
  padding: 0
}
body details summary {
  cursor: pointer
}
body details:not([open]) > :not(summary) {
  display: none!important
}
body kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 11px ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
  line-height: 10px;
  color: #c9d1d9;
  vertical-align: middle;
  background-color: #161b22;
  border: solid 1px rgba(110,118,129,.4);
  border-bottom-color: rgba(110,118,129,.4);
  border-radius: 6px;
  box-shadow: inset 0 -1px 0 rgba(110,118,129,.4)
}

details > summary {
  font-weight: 600;
  font-size: 1.4em;
  padding-top: .1em;
}


body h1,
body h2,
body h3,
body h4,
body h5,
body h6 {
  margin-top: 24px;
  margin-bottom: 16px;
  font-weight: 600;
  line-height: 1.25
}
body h2 {
  font-weight: 600;
  font-size: 1.6em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h3 {
  font-weight: 600;
  font-size: 1.4em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h4 {
  font-weight: 600;
  font-size: 1.2em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h5 {
  font-weight: 600;
  font-size: 1.0em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h6 {
  font-weight: 600;
  font-size: 1em;
  color: #8b949e
}
body p {
  margin-top: 0;
  margin-bottom: 10px
}
body blockquote {
  margin: 0;
  padding: 0 1em;
  color: #8b949e;
  border-left: .25em solid #30363d
}
body ol,
body ul {
  margin-top: 0;
  margin-bottom: 0;
  padding-left: 2em
}
body ol ol,
body ul ol {
  list-style-type: lower-roman
}
body ol ol ol,
body ol ul ol,
body ul ol ol,
body ul ul ol {
  list-style-type: lower-alpha
}
body dd {
  margin-left: 0
}
body code,
body tt {
  font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
  font-size: 12px
}
body pre {
  margin-top: 0;
  margin-bottom: 0;
  font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
  font-size: 12px;
  word-wrap: normal
}
body :-ms-input-placeholder {
  color: #484f58;
  opacity: 1
}
body ::-ms-input-placeholder {
  color: #484f58;
  opacity: 1
}
body ::placeholder {
  color: #484f58;
  opacity: 1
}
body .pl-c {
  color: #8b949e
}
body .pl-c1,
body .pl-s .pl-v {
  color: #79c0ff
}
body .pl-e,
body .pl-en {
  color: #d2a8ff
}
body .pl-s .pl-s1,
body .pl-smi {
  color: #c9d1d9
}
body .pl-ent {
  color: #7ee787
}
body .pl-k {
  color: #ff7b72
}
body .pl-pds,
body .pl-s,
body .pl-s .pl-pse .pl-s1,
body .pl-sr,
body .pl-sr .pl-cce,
body .pl-sr .pl-sra,
body .pl-sr .pl-sre {
  color: #a5d6ff
}
body .pl-smw,
body .pl-v {
  color: #ffa657
}
body .pl-bu {
  color: #f85149
}
body .pl-ii {
  color: #f0f6fc;
  background-color: #8e1519
}
body .pl-c2 {
  color: #f0f6fc;
  background-color: #b62324
}
body .pl-sr .pl-cce {
  font-weight: 700;
  color: #7ee787
}
body .pl-ml {
  color: #f2cc60
}
body .pl-mh,
body .pl-mh .pl-en,
body .pl-ms {
  font-weight: 700;
  color: #1f6feb
}
body .pl-mi {
  font-style: italic;
  color: #c9d1d9
}
body .pl-mb {
  font-weight: 700;
  color: #c9d1d9
}
body .pl-md {
  color: #ffdcd7;
  background-color: #67060c
}
body .pl-mi1 {
  color: #aff5b4;
  background-color: #033a16
}
body .pl-mc {
  color: #ffdfb6;
  background-color: #5a1e02
}
body .pl-mi2 {
  color: #c9d1d9;
  background-color: #1158c7
}
body .pl-mdr {
  font-weight: 700;
  color: #d2a8ff
}
body .pl-ba {
  color: #8b949e
}
body .pl-sg {
  color: #484f58
}
body .pl-corl {
  text-decoration: underline;
  color: #a5d6ff
}
body [data-catalyst] {
  display: block
}
body g-emoji {
  font-family: "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
  font-size: 1em;
  font-style: normal!important;
  font-weight: 400;
  line-height: 1;
  vertical-align: -.075em
}
body g-emoji img {
  width: 1em;
  height: 1em
}
body::before {
  display: table;
  content: ""
}
body::after {
  display: table;
  clear: both;
  content: ""
}
body > :first-child {
  margin-top: 0!important
}
body > :last-child {
  margin-bottom: 0!important
}
body a:not([href]) {
  color: inherit;
  text-decoration: none
}
body .absent {
  color: #f85149
}
body .anchor {
  float: left;
  padding-right: 4px;
  margin-left: -20px;
  line-height: 1
}
body .anchor:focus {
  outline: 0
}
body blockquote,
body details,
body dl,
body ol,
body p,
body pre,
body table,
body ul {
  margin-top: 0;
  margin-bottom: 16px
}
body blockquote > :first-child {
  margin-top: 0
}
body blockquote > :last-child {
  margin-bottom: 0
}
body sup > a::before {
  content: "["
}
body sup > a::after {
  content: "]"
}
body h1 .octicon-link,
body h2 .octicon-link,
body h3 .octicon-link,
body h4 .octicon-link,
body h5 .octicon-link,
body h6 .octicon-link {
  color: #c9d1d9;
  vertical-align: middle;
  visibility: hidden
}
body h1:hover .anchor,
body h2:hover .anchor,
body h3:hover .anchor,
body h4:hover .anchor,
body h5:hover .anchor,
body h6:hover .anchor {
  text-decoration: none
}
body h1:hover .anchor .octicon-link,
body h2:hover .anchor .octicon-link,
body h3:hover .anchor .octicon-link,
body h4:hover .anchor .octicon-link,
body h5:hover .anchor .octicon-link,
body h6:hover .anchor .octicon-link {
  visibility: visible
}
body h1 code,
body h1 tt,
body h2 code,
body h2 tt,
body h3 code,
body h3 tt,
body h4 code,
body h4 tt,
body h5 code,
body h5 tt,
body h6 code,
body h6 tt {
  padding: 0 .2em;
  font-size: inherit
}
body ol.no-list,
body ul.no-list {
  padding: 0;
  list-style-type: none
}
body ol[type="1"] {
  list-style-type: decimal
}
body ol[type=a] {
  list-style-type: lower-alpha
}
body ol[type=i] {
  list-style-type: lower-roman
}
body div > ol:not([type]) {
  list-style-type: decimal
}
body ol ol,
body ol ul,
body ul ol,
body ul ul {
  margin-top: 0;
  margin-bottom: 0
}
body li > p {
  margin-top: 16px
}
body li + li {
  margin-top: .25em
}
body dl {
  padding: 0
}
body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: 600
}
body dl dd {
  padding: 0 16px;
  margin-bottom: 16px
}
body table th {
  font-weight: 600
}
body table td,
body table th {
  padding: 6px 13px;
  border: 1px solid #30363d
}
body table tr {
  background-color: #0d1117;
  border-top: 1px solid #21262d
}
body table tr:nth-child(2n) {
  background-color: #161b22
}
body table img {
  background-color: transparent
}
body img[align=right] {
  padding-left: 20px
}
body img[align=left] {
  padding-right: 20px
}
body .emoji {
  max-width: none;
  vertical-align: text-top;
  background-color: transparent
}
body span.frame {
  display: block;
  overflow: hidden
}
body span.frame > span {
  display: block;
  float: left;
  width: auto;
  padding: 7px;
  margin: 13px 0 0;
  overflow: hidden;
  border: 1px solid #30363d
}
body span.frame span img {
  display: block;
  float: left
}
body span.frame span span {
  display: block;
  padding: 5px 0 0;
  clear: both;
  color: #c9d1d9
}
body span.align-center {
  display: block;
  overflow: hidden;
  clear: both
}
body span.align-center > span {
  display: block;
  margin: 13px auto 0;
  overflow: hidden;
  text-align: center
}
body span.align-center span img {
  margin: 0 auto;
  text-align: center
}
body span.align-right {
  display: block;
  overflow: hidden;
  clear: both
}
body span.align-right > span {
  display: block;
  margin: 13px 0 0;
  overflow: hidden;
  text-align: right
}
body span.align-right span img {
  margin: 0;
  text-align: right
}
body span.float-left {
  display: block;
  float: left;
  margin-right: 13px;
  overflow: hidden
}
body span.float-left span {
  margin: 13px 0 0
}
body span.float-right {
  display: block;
  float: right;
  margin-left: 13px;
  overflow: hidden
}
body span.float-right > span {
  display: block;
  margin: 13px auto 0;
  overflow: hidden;
  text-align: right
}
body code,
body tt {
  padding: .2em .4em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(110,118,129,.4);
  border-radius: 6px
}
body code br,
body tt br {
  display: none
}
body del code {
  text-decoration: inherit
}
body pre code {
  font-size: 100%
}
body pre > code {
  padding: 0;
  margin: 0;
  word-break: normal;
  white-space: pre;
  background: 0 0;
  border: 0
}
body .highlight {
  margin-bottom: 16px
}
body .highlight pre {
  margin-bottom: 0;
  word-break: normal
}
body .highlight pre,
body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #161b22;
  border-radius: 6px
}
body pre code,
body pre tt {
  display: inline;
  max-width: auto;
  padding: 0;
  margin: 0;
  overflow: visible;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0
}
body .csv-data td,
body .csv-data th {
  padding: 5px;
  overflow: hidden;
  font-size: 12px;
  line-height: 1;
  text-align: left;
  white-space: nowrap
}
body .csv-data .blob-num {
  padding: 10px 8px 9px;
  text-align: right;
  background: #0d1117;
  border: 0
}
body .csv-data tr {
  border-top: 0
}
body .csv-data th {
  font-weight: 600;
  background: #161b22;
  border-top: 0
}
body .footnotes {
  font-size: 12px;
  color: #8b949e;
  border-top: 1px solid #30363d
}
body .footnotes ol {
  padding-left: 16px
}
body .footnotes li {
  position: relative
}
body .footnotes li:target::before {
  position: absolute;
  top: -8px;
  right: -8px;
  bottom: -8px;
  left: -24px;
  pointer-events: none;
  content: "";
  border: 2px solid #1f6feb;
  border-radius: 6px
}
body .footnotes li:target {
  color: #c9d1d9
}
body .footnotes .data-footnote-backref g-emoji {
  font-family: monospace
}
body [hidden] {
  display: none!important
}
body ::-webkit-calendar-picker-indicator {
  filter: invert(50%)
}

/* node_modules/highlight.js/styles/github-dark.css */
pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!
  Theme: GitHub Dark
  Description: Dark theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-dark
  Current colors taken from GitHub's CSS
*/.hljs{color:#c9d1d9;background:#0d1117}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#ff7b72}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#d2a8ff}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#79c0ff}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#a5d6ff}.hljs-built_in,.hljs-symbol{color:#ffa657}.hljs-code,.hljs-comment,.hljs-formula{color:#8b949e}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#7ee787}.hljs-subst{color:#c9d1d9}.hljs-section{color:#1f6feb;font-weight:700}.hljs-bullet{color:#f2cc60}.hljs-emphasis{color:#c9d1d9;font-style:italic}.hljs-strong{color:#c9d1d9;font-weight:700}.hljs-addition{color:#aff5b4;background-color:#033a16}.hljs-deletion{color:#ffdcd7;background-color:#67060c}

</style>
</head>
<body>
<div class="document">
<div class="header"></div><div class="inner">
<!-- HTML Header End -->
<!-- Header Start -->

<h1>x386.org: Debian and Ubuntu Documentation</h1>
<h4>| &ensp;<a href="index.html">Home</a>&ensp; |&ensp; <a href="about.html">About</a> &ensp;| &ensp;<a href="contact.html">Contact</a>&ensp; | &ensp;<a href="license.html">License</a>&ensp; | &ensp;<a href="privacy_policy.html">Privacy Policy</a>&ensp; |</h4>
<!-- Copyright Start -->
<details>
<summary>Copyright (C) 2020 - 2025 Exforge exforge@x386.org</summary>
<hr />
<p>This document is free text: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or any later version.</p>
<p>This document is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program.  If not, see: <a href="https://www.gnu.org/licenses/">www.gnu.org/licenses/</a>.</p>
<hr />
</details>
<!-- Copyright End -->

<!-- Header End -->
<h5>Deb Packaging</h5>
<h1>Creating and Using .deb Packages</h1>
<details>
<summary>
0. Specs
</summary>
<hr />
<h3>0.1. The What</h3>
<p>This tutorial covers the creation of a <code>.deb</code> package. A <code>.deb</code> package is a compressed archive of files used to install software on Debian GNU/Linux and Ubuntu systems.</p>
<p>As Debian or Ubuntu users, we typically use the <code>apt</code> command to install programs or services. In the background, <code>.deb</code> files are the actual packages being installed.</p>
<p>Our goal is to create and use a <code>.deb</code> package. Note that creating a completely new Debian package from scratch is a broader topic—a superset of what we’ll cover here—and could be the subject of a separate tutorial.</p>
<p>This tutorial is introductory and does not cover every detail. Its purpose is to help you create a simple package.</p>
<h3>0.2. The Environment</h3>
<p><strong>Workstation:</strong> Debian 13 or Ubuntu 24.04 LTS<br />
<strong>Test Servers:</strong> Ubuntu 24.04 LTS, Ubuntu 22.04 LTS, Debian 13, Debian 12.</p>
<h3>0.3. Sources</h3>
<ul>
<li><a href="https://www.debian.org/doc/debian-policy/">www.debian.org</a>  </li>
<li><a href="https://www.debian.org/doc/manuals/maint-guide/dother.en.html">www.debian.org</a>  </li>
<li><a href="https://tldp.org/HOWTO/html_single/Debian-Binary-Package-Building-HOWTO/">tldp.org</a>  </li>
<li><a href="https://github.com/rsm-gh/build-deb/blob/master/DEBIAN_BASICS.md">github.com</a>  </li>
</ul>
<p><br></p>
</details>
<details>
<summary>
1. Basic Information
</summary>
<hr />
<h3>1.1. Package Types:</h3>
<p><code>.deb</code> packages can be either <strong>source packages</strong> or <strong>binary packages</strong>. As the names suggest, source packages contain source code, while binary packages contain compiled executables or scripts.</p>
<p>According to the Debian Policy Manual: <em>A Debian source package contains the source material used to construct one or more binary packages.</em></p>
<p>In this tutorial, we will focus on <strong>binary packages</strong>.</p>
<h3>1.2. Package Structure</h3>
<p>A <code>.deb</code> package follows a specific naming format and contains three main files:</p>
<p><strong>Format:</strong> <code>packagename_version-revision_architecture.deb</code><br />
<strong>Example:</strong> <code>apache2_2.4.52-1debian4.4_amd64.deb</code></p>
<p><strong>Internal files:</strong></p>
<ol>
<li>
<p><strong><code>debian-binary</code></strong><br />
   Contains the Debian package format version, typically just <code>2.0</code>.</p>
</li>
<li>
<p><strong><code>data.tar.zst</code></strong><br />
   A compressed archive of files organized in directory structure. When the package is installed, these files are extracted to their corresponding locations in the filesystem. The extension may vary if a different compression method is used (e.g., <code>.gz</code>, <code>.xz</code>).</p>
</li>
<li>
<p><strong><code>control.tar.zst</code></strong><br />
   A compressed archive of control and maintenance scripts. Common files include:</p>
</li>
<li><strong><code>control</code></strong>: Metadata about the package (name, version, dependencies, etc.)</li>
<li><strong><code>conffiles</code></strong>: A list of configuration files that should be preserved during upgrades</li>
<li><strong><code>preinst</code></strong>: Scripts executed <strong>before</strong> the package is unpacked (e.g., stopping services before an upgrade)</li>
<li><strong><code>postinst</code></strong>: Scripts executed <strong>after</strong> the package is unpacked (e.g., starting services, updating system caches)</li>
<li><strong><code>prerm</code></strong>: Scripts executed <strong>before</strong> the package is removed (e.g., stopping services)</li>
<li><strong><code>postrm</code></strong>: Scripts executed <strong>after</strong> the package is removed (e.g., cleaning up temporary files)</li>
</ol>
<h3>1.3. .deb Package Manipulation</h3>
<p><code>.deb</code> packages can be installed directly using <code>apt</code>:</p>
<p><strong>Install a package:</strong></p>
<pre><code>sudo apt install ./&lt;package&gt;
sudo apt install ./test.deb
</code></pre>
<p><strong>Remove a package:</strong></p>
<pre><code>sudo apt remove &lt;appname&gt;
sudo apt remove test
</code></pre>
<p><strong>Purge a package</strong> (removes configuration files as well):</p>
<pre><code>sudo apt purge &lt;appname&gt;
sudo apt purge test
</code></pre>
<p><br></p>
</details>
<details>
<summary>
2. Package Control Files
</summary>
<hr />
<p>Control files are located in the <code>control.tar.zst</code> archive. Some key files were listed in Section 1.2. Below is a more comprehensive list with brief descriptions; important files are covered in greater detail.</p>
<h3>2.1. <code>control</code></h3>
<p>This file contains metadata used by package managers. It consists of fields and their corresponding values.</p>
<p>Most fields have single-line values, but some support multiple lines. For multi-line fields, each line after the first must begin with a space or tab.</p>
<p><strong>Fields in a binary package:</strong></p>
<ul>
<li>
<p><strong><code>Package</code></strong> (Mandatory): Name of the package. May contain alphanumeric characters, hyphens (<code>-</code>), and periods (<code>.</code>).<br />
  Example: <code>openssh-server</code></p>
</li>
<li>
<p><strong><code>Source</code></strong>: Name of the source package.<br />
  Example: <code>openssh</code></p>
</li>
<li>
<p><strong><code>Version</code></strong> (Mandatory): Package version. Format: <code>[epoch:]upstream_version-debian_revision</code>. The epoch is optional.<br />
  Example: <code>1:8.9p1-3</code></p>
</li>
<li>
<p><strong><code>Section</code></strong> (Recommended): Software category (e.g., <code>admin</code>, <code>database</code>, <code>httpd</code>, <code>java</code>).</p>
</li>
<li>
<p><strong><code>Priority</code></strong> (Recommended): Indicates the importance of the package:</p>
<ul>
<li><strong><code>required</code></strong>: Essential for system functionality.</li>
<li><strong><code>important</code></strong>: Expected on every Linux system.</li>
<li><strong><code>standard</code></strong>: Installed by default; must not conflict with other standard packages.</li>
<li><strong><code>optional</code></strong>: Most packages fall here; may conflict with others.</li>
</ul>
</li>
<li>
<p><strong><code>Architecture</code></strong> (Mandatory): Target architecture (e.g., <code>amd64</code>, <code>arm64</code>, <code>i386</code>, <code>powerpc</code>, <code>sparc</code>, <code>all</code>).</p>
</li>
<li>
<p><strong><code>Essential</code></strong>: If set to <code>yes</code>, the package manager will refuse to remove it. Usually set to <code>no</code> or omitted.</p>
</li>
<li>
<p><strong><code>Depends</code></strong>: Absolute dependencies; this package will not be configured unless all listed packages are configured.</p>
</li>
<li>
<p><strong><code>Pre-Depends</code></strong>: Like <code>Depends</code>, but dependencies must be configured <strong>before</strong> unpacking this package (use sparingly).</p>
</li>
<li>
<p><strong><code>Recommends</code></strong>: Strong but optional dependencies.</p>
</li>
<li>
<p><strong><code>Suggests</code></strong>: Suggested packages that enhance functionality.</p>
</li>
<li>
<p><strong><code>Enhances</code></strong>: Inverse of <code>Suggests</code>; indicates that other packages are more useful with this package.</p>
</li>
<li>
<p><strong><code>Breaks</code></strong>: This package breaks listed packages; they must be unconfigured before installation.</p>
</li>
<li>
<p><strong><code>Conflicts</code></strong>: Stronger than <code>Breaks</code>; conflicting packages must be removed before installation.</p>
</li>
<li>
<p><strong><code>Installed-Size</code></strong>: Estimated disk space (in kilobytes) required after installation.</p>
</li>
<li>
<p><strong><code>Maintainer</code></strong> (Mandatory): Name and email of the maintainer.<br />
  Example: <code>Exforge &lt;exforge@x386.org&gt;</code></p>
</li>
<li>
<p><strong><code>Description</code></strong> (Mandatory): Package description. The first line is a short summary; subsequent lines provide detailed information.</p>
</li>
<li>
<p><strong><code>Homepage</code></strong>: URL of the package's website.</p>
</li>
<li>
<p><strong><code>Built-Using</code></strong>: Packages required during build but not runtime.</p>
</li>
<li>
<p><strong>User-defined fields</strong> may also appear. Ubuntu adds <code>Original-Maintainer</code> to preserve Debian maintainer information.</p>
</li>
</ul>
<p><strong>Example: <code>apache2</code> control file (Debian 13):</strong></p>
<pre><code>Package: apache2
Version: 2.4.65-2
Architecture: amd64
Maintainer: Debian Apache Maintainers &lt;debian-apache@lists.debian.org&gt;
Installed-Size: 576
Pre-Depends: init-system-helpers (&gt;= 1.54~)
Depends: apache2-bin (= 2.4.65-2), apache2-data (= 2.4.65-2), apache2-utils (= 2.4.65-2), media-types, procps, perl:any
Recommends: ssl-cert
Suggests: apache2-doc, apache2-suexec-pristine | apache2-suexec-custom, ufw, www-browser
Provides: httpd, httpd-cgi
Section: httpd
Priority: optional
Homepage: https://httpd.apache.org/
Description: Apache HTTP Server
 The Apache HTTP Server Project's goal is to build a secure, efficient and
 extensible HTTP server as standards-compliant open source software. The
 result has long been the number one web server on the Internet.
 .
 Installing this package results in a full installation, including the
 configuration files, init scripts and support scripts.
</code></pre>
<p><strong>Example: <code>openssh-server</code> control file (Debian 13):</strong></p>
<pre><code>Package: openssh-server
Source: openssh
Version: 1:10.0p1-7
Architecture: amd64
Maintainer: Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;
Installed-Size: 3429
Pre-Depends: init-system-helpers (&gt;= 1.54~)
Depends: libpam-modules, libpam-runtime, lsb-base, openssh-client (= 1:10.0p1-7), openssh-sftp-server, procps, ucf, debconf (&gt;= 0.5) | debconf-2.0, runit-helper (&gt;= 2.14.0~), systemd | systemd-standalone-sysusers | systemd-sysusers, libaudit1 (&gt;= 1:2.2.1), libc6 (&gt;= 2.38), libcom-err2 (&gt;= 1.43.9), libcrypt1 (&gt;= 1:4.1.0), libgssapi-krb5-2 (&gt;= 1.17), libkrb5-3 (&gt;= 1.13~alpha1+dfsg), libpam0g (&gt;= 0.99.7.1), libselinux1 (&gt;= 3.1~), libssl3t64 (&gt;= 3.0.0), libwrap0 (&gt;= 7.6-4~), libwtmpdb0 (&gt;= 0.13.0), zlib1g (&gt;= 1:1.1.4)
Recommends: default-logind | logind | libpam-systemd, ncurses-term, xauth
Suggests: molly-guard, monkeysphere, ssh-askpass, ufw
Conflicts: sftp, ssh-socks, ssh2
Breaks: runit (&lt;&lt; 2.1.2-51~)
Replaces: openssh-client (&lt;&lt; 1:7.9p1-8), ssh, ssh-krb5
Provides: ssh-server
Section: net
Priority: optional
Multi-Arch: foreign
Homepage: https://www.openssh.com/
Description: secure shell (SSH) server, for secure access from remote machines
 This is the portable version of OpenSSH, a free implementation of
 the Secure Shell protocol as specified by the IETF secsh working
 group.
 .
 Ssh (Secure Shell) is a program for logging into a remote machine
 and for executing commands on a remote machine.
 It provides secure encrypted communications between two untrusted
 hosts over an insecure network. X11 connections and arbitrary TCP/IP
 ports can also be forwarded over the secure channel.
 It can be used to provide applications with a secure communication
 channel.
 .
 This package provides the sshd server.
 .
 In some countries it may be illegal to use any encryption at all
 without a special permit.
 .
 sshd replaces the insecure rshd program, which is obsolete for most
 purposes.
</code></pre>
<h3>2.2. <code>conffiles</code></h3>
<p>Lists configuration files that should be preserved during upgrades. Users are warned if they have modified these files.</p>
<p><strong>Example from <code>openssh-server</code> (Ubuntu 22.04 LTS):</strong></p>
<pre><code>/etc/default/ssh
/etc/init.d/ssh
/etc/pam.d/sshd
/etc/ssh/moduli
/etc/sv/ssh/.meta/installed
/etc/sv/ssh/finish
/etc/sv/ssh/log/run
/etc/sv/ssh/run
/etc/ufw/applications.d/openssh-server
</code></pre>
<h3>2.3. preinst</h3>
<p>Script executed <strong>before</strong> unpacking the package. Must be idempotent (can run more than once without any problems), start with a shebang (<code>#!</code>), and return <code>0</code> on success.</p>
<p><strong>Call scenarios:</strong></p>
<ul>
<li><code>new-preinst install</code> – Before initial installation.</li>
<li><code>new-preinst install old-version new-version</code> – Before upgrading a removed package.</li>
<li><code>new-preinst upgrade old-version new-version</code> – Before package upgrade.</li>
<li><code>old-preinst abort-upgrade new-version</code> – If <code>postrm</code> fails during upgrade.</li>
</ul>
<p><strong>Excerpt from <code>apache2</code> <code>preinst</code>:</strong></p>
<pre><code>case &quot;$1&quot; in
    upgrade|install)

    if dpkg --compare-versions &quot;$2&quot; lt-nl &quot;2.4.23-3~&quot; ; then
        list_fixup_conffiles | replace_broken_conffiles
    fi

    ;;

    abort-upgrade)
        list_fixup_conffiles | revert_broken_conffiles
    ;;

    *)
    echo &quot;preinst called with unknown argument \`$1'&quot; &gt;&amp;2
    exit 1
    ;;
esac
</code></pre>
<h3>2.4. <code>postinst</code></h3>
<p>Script executed <strong>after</strong> unpacking the package. Must be idempotent, start with a shebang, and return <code>0</code> on success.</p>
<p><strong>Call scenarios:</strong></p>
<ul>
<li><code>postinst configure old-version</code> – After installation.</li>
<li><code>old-postinst abort-upgrade new-version</code> – If <code>prerm</code> fails during upgrade.</li>
<li><code>old-postinst abort-remove</code> – If <code>prerm</code> fails during removal.</li>
<li><code>postinst abort-deconfigure in-favour new-package new-version [...]</code> – If <code>prerm</code> fails during deconfiguration due to conflict.</li>
</ul>
<p><strong>Excerpt from <code>apache2</code> <code>postinst</code>:</strong></p>
<pre><code>is_fresh_install()
{
    if [ -z &quot;$2&quot; ] ; then
        return 0
    fi
    return 1
}
</code></pre>
<pre><code>case &quot;$1&quot; in
    configure)
        enable_default_mpm $@
        install_default_files $@
        enable_default_modules $@
        enable_default_conf $@
        install_default_site $@
        execute_deferred_actions
    ;;
    abort-upgrade)
    ;;
    abort-remove|abort-deconfigure)
    ;;
    *)
        echo &quot;postinst called with unknown argument \`$1'&quot; &gt;&amp;2
        exit 1
    ;;
esac
</code></pre>
<h3>2.5. <code>prerm</code></h3>
<p>Script executed <strong>before</strong> removing a package. Must be idempotent, start with a shebang, and return <code>0</code> on success.</p>
<p><strong>Call scenarios:</strong></p>
<ul>
<li><code>prerm remove</code> – Before removal.</li>
<li><code>old-prerm upgrade new-version</code> – Before upgrade.</li>
<li><code>new-prerm failed-upgrade old-version new-version</code> – If upgrade fails.</li>
<li><code>prerm deconfigure in-favour new-package new-version</code> – Before deconfiguration due to conflict.</li>
<li><code>prerm remove in-favour new-package new-version</code> – Before replacement due to conflict.</li>
</ul>
<p><strong>Example from <code>mariadb-server</code> <code>prerm</code>:</strong></p>
<pre><code>#!/bin/sh
set -e
# Automatically added by dh_installsystemd/13.24.2
if [ -z &quot;$DPKG_ROOT&quot; ] &amp;&amp; [ &quot;$1&quot; = remove ] &amp;&amp; [ -d /run/systemd/system ] ; then
    deb-systemd-invoke stop 'mariadb.service' &gt;/dev/null || true
fi
# End automatically added section
# Automatically added by dh_installinit/13.24.2
if [ -z &quot;$DPKG_ROOT&quot; ] &amp;&amp; [ &quot;$1&quot; = remove ] &amp;&amp; [ -x &quot;/etc/init.d/mariadb&quot; ] ; then
    invoke-rc.d --skip-systemd-native mariadb stop || exit 1
fi
# End automatically added section
</code></pre>
<h3>2.6. postrm</h3>
<p>Script executed <strong>after</strong> removing a package. Must be idempotent, start with a shebang, and return <code>0</code> on success.</p>
<p><strong>Call scenarios:</strong></p>
<ul>
<li><code>postrm remove</code> – After removal.</li>
<li><code>postrm purge</code> – After purging.</li>
<li><code>old-postrm upgrade new-version</code> – After upgrade.</li>
<li><code>new-postrm failed-upgrade old-version new-version</code> – If upgrade fails.</li>
<li><code>postrm disappear overwriter-package overwriter-version</code> – After files are overwritten.</li>
<li><code>new-postrm abort-install</code> – If <code>preinst</code> fails during installation.</li>
</ul>
<p><strong>Excerpt from <code>openssh-server</code> <code>postrm</code>:</strong></p>
<pre><code>if [ &quot;$1&quot; = remove ] &amp;&amp; [ -d /run/systemd/system ] ; then
    systemctl --system daemon-reload &gt;/dev/null || true
fi
if [ &quot;$1&quot; = &quot;purge&quot; ]; then
    if [ -x &quot;/usr/bin/deb-systemd-helper&quot; ]; then
        deb-systemd-helper purge 'sshd-keygen.service' &gt;/dev/null || true
    fi
fi
</code></pre>
<h3>2.7. <code>config</code></h3>
<p>Script run <strong>before</strong> <code>preinst</code>, before any pre-dependencies are satisfied. Used to prompt the user for configuration decisions.</p>
<p><strong>Example from <code>mariadb-server</code> <code>config</code>:</strong></p>
<pre><code>#!/bin/bash

set -e

# shellcheck source=/dev/null
. /usr/share/debconf/confmodule

if [ -n &quot;$DEBIAN_SCRIPT_DEBUG&quot; ]
then
  set -v -x; DEBIAN_SCRIPT_TRACE=1
fi

${DEBIAN_SCRIPT_TRACE:+ echo &quot;#42#DEBUG# RUNNING $0 $*&quot; 1&gt;&amp;2}

# Beware that there are two ypwhich one of them needs the 2&gt;/dev/null!
if test -n &quot;$(command -v ypwhich 2&gt;/dev/null)&quot; &amp;&amp; ypwhich &gt; /dev/null 2&gt;&amp;1
then
  db_input high mariadb-server/nis_warning || true
  db_go
fi
</code></pre>
<h3>2.8. <code>templates</code></h3>
<p>Contains templates for user prompts (used with <code>debconf</code>).</p>
<p><strong>Excerpt from <code>openssh-server</code> <code>templates</code>:</strong></p>
<pre><code>Template: openssh-server/password-authentication
Type: boolean
Default: true
Description: Allow password authentication?
 By default, the SSH server will allow authenticating using a password.
 You may want to change this if all users on this system authenticate using
 a stronger authentication method, such as public keys.
</code></pre>
<h3>2.9. <code>md5sums</code></h3>
<p>MD5 hashes of package files for integrity verification.</p>
<p><strong>Excerpt from <code>openssh-server</code> <code>md5sums</code>:</strong></p>
<pre><code>4b50d38888a7c2093ea4928dca327287  usr/lib/openssh/ssh-session-cleanup
36b4eaabb3472c543e7e9e7c0c80a014  usr/lib/openssh/sshd-auth
269cc6f51c160b60b0f714ee2f1f434d  usr/lib/openssh/sshd-session
8ec138e332aa1fbc3f081c17e81b62f9  usr/lib/systemd/system/rescue-ssh.target
0cbed0c937f53a8d3e9372faa6c23e4c  usr/lib/systemd/system/ssh.service
144e44ecb5dfaa27337b7e5d6348e9fa  usr/lib/systemd/system/ssh.socket
a09b0c24335b507ec5c9f100f9ba3b15  usr/lib/systemd/system/sshd-keygen.service
09582565e7d6ab3f1f15293d0bc9ab97  usr/lib/systemd/system/sshd@.service
3890b397321c96e14ef5627d1ea251d0  usr/lib/sysusers.d/openssh-server.conf
550889177dce3b36aa2717e88c9bf7e1  usr/lib/tmpfiles.d/openssh-server.conf
283a135db1d5bf7fbe7483fe56269dfc  usr/sbin/sshd
f410eed89eecfb2bcf29440141a49d4f  usr/share/apport/package-hooks/openssh-server.py
77862d01cdeb1232790155687382fdad  usr/share/doc/openssh-client/examples/ssh-session-cleanup.service
931ec2a78f8e7e9b8971416497aecc5b  usr/share/lintian/overrides/openssh-server
58d232b99ab4d6c8fde0c12a98b8841c  usr/share/man/man5/moduli.5.gz
18f27d1ef2de5f84a601ffefa20568d2  usr/share/man/man5/sshd_config.5.gz
5a9a2a3ffa3b98bb9bfb77f057fada68  usr/share/man/man8/sshd.8.gz
0382ac8785a147d5a10f3fa0cdfd8eb5  usr/share/openssh/sshd_config
07e75bae4aeca2bbf7bb42ba6af88a7d  usr/share/openssh/sshd_config.md5sum
d41d8cd98f00b204e9800998ecf8427e  usr/share/runit/meta/ssh/installed
</code></pre>
<h3>2.10. <code>triggers</code></h3>
<p>Declares package relationships with system triggers.</p>
<p><strong>Trigger directives:</strong></p>
<ul>
<li><code>interest &lt;trigger&gt;</code> – Package is interested in the trigger.</li>
<li><code>interest-await &lt;trigger&gt;</code> – Puts triggering package in "awaited" state.</li>
<li><code>interest-noawait &lt;trigger&gt;</code> – Does not await the trigger.</li>
<li><code>activate &lt;trigger&gt;</code> – Any change activates the trigger.</li>
<li><code>activate-await &lt;trigger&gt;</code> – Only puts package in "awaited" state.</li>
<li><code>activate-noawait &lt;trigger&gt;</code> – Never puts package in "awaited" state.</li>
</ul>
<p><strong>Example from <code>mariadb-server</code> <code>triggers</code>:</strong></p>
<pre><code>interest-noawait /etc/mysql
interest-noawait /etc/systemd/system/mariadb.service.d
</code></pre>
<h3>2.11. <code>symbols</code> and <code>shlibs</code></h3>
<p>Contain shared library information.</p>
<p><strong>Reference:</strong><br />
<a href="https://man7.org/linux/man-pages/man5/deb-symbols.5.html">https://man7.org/linux/man-pages/man5/deb-symbols.5.html</a><br />
<a href="https://man7.org/linux/man-pages/man5/deb-shlibs.5.html">https://man7.org/linux/man-pages/man5/deb-shlibs.5.html</a></p>
<p><strong>Example from <code>slapd</code> <code>shlibs</code>:</strong></p>
<pre><code>libslapi 2 slapd (&gt;= 2.6.10+dfsg)
</code></pre>
<p><br></p>
</details>
<details>
<summary>
3. Package Data Files
</summary>
<hr />
<h3>3.1. Basics</h3>
<p>Data files reside in the <code>data.tar.zst</code> archive. This archive contains files organized in their corresponding directory structure. During installation, each file is extracted to its appropriate location in the filesystem.</p>
<p><strong>Example: Directory structure of the <code>openssh-server</code> package (Ubuntu 22.04 LTS):</strong></p>
<pre><code>├── etc
│   ├── default
│   │   └── ssh
│   ├── init.d
│   │   └── ssh
│   ├── pam.d
│   │   └── sshd
│   ├── ssh
│   │   ├── moduli
│   │   └── sshd_config.d
│   └── ufw
│       └── applications.d
│           └── openssh-server
├── lib
│   └── systemd
│       └── system
│           ├── rescue-ssh.target
│           ├── ssh.service
│           ├── ssh@.service
│           └── ssh.socket
└── usr
    ├── lib
    │   └── openssh
    │       └── ssh-session-cleanup
    ├── sbin
    │   └── sshd
    └── share
        ├── apport
        │   └── package-hooks
        │       └── openssh-server.py
        ├── doc
        │   ├── openssh-client
        │   │   └── examples
        │   │       └── ssh-session-cleanup.service
        │   └── openssh-server -&gt; openssh-client
        ├── man
        │   ├── man5
        │   │   ├── authorized_keys.5.gz -&gt; ../man8/sshd.8.gz
        │   │   ├── moduli.5.gz
        │   │   └── sshd_config.5.gz
        │   └── man8
        │       └── sshd.8.gz
        └── openssh
            ├── sshd_config
            └── sshd_config.md5sum
</code></pre>
<h3>3.2. File Locations</h3>
<p>Data files include binaries, static files, dynamic files, configurations, and more. Each file must be placed in an appropriate directory.</p>
<p><strong>Common locations:</strong></p>
<ul>
<li><strong>Architecture-independent, application-specific files</strong> → <code>/usr/share</code></li>
<li><strong>User-specific configuration files</strong> → <code>~/.packagename</code> (file or directory)</li>
<li><strong>System-wide configuration files</strong> → <code>/etc/packagename</code></li>
<li><strong>Systemd unit files</strong> → <code>/lib/systemd/system</code></li>
<li><strong>Log files</strong> → <code>/var/log/packagename</code></li>
<li><strong>Cron jobs</strong> (depending on frequency):<ul>
<li><code>/etc/cron.hourly</code></li>
<li><code>/etc/cron.daily</code></li>
<li><code>/etc/cron.weekly</code></li>
<li><code>/etc/cron.monthly</code></li>
<li>For custom schedules → <code>/etc/cron.d</code></li>
</ul>
</li>
</ul>
<p><br></p>
</details>
<details>
<summary>
4. Package Installation Process
</summary>
<hr />
<p>The installation process of a <code>.deb</code> package involves multiple steps, including script execution and dependency management. Below is a simplified overview of the flow:</p>
<pre><code>If there is a previous version of the package:
  Call for the old package: &quot;old-prerm upgrade new-version&quot;
  If return status is not 0:
    Call for the current package: &quot;new-prerm failed-upgrade old-version new-version&quot;
    If return status is not 0:
      Call for the old package: &quot;old-postinst abort-upgrade new-version&quot;
        If return status is 0:
          Upgrade unsuccessful, old version remains functional
          Exit
        Else:
          Upgrade unsuccessful, old version is broken
          Exit

If there are conflicting and/or broken packages:
  For each conflicting/broken package:
    # Unconfigure them
    deconfigured's-prerm deconfigure in-favour package-being-installed version
    If return status is not 0:
      deconfigured's-postinst abort-deconfigure in-favour \
          package-being-installed-but-failed version
    # Remove them
    conflictor's-prerm remove in-favour package new-version
    If return status is not 0:
      conflictor's-postinst abort-remove in-favour package new-version
    If any packages depend on the conflicting/broken packages:
      For each dependent package:
        # Unconfigure them
        deconfigured's-prerm deconfigure in-favour package-being-installed \
            version removing conflicting-package version
        If return status is not 0:
          deconfigured's-postinst abort-deconfigure in-favour \
             package-being-installed-but-failed version \
             removing conflicting-package version
    # Prepare to remove conflicting packages
    conflictor's-prerm remove in-favour package new-version
    If return status is not 0:
      conflictor's-postinst abort-remove in-favour package new-version

# Run the preinst script of the new package
If the package is being upgraded:
  new-preinst upgrade old-version new-version
  If return status is not 0:
    new-postrm abort-upgrade old-version new-version
      If return status is 0:
        Upgrade unsuccessful, old version remains functional
        Exit
      Else:
        Upgrade unsuccessful, old version is broken
        Exit
Else if the package is new but old configuration files exist:
  new-preinst install old-version new-version
  If return status is not 0:
    new-postrm abort-install old-version new-version
    Installation unsuccessful
    Exit
Else:  # Fresh installation with no existing configuration files
  new-preinst install
  If return status is not 0:
    new-postrm abort-install
    Installation unsuccessful
    Exit

Unpack all files from the data archive
# A package cannot overwrite another package's files unless specified with &quot;Replaces&quot;

If the package is being upgraded:
  old-postrm upgrade new-version
  If return condition is not 0:
    new-postrm failed-upgrade old-version new-version
    If return condition is 0:
      Upgrade failed, old version remains functional
      Exit
    Else:
      # Upgrade failed; attempt to recover
      old-preinst abort-upgrade new-version
      If return condition is 0:
        new-postrm abort-upgrade old-version new-version
        If return condition is 0:
          old-postinst abort-upgrade new-version
          Upgrade failed, old version remains functional
          Exit
        Else:
          Upgrade failed, old version broken
          Exit
      Else:
        Upgrade failed, old version broken
        Exit

Files present in the old version but not in the new version are removed
The new file list replaces the old one
New maintenance scripts replace the old ones
For each package whose files were overwritten and is no longer required for dependencies:
  # Remove the overwritten package
  disappearer's-postrm disappear overwriter overwriter-version
  Remove package scripts
  Update package status to &quot;Not-Installed&quot;
If any files in the new package are also listed in other packages:
  Remove them
Remove temporary and backup files created during installation
Set the package status to &quot;Unpacked&quot;
If there were conflicting packages:
  Remove them
</code></pre>
<p><br></p>
</details>
<details>
<summary>
5. Package Removal/Purge Process
</summary>
<hr />
<p>The removal or purging of a package follows a structured sequence:</p>
<pre><code>Run: prerm remove
If return status is not 0:
  If failure is due to conflict:
    Run: conflictor's-postinst abort-remove in-favour package new-version
  Else:
    Run: postinst abort-remove
  If return status is 0:
    Removal aborted; package remains installed
    Exit
  Else:
    Removal aborted; package is in a broken state
    Exit

Remove all package files (except configuration files listed in conffiles)
Remove all package maintenance scripts except postrm

If purging (not just removing):
  Remove configuration files and temporary/backup files created during installation
  Run: postrm purge
  Remove the package's file list from the system database
</code></pre>
<p><br></p>
</details>
<details>
<summary>
6. .deb Package Preparation Checklist
</summary>
<hr />
<h3>6.1. Create File and Folder Structure for the Package</h3>
<p>A minimal directory structure for a package includes:</p>
<pre><code>ProgramName-Version/
├── DEBIAN/
│   └── control
└── usr/
    └── bin/
        └── ProgramName
</code></pre>
<p>Additional files and directories you may need:</p>
<pre><code>ProgramName-Version/
├── DEBIAN/
│   ├── control
│   ├── preinst
│   ├── postinst
│   ├── prerm
│   └── postrm
├── etc/
│   ├── ProgramName.conf
│   └── ProgramName/
├── usr/
│   ├── share/
│   │   ├── applications/
│   │   │   └── ProgramName.desktop
│   │   └── ProgramName/
│   │       └── ProgramFiles
│   └── bin/
│       └── ProgramName
└── (other directories as needed)
</code></pre>
<h3>6.2. Copy Files</h3>
<p>Place your program executable, control files, scripts, and other resources into the appropriate locations:</p>
<ul>
<li><strong><code>/usr/share/ProgramName/</code></strong>: Use this directory if your program consists of multiple files.</li>
<li><strong><code>/etc/</code></strong> or <strong><code>/etc/ProgramName/</code></strong>: For configuration files (single file or a directory of configs).</li>
<li><strong><code>/usr/share/applications/</code></strong>: For desktop launcher files (<code>.desktop</code> entries).</li>
</ul>
<h3>6.3. Preparing and Building The Package</h3>
<p>Once all files are in place, ensure executable files have the correct permissions:</p>
<pre><code>chmod a+x ProgramName-Version/usr/bin/ProgramName
</code></pre>
<p>Then build the package using <code>dpkg-deb</code>:</p>
<pre><code>dpkg-deb -Z xz --build --root-owner-group ProgramName-Version
</code></pre>
<p>The resulting <code>.deb</code> file (e.g., <code>ProgramName-Version.deb</code>) is your ready-to-use package.</p>
<p><br></p>
</details>
<details>
<summary>
7. A Very Simple Package
</summary>
<hr />
<p>We will now create a very simple package named <strong>"distro"</strong>. This package contains a Python script that displays the Unix distribution name and version information.</p>
<p>The package includes only the executable script and the control file—no configuration files or maintenance scripts are required.</p>
<h3>7.1. Create Folder Structure</h3>
<p>First, create a <code>packages</code> directory in your home folder to organize your work:</p>
<pre><code>mkdir ~/packages
</code></pre>
<p>Package naming follows the format: <code>packagename_version-revision_architecture.deb</code>. Create a folder for our package:</p>
<pre><code>mkdir ~/packages/distro_1.0.0-1_all
</code></pre>
<p>Create subdirectories for the executable and control files:</p>
<pre><code>mkdir -p ~/packages/distro_1.0.0-1_all/usr/bin
mkdir ~/packages/distro_1.0.0-1_all/DEBIAN
</code></pre>
<h3>7.2. Create the Executable File</h3>
<p>Create the Python script:</p>
<pre><code>nano ~/packages/distro_1.0.0-1_all/usr/bin/distro
</code></pre>
<p>Add the following content:</p>
<pre><code>#!/usr/bin/env python3
def distro_version():
    d = {}
    try:
        with open(&quot;/etc/os-release&quot;) as f:
            for line in f:
                line = line.replace('&quot;', '')
                line = line.replace('\n', '')
                if line == &quot;&quot;:
                    continue
                (key, val) = line.split(&quot;=&quot;)
                d[(key)] = val
        distro = d[&quot;NAME&quot;]
        version = d[&quot;VERSION_ID&quot;]
    except:
        distro = &quot;Other&quot;
        version = &quot;Other&quot;
    return distro, version
distro, version = distro_version()
print(distro, version)
</code></pre>
<p>Make the script executable:</p>
<pre><code>chmod +x ~/packages/distro_1.0.0-1_all/usr/bin/distro
</code></pre>
<h3>7.3. Create the Control File</h3>
<p>Create the <code>control</code> file:</p>
<pre><code>nano ~/packages/distro_1.0.0-1_all/DEBIAN/control
</code></pre>
<p>Add the following content:</p>
<pre><code>Package: distro
Version: 1.0.0-1
Architecture: all
Maintainer: Exforge &lt;exforge@x386.org&gt;
Depends: python3
Homepage: https://github.com/enatsek/
Description: Prints Linux Distribution and Name
  A python script to print linux distro and version of the distro. I do not know what 
  it does on other OSs.
</code></pre>
<h3>7.4. Build the package</h3>
<p>Navigate to the packages directory and build the package:</p>
<pre><code>cd ~/packages
dpkg-deb -Z xz --build --root-owner-group distro_1.0.0-1_all 
</code></pre>
<p>Your package, <code>distro_1.0.0-1_all.deb</code>, is now located in the <code>~/packages</code> folder.</p>
<p><strong>Note:</strong> <code>dpkg-deb</code> typically uses <code>zst</code> compression, but we override it with the <code>-Z xz</code> flag for broader compatibility. Packages compressed with <code>zst</code> (default in Ubuntu 22.04) may not work on older Debian distributions.</p>
<p><br></p>
</details>
<details>
<summary>
8. A More Complex Package: Watchbox
</summary>
<hr />
<p>OOur next package, <strong>watchbox</strong>, is more complex. It is a Python script designed to run as a systemd service.</p>
<p>The package must:</p>
<ul>
<li>Install as a systemd service</li>
<li>Enable and start the service after installation</li>
<li>Stop the service before removal or upgrade</li>
</ul>
<p>Required control files: <code>control</code>, <code>conffiles</code>, <code>postinst</code>, and <code>prerm</code>.<br />
Data files: the script itself, a configuration file, and a systemd unit file.</p>
<h3>8.0. About Watchbox</h3>
<p>Watchbox is a demonstration service that periodically checks network connectivity for hosts, web pages, files, or services.</p>
<p>It consists of:
- <code>watchbox</code>: the main application
- <code>watchbox.conf</code>: configuration file
- <code>watchbox.service</code>: systemd service unit file</p>
<p>For more details, see: <a href="https://github.com/enatsek/watchbox">https://github.com/enatsek/watchbox</a></p>
<h3>8.1. Download Watchbox Files</h3>
<p>Download the necessary files from GitHub to a temporary location:</p>
<pre><code>wget https://raw.githubusercontent.com/enatsek/watchbox/main/watchbox \
     -P /tmp
wget https://raw.githubusercontent.com/enatsek/watchbox/main/watchbox.conf \
     -P /tmp
wget https://raw.githubusercontent.com/enatsek/watchbox/main/watchbox.service \
     -P /tmp
</code></pre>
<h3>8.2. Folder Structure</h3>
<p>The package will have the following structure:</p>
<pre><code>/packages/
~/packages/watchbox_0.9-1_all/
├── DEBIAN/
│   ├── control
│   ├── conffiles
│   ├── postinst
│   └── prerm
├── etc/
│   └── watchbox.conf
├── lib/
│   └── systemd/
│       └── system/
│           └── watchbox.service
└── usr/
    └── bin/
        └── watchbox
</code></pre>
<h3>8.3. Create Folder Structure</h3>
<p>Create the directories:</p>
<pre><code>mkdir -p ~/packages/watchbox_0.9-1_all/DEBIAN/
mkdir -p ~/packages/watchbox_0.9-1_all/etc
mkdir -p ~/packages/watchbox_0.9-1_all/lib/systemd/system/
mkdir -p ~/packages/watchbox_0.9-1_all/usr/bin/
</code></pre>
<h3>8.4. Copy Watchbox Files to Their Locations</h3>
<pre><code>cp /tmp/watchbox.conf ~/packages/watchbox_0.9-1_all/etc/
cp /tmp/watchbox.service ~/packages/watchbox_0.9-1_all/lib/systemd/system/
cp /tmp/watchbox -p ~/packages/watchbox_0.9-1_all/usr/bin/
</code></pre>
<p>Make the script executable:</p>
<pre><code>chmod +x ~/packages/watchbox_0.9-1_all/usr/bin/watchbox
</code></pre>
<h3>8.5. Create Control Files and Maintenance Scripts</h3>
<p><strong>Control File (<code>control</code>):</strong></p>
<pre><code>nano ~/packages/watchbox_0.9-1_all/DEBIAN/control
</code></pre>
<p>Add the following content:</p>
<pre><code>Package: watchbox
Version: 0.9-1
Architecture: amd64
Maintainer: Exforge &lt;exforge@x386.org&gt;
Homepage: https://github.com/enatsek/watchbox/
Depends: python3, python3-systemd
Description: Automated Service Checking Tool
  WatchBox (AKA watchbox) is planned to be a Systemd service for starting at the power-up and making periodic checks.
  Currently it has 6 types of checks:
  - IPPing: Checks if an IP address or hostname can be pinged
  - IPPort: Checks if an IP address or hostname can be connected through a TCP Port
  - Webpage: Checks if a webpage exists
  - WebpageContent: Checks if a webpage has a content
  - LocalPath: Checks if a path exists
  - LocalService: Checks if a systemd service is active
  Check status results can be collected to systemd journal, text file, and/or sqlite db file.
  Configuration file watchbox.conf is expected to be in /etc directory. It is well documented inside.
  Disclaimer: This program is far from being optimized, so it is not adviced to use it on production environments.
</code></pre>
<p><strong>Configuration File List (<code>conffiles</code>):</strong></p>
<pre><code>nano ~/packages/watchbox_0.9-1_all/DEBIAN/conffiles
</code></pre>
<p>Add:</p>
<pre><code>/etc/watchbox.conf
</code></pre>
<p><strong>Post-Installation Script (<code>postinst</code>):</strong></p>
<pre><code>nano ~/packages/watchbox_0.9-1_all/DEBIAN/postinst
</code></pre>
<p>Add:</p>
<pre><code>#!/bin/bash
systemctl enable watchbox
systemctl start watchbox
</code></pre>
<p>Make it executable:</p>
<pre><code>chmod +x ~/packages/watchbox_0.9-1_all/DEBIAN/postinst
</code></pre>
<p><strong>Pre-Removal Script (<code>prerm</code>):</strong></p>
<pre><code>nano ~/packages/watchbox_0.9-1_all/DEBIAN/prerm
</code></pre>
<p>Fill as below (Stops watchbox service)</p>
<pre><code>#!/bin/bash
systemctl stop watchbox
</code></pre>
<p>Make it executable:</p>
<pre><code>chmod +x ~/packages/watchbox_0.9-1_all/DEBIAN/prerm
</code></pre>
<h3>8.6. Build the Package</h3>
<p>Navigate to the packages directory and build:</p>
<pre><code>cd ~/packages
dpkg-deb -Z xz --build --root-owner-group watchbox_0.9-1_all 
</code></pre>
<p>Your package, <code>watchbox_0.9-1_all.deb</code>, is now ready in the <code>~/packages</code> folder.</p>
</details><!-- HTML Footer Start -->

</body>
</html>

<!-- HTML Footer End -->
