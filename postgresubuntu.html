<!-- HTML Header Start -->
<!DOCTYPE html>
<html><head>
<title>x386.org: Debian and Ubuntu Documentation</title>
<meta charset="UTF-8">
 
 
 
 
 
 
<style>
/* base.css */
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 40px;
  border: 1px solid transparent;
}

body blockquote {
  background-color: initial;
}

body code {
  color: inherit;
}

body code > div {
  background: none;
}

body.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

body p,
body blockquote,
body ul,
body ol,
body dl,
body table,
body pre {
  margin-top: 16px;
  margin-bottom: 16px;
}

/* github-markdown.css */
body {
  color-scheme: dark;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  margin: 0;
  color: #c9d1d9;
  background-color: #0d1117;
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
  font-size: 16px;
  line-height: 1.5;
  word-wrap: break-word
}
body .octicon {
  display: inline-block;
  fill: currentColor;
  vertical-align: text-bottom
}
body h1:hover .anchor .octicon-link:before,
body h2:hover .anchor .octicon-link:before,
body h3:hover .anchor .octicon-link:before,
body h4:hover .anchor .octicon-link:before,
body h5:hover .anchor .octicon-link:before,
body h6:hover .anchor .octicon-link:before {
  width: 16px;
  height: 16px;
  content: ' ';
  display: inline-block;
  background-color: currentColor;
  -webkit-mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg>");
  mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg>")
}
body details,
body figcaption,
body figure {
  display: block
}
body summary {
  display: list-item
}
body a {
  background-color: transparent;
  color: #58a6ff;
  text-decoration: none
}
body a:active,
body a:hover {
  outline-width: 0
}
body abbr[title] {
  border-bottom: none;
  -webkit-text-decoration: underline dotted;
  text-decoration: underline dotted
}
body b,
body strong {
  font-weight: 600
}
body dfn {
  font-style: italic
}
body h1 {
  margin: .67em 0;
  font-weight: 600;
  padding-bottom: .3em;
  font-size: 1.8em;
  border-bottom: 1px solid #21262d
}
body mark {
  background-color: #ff0;
  color: #c9d1d9
}
body small {
  font-size: 90%
}
body sub,
body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline
}
body sub {
  bottom: -.25em
}
body sup {
  top: -.5em
}
body img {
  border-style: none;
  max-width: 100%;
  box-sizing: content-box;
  background-color: #0d1117
}
body code,
body kbd,
body pre,
body samp {
  font-family: monospace,monospace;
  font-size: 1em
}
body figure {
  margin: 1em 40px
}
body hr {
  box-sizing: content-box;
  overflow: hidden;
  background: 0 0;
  border-bottom: 1px solid #21262d;
  height: .25em;
  padding: 0;
  margin: 24px 0;
  background-color: #30363d;
  border: 0
}
body [type=reset],
body [type=submit],
body html [type=button] {
  -webkit-appearance: button
}
body [type=button]::-moz-focus-inner,
body [type=reset]::-moz-focus-inner,
body [type=submit]::-moz-focus-inner {
  border-style: none;
  padding: 0
}
body [type=button]:-moz-focusring,
body [type=reset]:-moz-focusring,
body [type=submit]:-moz-focusring {
  outline: 1px dotted ButtonText
}
body [type=checkbox],
body [type=radio] {
  box-sizing: border-box;
  padding: 0
}
body [type=number]::-webkit-inner-spin-button,
body [type=number]::-webkit-outer-spin-button {
  height: auto
}
body [type=search] {
  -webkit-appearance: textfield;
  outline-offset: -2px
}
body [type=search]::-webkit-search-cancel-button,
body [type=search]::-webkit-search-decoration {
  -webkit-appearance: none
}
body ::-webkit-input-placeholder {
  color: inherit;
  opacity: .54
}
body ::-webkit-file-upload-button {
  -webkit-appearance: button;
  font: inherit
}
body a:hover {
  text-decoration: underline
}
body hr::before {
  display: table;
  content: ""
}
body hr::after {
  display: table;
  clear: both;
  content: ""
}
body table {
  border-spacing: 0;
  border-collapse: collapse;
  display: block;
  width: max-content;
  max-width: 100%;
  overflow: auto
}
body td,
body th {
  padding: 0
}
body details summary {
  cursor: pointer
}
body details:not([open]) > :not(summary) {
  display: none!important
}
body kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 11px ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
  line-height: 10px;
  color: #c9d1d9;
  vertical-align: middle;
  background-color: #161b22;
  border: solid 1px rgba(110,118,129,.4);
  border-bottom-color: rgba(110,118,129,.4);
  border-radius: 6px;
  box-shadow: inset 0 -1px 0 rgba(110,118,129,.4)
}

details > summary {
  font-weight: 600;
  font-size: 1.4em;
  padding-top: .1em;
}


body h1,
body h2,
body h3,
body h4,
body h5,
body h6 {
  margin-top: 24px;
  margin-bottom: 16px;
  font-weight: 600;
  line-height: 1.25
}
body h2 {
  font-weight: 600;
  font-size: 1.6em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h3 {
  font-weight: 600;
  font-size: 1.4em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h4 {
  font-weight: 600;
  font-size: 1.2em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h5 {
  font-weight: 600;
  font-size: 1.0em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h6 {
  font-weight: 600;
  font-size: 1em;
  color: #8b949e
}
body p {
  margin-top: 0;
  margin-bottom: 10px
}
body blockquote {
  margin: 0;
  padding: 0 1em;
  color: #8b949e;
  border-left: .25em solid #30363d
}
body ol,
body ul {
  margin-top: 0;
  margin-bottom: 0;
  padding-left: 2em
}
body ol ol,
body ul ol {
  list-style-type: lower-roman
}
body ol ol ol,
body ol ul ol,
body ul ol ol,
body ul ul ol {
  list-style-type: lower-alpha
}
body dd {
  margin-left: 0
}
body code,
body tt {
  font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
  font-size: 12px
}
body pre {
  margin-top: 0;
  margin-bottom: 0;
  font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
  font-size: 12px;
  word-wrap: normal
}
body :-ms-input-placeholder {
  color: #484f58;
  opacity: 1
}
body ::-ms-input-placeholder {
  color: #484f58;
  opacity: 1
}
body ::placeholder {
  color: #484f58;
  opacity: 1
}
body .pl-c {
  color: #8b949e
}
body .pl-c1,
body .pl-s .pl-v {
  color: #79c0ff
}
body .pl-e,
body .pl-en {
  color: #d2a8ff
}
body .pl-s .pl-s1,
body .pl-smi {
  color: #c9d1d9
}
body .pl-ent {
  color: #7ee787
}
body .pl-k {
  color: #ff7b72
}
body .pl-pds,
body .pl-s,
body .pl-s .pl-pse .pl-s1,
body .pl-sr,
body .pl-sr .pl-cce,
body .pl-sr .pl-sra,
body .pl-sr .pl-sre {
  color: #a5d6ff
}
body .pl-smw,
body .pl-v {
  color: #ffa657
}
body .pl-bu {
  color: #f85149
}
body .pl-ii {
  color: #f0f6fc;
  background-color: #8e1519
}
body .pl-c2 {
  color: #f0f6fc;
  background-color: #b62324
}
body .pl-sr .pl-cce {
  font-weight: 700;
  color: #7ee787
}
body .pl-ml {
  color: #f2cc60
}
body .pl-mh,
body .pl-mh .pl-en,
body .pl-ms {
  font-weight: 700;
  color: #1f6feb
}
body .pl-mi {
  font-style: italic;
  color: #c9d1d9
}
body .pl-mb {
  font-weight: 700;
  color: #c9d1d9
}
body .pl-md {
  color: #ffdcd7;
  background-color: #67060c
}
body .pl-mi1 {
  color: #aff5b4;
  background-color: #033a16
}
body .pl-mc {
  color: #ffdfb6;
  background-color: #5a1e02
}
body .pl-mi2 {
  color: #c9d1d9;
  background-color: #1158c7
}
body .pl-mdr {
  font-weight: 700;
  color: #d2a8ff
}
body .pl-ba {
  color: #8b949e
}
body .pl-sg {
  color: #484f58
}
body .pl-corl {
  text-decoration: underline;
  color: #a5d6ff
}
body [data-catalyst] {
  display: block
}
body g-emoji {
  font-family: "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
  font-size: 1em;
  font-style: normal!important;
  font-weight: 400;
  line-height: 1;
  vertical-align: -.075em
}
body g-emoji img {
  width: 1em;
  height: 1em
}
body::before {
  display: table;
  content: ""
}
body::after {
  display: table;
  clear: both;
  content: ""
}
body > :first-child {
  margin-top: 0!important
}
body > :last-child {
  margin-bottom: 0!important
}
body a:not([href]) {
  color: inherit;
  text-decoration: none
}
body .absent {
  color: #f85149
}
body .anchor {
  float: left;
  padding-right: 4px;
  margin-left: -20px;
  line-height: 1
}
body .anchor:focus {
  outline: 0
}
body blockquote,
body details,
body dl,
body ol,
body p,
body pre,
body table,
body ul {
  margin-top: 0;
  margin-bottom: 16px
}
body blockquote > :first-child {
  margin-top: 0
}
body blockquote > :last-child {
  margin-bottom: 0
}
body sup > a::before {
  content: "["
}
body sup > a::after {
  content: "]"
}
body h1 .octicon-link,
body h2 .octicon-link,
body h3 .octicon-link,
body h4 .octicon-link,
body h5 .octicon-link,
body h6 .octicon-link {
  color: #c9d1d9;
  vertical-align: middle;
  visibility: hidden
}
body h1:hover .anchor,
body h2:hover .anchor,
body h3:hover .anchor,
body h4:hover .anchor,
body h5:hover .anchor,
body h6:hover .anchor {
  text-decoration: none
}
body h1:hover .anchor .octicon-link,
body h2:hover .anchor .octicon-link,
body h3:hover .anchor .octicon-link,
body h4:hover .anchor .octicon-link,
body h5:hover .anchor .octicon-link,
body h6:hover .anchor .octicon-link {
  visibility: visible
}
body h1 code,
body h1 tt,
body h2 code,
body h2 tt,
body h3 code,
body h3 tt,
body h4 code,
body h4 tt,
body h5 code,
body h5 tt,
body h6 code,
body h6 tt {
  padding: 0 .2em;
  font-size: inherit
}
body ol.no-list,
body ul.no-list {
  padding: 0;
  list-style-type: none
}
body ol[type="1"] {
  list-style-type: decimal
}
body ol[type=a] {
  list-style-type: lower-alpha
}
body ol[type=i] {
  list-style-type: lower-roman
}
body div > ol:not([type]) {
  list-style-type: decimal
}
body ol ol,
body ol ul,
body ul ol,
body ul ul {
  margin-top: 0;
  margin-bottom: 0
}
body li > p {
  margin-top: 16px
}
body li + li {
  margin-top: .25em
}
body dl {
  padding: 0
}
body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: 600
}
body dl dd {
  padding: 0 16px;
  margin-bottom: 16px
}
body table th {
  font-weight: 600
}
body table td,
body table th {
  padding: 6px 13px;
  border: 1px solid #30363d
}
body table tr {
  background-color: #0d1117;
  border-top: 1px solid #21262d
}
body table tr:nth-child(2n) {
  background-color: #161b22
}
body table img {
  background-color: transparent
}
body img[align=right] {
  padding-left: 20px
}
body img[align=left] {
  padding-right: 20px
}
body .emoji {
  max-width: none;
  vertical-align: text-top;
  background-color: transparent
}
body span.frame {
  display: block;
  overflow: hidden
}
body span.frame > span {
  display: block;
  float: left;
  width: auto;
  padding: 7px;
  margin: 13px 0 0;
  overflow: hidden;
  border: 1px solid #30363d
}
body span.frame span img {
  display: block;
  float: left
}
body span.frame span span {
  display: block;
  padding: 5px 0 0;
  clear: both;
  color: #c9d1d9
}
body span.align-center {
  display: block;
  overflow: hidden;
  clear: both
}
body span.align-center > span {
  display: block;
  margin: 13px auto 0;
  overflow: hidden;
  text-align: center
}
body span.align-center span img {
  margin: 0 auto;
  text-align: center
}
body span.align-right {
  display: block;
  overflow: hidden;
  clear: both
}
body span.align-right > span {
  display: block;
  margin: 13px 0 0;
  overflow: hidden;
  text-align: right
}
body span.align-right span img {
  margin: 0;
  text-align: right
}
body span.float-left {
  display: block;
  float: left;
  margin-right: 13px;
  overflow: hidden
}
body span.float-left span {
  margin: 13px 0 0
}
body span.float-right {
  display: block;
  float: right;
  margin-left: 13px;
  overflow: hidden
}
body span.float-right > span {
  display: block;
  margin: 13px auto 0;
  overflow: hidden;
  text-align: right
}
body code,
body tt {
  padding: .2em .4em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(110,118,129,.4);
  border-radius: 6px
}
body code br,
body tt br {
  display: none
}
body del code {
  text-decoration: inherit
}
body pre code {
  font-size: 100%
}
body pre > code {
  padding: 0;
  margin: 0;
  word-break: normal;
  white-space: pre;
  background: 0 0;
  border: 0
}
body .highlight {
  margin-bottom: 16px
}
body .highlight pre {
  margin-bottom: 0;
  word-break: normal
}
body .highlight pre,
body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #161b22;
  border-radius: 6px
}
body pre code,
body pre tt {
  display: inline;
  max-width: auto;
  padding: 0;
  margin: 0;
  overflow: visible;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0
}
body .csv-data td,
body .csv-data th {
  padding: 5px;
  overflow: hidden;
  font-size: 12px;
  line-height: 1;
  text-align: left;
  white-space: nowrap
}
body .csv-data .blob-num {
  padding: 10px 8px 9px;
  text-align: right;
  background: #0d1117;
  border: 0
}
body .csv-data tr {
  border-top: 0
}
body .csv-data th {
  font-weight: 600;
  background: #161b22;
  border-top: 0
}
body .footnotes {
  font-size: 12px;
  color: #8b949e;
  border-top: 1px solid #30363d
}
body .footnotes ol {
  padding-left: 16px
}
body .footnotes li {
  position: relative
}
body .footnotes li:target::before {
  position: absolute;
  top: -8px;
  right: -8px;
  bottom: -8px;
  left: -24px;
  pointer-events: none;
  content: "";
  border: 2px solid #1f6feb;
  border-radius: 6px
}
body .footnotes li:target {
  color: #c9d1d9
}
body .footnotes .data-footnote-backref g-emoji {
  font-family: monospace
}
body [hidden] {
  display: none!important
}
body ::-webkit-calendar-picker-indicator {
  filter: invert(50%)
}

/* node_modules/highlight.js/styles/github-dark.css */
pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!
  Theme: GitHub Dark
  Description: Dark theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-dark
  Current colors taken from GitHub's CSS
*/.hljs{color:#c9d1d9;background:#0d1117}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#ff7b72}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#d2a8ff}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#79c0ff}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#a5d6ff}.hljs-built_in,.hljs-symbol{color:#ffa657}.hljs-code,.hljs-comment,.hljs-formula{color:#8b949e}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#7ee787}.hljs-subst{color:#c9d1d9}.hljs-section{color:#1f6feb;font-weight:700}.hljs-bullet{color:#f2cc60}.hljs-emphasis{color:#c9d1d9;font-style:italic}.hljs-strong{color:#c9d1d9;font-weight:700}.hljs-addition{color:#aff5b4;background-color:#033a16}.hljs-deletion{color:#ffdcd7;background-color:#67060c}

</style>
</head>
<body>
<div class="document">
<div class="header"></div><div class="inner">
<!-- HTML Header End -->
<!-- Header Start -->

<h1>x386.org: Debian and Ubuntu Documentation</h1>
<h4>| &ensp;<a href="index.html">Home</a>&ensp; |&ensp; <a href="about.html">About</a> &ensp;| &ensp;<a href="contact.html">Contact</a>&ensp; | &ensp;<a href="license.html">License</a>&ensp; | &ensp;<a href="privacy_policy.html">Privacy Policy</a>&ensp; |</h4>
<!-- Copyright Start -->
<details>
<summary>Copyright (C) 2020 - 2025 Exforge exforge@x386.org</summary>
<hr />
<p>This document is free text: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or any later version.</p>
<p>This document is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program.  If not, see: <a href="https://www.gnu.org/licenses/">www.gnu.org/licenses/</a>.</p>
<hr />
</details>
<!-- Copyright End -->

<!-- Header End -->
<h5>Postgresql Ubuntu</h5>
<h1>Postgresql Tutorial for Ubuntu</h1>
<details>
<summary>
0. Specs
</summary>
<hr />
<h3>0.1. The What</h3>
<p>PostgreSQL is a powerful, open-source relational database management system known for its reliability, feature robustness, and performance. It supports both SQL and non-SQL queries, making it versatile for various applications.</p>
<p>Debian 13 and Ubuntu 24.04 LTS Server include packages for different PostgreSQL versions (17 and 16). For ease of following tutorials, I've prepared separate guides for Debian and Ubuntu.</p>
<h3>0.2. The Environment</h3>
<p><strong>Server:</strong>
- Ubuntu 24.04 LTS Server 
- IP: 192.168.1.221</p>
<p><strong>Workstation:</strong>
- Ubuntu 24.04 LTS Server 
- IP: 192.168.1.182</p>
<h3>0.3. Resources</h3>
<ul>
<li><a href="https://www.postgresql.org/docs">www.postgresql.org</a></li>
<li><a href="https://www.postgresqltutorial.com">www.postgresqltutorial.com</a></li>
<li><strong>PostgreSQL 14 Administration Cookbook</strong> by Simon Riggs &amp; Gianni Ciolli</li>
<li><strong>Learn PostgreSQL</strong> by Luca Ferrari &amp; Enrico Pirozzi </li>
</ul>
<p><br></p>
</details>
<details>
<summary>
1. Introduction
</summary>
<hr />
<h3>1.1. Terminology:</h3>
<ul>
<li><strong>Cluster</strong>: A PostgreSQL Instance. Can contain multiple databases.</li>
<li><strong>Database</strong>: Accessed by authorized users. Can contain schemas (namespaces).</li>
<li><strong>Schema</strong>: Used for organizing database objects. Can contain database objects.</li>
<li><strong>Database Objects</strong>: Tables, functions, triggers, data types etc.</li>
</ul>
<h3>1.2. Basic Information</h3>
<p>All data and configuration information is stored in the PGDATA directory.</p>
<p>PostgreSQL supports the information schema but also maintains a catalog that provides more detailed information.</p>
<p><strong>Postmaster</strong>: The first PostgreSQL process, responsible for coordinating all other processes.</p>
<p><strong>WAL (Write Ahead Logs)</strong>: Database change logs used primarily for recovery.</p>
<h3>1.3. Software Components</h3>
<ul>
<li><strong>PostgreSQL server</strong>: The database server.</li>
<li><strong>PostgreSQL client</strong>: Client tools for interacting with the server.</li>
<li><strong>PostgreSQL contrib</strong>: Extensions and additional utilities.</li>
<li><strong>PostgreSQL docs</strong>: Documentation.</li>
<li><strong>PostgreSQL PL/Perl, PL/Python, and PL/Tcl</strong>: Programming language interfaces.</li>
</ul>
<p>The Ubuntu <code>postgresql</code> package installs <code>postgresql-client</code> by default.</p>
<p><br></p>
</details>
<details>
<summary>
2. Installation and Basic Management
</summary>
<hr />
<h3>2.1. Installation</h3>
<p>Update package repositories:</p>
<pre><code>sudo apt update
</code></pre>
<p>Install PostgreSQL (Ubuntu 24.04 installs version 16 by default):</p>
<pre><code>sudo apt install --yes postgresql
</code></pre>
<p>Check the service status:</p>
<pre><code>systemctl status postgresql
</code></pre>
<h3>2.2. Cluster Management</h3>
<p>Ubuntu allows running multiple clusters (instances) on a single server.</p>
<p>List clusters on the server:</p>
<pre><code>pg_lsclusters
</code></pre>
<p>Sample output:</p>
<pre><code>Ver Cluster Port Status Owner    Data directory              Log file
16  main    5432 online postgres /var/lib/postgresql/16/main /var/log/...
</code></pre>
<p>The "Ver" (Version) and "Cluster" values are important for the <code>pg_ctlcluster</code> command. In this case, they are <code>16</code> and <code>main</code>.</p>
<p><code>pg_ctlcluster</code> is a wrapper command for PostgreSQL's native <code>pg_ctl</code> command.</p>
<p>Check the status of a specific cluster:</p>
<pre><code>sudo pg_ctlcluster 16 main status
</code></pre>
<p>Start a cluster:</p>
<pre><code>sudo pg_ctlcluster 16 main start
</code></pre>
<p>Stop a cluster:</p>
<pre><code>sudo pg_ctlcluster 16 main stop
</code></pre>
<p>There are three stop modes:
- <code>smart</code>: Wait for connections to finish (graceful shutdown)
- <code>fast</code>: Stop all connections immediately (default)
- <code>immediate</code>: Force immediate shutdown (may cause database corruption)</p>
<pre><code>sudo pg_ctlcluster 16 main stop -m smart
sudo pg_ctlcluster 16 main stop -m fast
sudo pg_ctlcluster 16 main stop -m immediate
</code></pre>
<p>Restart or reload a cluster:</p>
<pre><code>sudo pg_ctlcluster 16 main restart
sudo pg_ctlcluster 16 main reload
</code></pre>
<h3>2.3. Adding and Deleting Clusters</h3>
<p>You can run multiple clusters on a single server. While this might seem unnecessary at first, it can be useful when different databases require separate administrators.</p>
<p>Currently, we only have the <code>main</code> cluster. Let's add a second one named <code>second</code>.</p>
<p>Create another PostgreSQL 16 cluster named <code>second</code>:</p>
<pre><code>sudo pg_createcluster 16 second
</code></pre>
<p>Start it:</p>
<pre><code>sudo pg_ctlcluster 16 second start
</code></pre>
<p>Create a third cluster and start it immediately:</p>
<pre><code>sudo pg_createcluster 16 third --start
</code></pre>
<p>Delete (drop) the third cluster:</p>
<pre><code>sudo pg_dropcluster 16 third --stop
</code></pre>
<p>Rename the <code>second</code> cluster to <code>secondary</code>:</p>
<pre><code>sudo pg_renamecluster 16 second secondary
</code></pre>
<p>List clusters again:</p>
<pre><code>pg_lsclusters
</code></pre>
<p>Sample output:</p>
<pre><code>Ver Cluster   Port Status Owner    Data directory                   Log file
16  main      5432 online postgres /var/lib/postgresql/16/main      /var/log/...
16  secondary 5433 online postgres /var/lib/postgresql/16/secondary /var/log/...
</code></pre>
<p>From this output, we can see:</p>
<ul>
<li>The <code>16-main</code> cluster listens on port 5432 (PostgreSQL's default port)</li>
<li>The <code>16-secondary</code> cluster listens on port 5433</li>
<li>Data directories are <code>/var/lib/postgresql/16/main/</code> and <code>/var/lib/postgresql/16/secondary/</code></li>
</ul>
<h3>2.4. Service vs Cluster Management</h3>
<p>PostgreSQL and its clusters can also be managed using <code>systemctl</code>.</p>
<p>Stop all PostgreSQL clusters:</p>
<pre><code>sudo systemctl stop postgresql
</code></pre>
<p>Stop only the <code>16-main</code> cluster:</p>
<pre><code>sudo systemctl stop postgresql@16-main
</code></pre>
<p>Other <code>systemctl</code> commands (<code>restart</code>, <code>enable</code>, <code>disable</code>, <code>reload</code>) work similarly.</p>
<h3>2.5. Login to Postgres shell</h3>
<p>After default installation, the <code>postgres</code> Linux user can log into the <code>psql</code> shell without password authentication:</p>
<pre><code>sudo -u postgres psql
</code></pre>
<p>Type <code>exit</code> to quit the PostgreSQL shell.</p>
<p>By default, you connect to the <code>16-main</code> cluster. To connect to the <code>16-secondary</code> cluster:</p>
<pre><code>sudo -u postgres psql -p 5433
</code></pre>
<p><br></p>
</details>
<details>
<summary>
3. User and Connection Management
</summary>
<hr />
<p>After installing PostgreSQL, only the <code>postgres</code> user can log into the <code>psql</code> shell via Linux authentication. No other users are defined, and remote connections are not allowed.</p>
<p>We'll implement a user management scenario.</p>
<h3>3.0. Backup Configuration Files</h3>
<pre><code>cd /etc/postgresql/16/main/
sudo cp postgresql.conf postgresql.conf.backup
sudo cp pg_hba.conf pg_hba.conf.backup
</code></pre>
<h3>3.1. Scenario</h3>
<ul>
<li>Leave the <code>postgres</code> user as is (will serve as the database administrator)</li>
<li>Create a database named <code>test1</code></li>
<li>Create a user (role) <code>rwuser</code> with read/write permissions on all <code>test1</code> tables, accessible only from IP <code>192.168.1.182</code></li>
<li>Create a user (role) <code>rouser</code> with read-only permissions on all <code>test1</code> tables, accessible from the network <code>192.168.1.0/24</code></li>
</ul>
<h3>3.2. Create Users</h3>
<p>Create users with passwords:</p>
<pre><code>sudo -u postgres createuser --pwprompt rwuser
sudo -u postgres createuser --pwprompt rouser
</code></pre>
<h3>3.3. Create the <code>test1</code> Database and Set Permissions</h3>
<p>Create the database:</p>
<pre><code>sudo -u postgres createdb test1
</code></pre>
<p>Create a sample table and populate it with data.</p>
<p>Connect to the <code>test1</code> database:</p>
<pre><code>sudo -u postgres psql test1
</code></pre>
<p>Run these commands in the <code>psql</code> shell:</p>
<pre><code>CREATE TABLE Employees (Name char(15), Age int, Occupation char(15));
INSERT INTO Employees VALUES ('Joe Smith', '26', 'Ninja');
GRANT ALL ON ALL TABLES IN SCHEMA public to rwuser;
GRANT SELECT ON ALL TABLES IN SCHEMA public to rouser;
\q
</code></pre>
<h3>3.4. Configure PostgreSQL to Allow Remote Connections</h3>
<p>Edit <code>postgresql.conf</code> to allow network connections:</p>
<pre><code>sudo nano /etc/postgresql/16/main/postgresql.conf
</code></pre>
<p>Uncomment and modify this line (around line 60):</p>
<pre><code>#listen_addresses = 'localhost'         # what IP address(es) to listen on;
</code></pre>
<p>Change it to:</p>
<pre><code>listen_addresses = '*'                  # what IP address(es) to listen on;
</code></pre>
<p>Edit <code>pg_hba.conf</code> to allow <code>rwuser</code> and <code>rouser</code> to connect from specified IPs/networks:</p>
<pre><code>sudo nano /etc/postgresql/16/main/pg_hba.conf
</code></pre>
<p>Add these lines to the file:</p>
<pre><code>host    test1           rwuser          192.168.1.182/32        scram-sha-256
host    test1           rouser          192.168.1.0/24          scram-sha-256
</code></pre>
<p>Restart the cluster:</p>
<pre><code>sudo pg_ctlcluster restart 16 main
</code></pre>
<h3>3.5. Connection Test from Workstation (192.168.1.182)</h3>
<p><strong>Note: Run these commands on the workstation!</strong></p>
<p>Install the PostgreSQL client on the workstation:</p>
<pre><code>sudo apt update
sudo apt install postgresql-client --yes    
</code></pre>
<p>Connect as <code>rwuser</code> and test data insertion (should succeed):</p>
<pre><code>psql -h 192.168.1.221 -U rwuser test1
</code></pre>
<p>In the <code>psql</code> shell:</p>
<pre><code>INSERT INTO Employees VALUES ('John Doe', '33', 'Kedi');
\q
</code></pre>
<p>Connect as <code>rouser</code> and test reading/inserting (reading should succeed, inserting should fail):</p>
<pre><code>psql -h 192.168.1.221 -U rouser test1
</code></pre>
<p>In the <code>psql</code> shell:</p>
<pre><code>SELECT * from Employees;
INSERT INTO Employees VALUES ('Halim Selim', '41', 'Hirsiz');
\q
</code></pre>
<p>If you try to connect from another workstation in the <code>192.168.1.0/24</code> network, you'll see that <code>rwuser</code> cannot connect while <code>rouser</code> can.</p>
<p><br></p>
</details>
<details>
<summary>
4. Backup and Restore 
</summary>
<hr />
<p>You can back up individual databases or entire clusters. When backing up a single database, cluster-wide data like users and roles are not included. Therefore, when restoring a database to another cluster, you must recreate users and permissions.</p>
<h3>4.0. Considerations</h3>
<p>We need to use the <code>postgres</code> user for backup and restore operations. When using <code>sudo</code> for this user, we should change to the <code>/tmp</code> directory because the <code>postgres</code> user doesn't have permission to write to our home directory.</p>
<h3>4.1. Backup a database</h3>
<p>Back up a database using <code>pg_dump</code>:</p>
<pre><code>pg_dump dbname &gt; dumpfile
</code></pre>
<p><code>pg_dump</code> uses the same connection parameters as <code>psql</code>.</p>
<p>Change to the <code>/tmp</code> directory:</p>
<pre><code>cd /tmp
</code></pre>
<p>Back up the <code>test1</code> database from the <code>16-main</code> cluster:</p>
<pre><code>sudo -u postgres pg_dump test1 &gt; /tmp/test1.pg
</code></pre>
<p>Back up the <code>postgres</code> database from the <code>16-secondary</code> cluster (specify port):</p>
<pre><code>sudo -u postgres pg_dump -p 5433 postgres &gt; /tmp/sdb.pg
</code></pre>
<h3>4.2. Restore a database</h3>
<p>Restore a database dump using <code>psql</code>:</p>
<pre><code>psql dbname &lt; dumpfile
</code></pre>
<p>Restore the <code>test1</code> database to the <code>16-main</code> cluster:</p>
<pre><code>sudo -u postgres psql test1 &lt; /tmp/test1.pg
</code></pre>
<p>Restore the <code>test1</code> database to the secondary cluster. First, create an empty <code>test1</code> database:</p>
<pre><code>sudo -u postgres createdb -p 5433 test1
</code></pre>
<p>Create <code>rwuser</code> and <code>rouser</code> on the secondary cluster (specify port 5433):</p>
<pre><code>sudo -u postgres createuser -p 5433 --pwprompt rwuser
sudo -u postgres createuser -p 5433 --pwprompt rouser
</code></pre>
<p>Import the database:</p>
<pre><code>sudo -u postgres psql -p 5433 test1 &lt; /tmp/test1.pg
</code></pre>
<h3>4.3. Backup and Restore Whole Cluster</h3>
<p>When backing up a cluster, all cluster-wide data including users and access rights are included. However, configuration files must be handled separately.</p>
<p>Back up a cluster using <code>pg_dumpall</code> (uses the same connection parameters as <code>psql</code>):</p>
<p>Back up the <code>16-main</code> cluster:</p>
<pre><code>sudo -u postgres pg_dumpall &gt; /tmp/main.pg
</code></pre>
<p>Restore to the <code>16-secondary</code> cluster:</p>
<pre><code>sudo -u postgres psql -p 5433 -f /tmp/main.pg
</code></pre>
<p><br></p>
</details>
<details>
<summary>
5. psql - PostgreSQL Shell
</summary>
<hr />
<h3>5.1. The Command</h3>
<p>The <code>psql</code> command opens a PostgreSQL shell. After a fresh installation, only the <code>postgres</code> Linux user can connect without authentication:</p>
<pre><code>sudo -u postgres psql
</code></pre>
<p>To allow other Linux users to log into <code>psql</code>, you would need to create them using <code>createuser</code> and add connection permissions in <code>pg_hba.conf</code>. In most of the cases, having one database administrator is sufficient.</p>
<h3>5.2. The command arguments</h3>
<p><code>psql</code> has many arguments. If no arguments are provided, it attempts to connect using the current Linux username as both the username and database name. For example, if my username is <code>exforge</code>:</p>
<pre><code>psql
</code></pre>
<p>I would receive an error:</p>
<pre><code>psql: error: connection to server on socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot;
failed: FATAL:  role &quot;exforge&quot; does not exist
</code></pre>
<p>Even if I create a role named <code>exforge</code>, I would get:</p>
<pre><code>psql: error: connection to server on socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot; failed: FATAL:  database &quot;exforge&quot; does not exist
</code></pre>
<p>Instead, connect to an existing database:</p>
<pre><code>psql postgres
</code></pre>
<p>You can specify:
- Port number with <code>-p</code>
- Host with <code>-h</code>
- Username with <code>-U</code></p>
<p>View all arguments:</p>
<pre><code>psql --help
</code></pre>
<h3>5.3. psql Commands</h3>
<p>You can run SQL commands in the <code>psql</code> shell, as well as <code>psql</code> meta-commands (prefixed with <code>\</code>):</p>
<ul>
<li><code>\x</code> - Toggle expanded display</li>
<li><code>\c</code> - Connect to a database</li>
<li><code>\d</code> - List tables</li>
<li><code>\du</code> - List roles (users)</li>
<li><code>\?</code> - Show psql command help</li>
</ul>
<p><br></p>
</details>
<details>
<summary>
6. Bonus: Postgres 16 and Postgres 17 together
</summary>
<hr />
<p>For testing purposes, we can install PostgreSQL 17 on the same server, allowing us to run clusters with different versions simultaneously.</p>
<p>Ubuntu 24.04 includes PostgreSQL 16 in its repositories. For PostgreSQL 17, we need to add a PPA.</p>
<h3>6.1. Add Postgresql PPA</h3>
<p>Add the repository key:</p>
<pre><code>curl -fSsL https://www.postgresql.org/media/keys/ACCC4CF8.asc \
    | gpg --dearmor \
    | sudo tee /usr/share/keyrings/postgresql.gpg &gt; /dev/null
</code></pre>
<p>Add the PPA:</p>
<pre><code>echo deb [arch=amd64,arm64,ppc64el \
    signed-by=/usr/share/keyrings/postgresql.gpg] \
    http://apt.postgresql.org/pub/repos/apt/ noble-pgdg main \
    | sudo tee -a /etc/apt/sources.list.d/postgresql.list
</code></pre>
<h3>6.2. Install PostgreSQL 17</h3>
<pre><code>sudo apt update
sudo apt install -y postgresql-17
</code></pre>
<h3>6.3. List Clusters</h3>
<pre><code>pg_lsclusters
</code></pre>
<p>Sample output (now with three clusters):</p>
<pre><code>Ver Cluster   Port Status Owner    Data directory                   Log file
16  main      5432 online postgres /var/lib/postgresql/16/main      /var/log/...
16  secondary 5433 online postgres /var/lib/postgresql/16/secondary /var/log/...
17  main      5434 online postgres /var/lib/postgresql/17/main      /var/log/...
</code></pre>
<h3>6.4. Connecting to the clusters with psql</h3>
<p>Connect to the first cluster (16-main, port 5432):</p>
<pre><code>sudo -u postgres psql -p 5432
</code></pre>
<p>Connect to the second cluster (16-secondary, port 5433):</p>
<pre><code>sudo -u postgres psql -p 5433
</code></pre>
<p>Connect to the third cluster (17-main, port 5434):</p>
<pre><code>sudo -u postgres psql -p 5434
</code></pre>
</details><!-- HTML Footer Start -->

</body>
</html>

<!-- HTML Footer End -->
