<!-- HTML Header Start -->
<!DOCTYPE html>
<html><head>
<title>x386.org: Debian and Ubuntu Documentation</title>
<meta charset="UTF-8">
 
 
 
 
 
 
<style>
/* base.css */
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 40px;
  border: 1px solid transparent;
}

body blockquote {
  background-color: initial;
}

body code {
  color: inherit;
}

body code > div {
  background: none;
}

body.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

body p,
body blockquote,
body ul,
body ol,
body dl,
body table,
body pre {
  margin-top: 16px;
  margin-bottom: 16px;
}

/* github-markdown.css */
body {
  color-scheme: dark;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  margin: 0;
  color: #c9d1d9;
  background-color: #0d1117;
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
  font-size: 16px;
  line-height: 1.5;
  word-wrap: break-word
}
body .octicon {
  display: inline-block;
  fill: currentColor;
  vertical-align: text-bottom
}
body h1:hover .anchor .octicon-link:before,
body h2:hover .anchor .octicon-link:before,
body h3:hover .anchor .octicon-link:before,
body h4:hover .anchor .octicon-link:before,
body h5:hover .anchor .octicon-link:before,
body h6:hover .anchor .octicon-link:before {
  width: 16px;
  height: 16px;
  content: ' ';
  display: inline-block;
  background-color: currentColor;
  -webkit-mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg>");
  mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' aria-hidden='true'><path fill-rule='evenodd' d='M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z'></path></svg>")
}
body details,
body figcaption,
body figure {
  display: block
}
body summary {
  display: list-item
}
body a {
  background-color: transparent;
  color: #58a6ff;
  text-decoration: none
}
body a:active,
body a:hover {
  outline-width: 0
}
body abbr[title] {
  border-bottom: none;
  -webkit-text-decoration: underline dotted;
  text-decoration: underline dotted
}
body b,
body strong {
  font-weight: 600
}
body dfn {
  font-style: italic
}
body h1 {
  margin: .67em 0;
  font-weight: 600;
  padding-bottom: .3em;
  font-size: 1.8em;
  border-bottom: 1px solid #21262d
}
body mark {
  background-color: #ff0;
  color: #c9d1d9
}
body small {
  font-size: 90%
}
body sub,
body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline
}
body sub {
  bottom: -.25em
}
body sup {
  top: -.5em
}
body img {
  border-style: none;
  max-width: 100%;
  box-sizing: content-box;
  background-color: #0d1117
}
body code,
body kbd,
body pre,
body samp {
  font-family: monospace,monospace;
  font-size: 1em
}
body figure {
  margin: 1em 40px
}
body hr {
  box-sizing: content-box;
  overflow: hidden;
  background: 0 0;
  border-bottom: 1px solid #21262d;
  height: .25em;
  padding: 0;
  margin: 24px 0;
  background-color: #30363d;
  border: 0
}
body [type=reset],
body [type=submit],
body html [type=button] {
  -webkit-appearance: button
}
body [type=button]::-moz-focus-inner,
body [type=reset]::-moz-focus-inner,
body [type=submit]::-moz-focus-inner {
  border-style: none;
  padding: 0
}
body [type=button]:-moz-focusring,
body [type=reset]:-moz-focusring,
body [type=submit]:-moz-focusring {
  outline: 1px dotted ButtonText
}
body [type=checkbox],
body [type=radio] {
  box-sizing: border-box;
  padding: 0
}
body [type=number]::-webkit-inner-spin-button,
body [type=number]::-webkit-outer-spin-button {
  height: auto
}
body [type=search] {
  -webkit-appearance: textfield;
  outline-offset: -2px
}
body [type=search]::-webkit-search-cancel-button,
body [type=search]::-webkit-search-decoration {
  -webkit-appearance: none
}
body ::-webkit-input-placeholder {
  color: inherit;
  opacity: .54
}
body ::-webkit-file-upload-button {
  -webkit-appearance: button;
  font: inherit
}
body a:hover {
  text-decoration: underline
}
body hr::before {
  display: table;
  content: ""
}
body hr::after {
  display: table;
  clear: both;
  content: ""
}
body table {
  border-spacing: 0;
  border-collapse: collapse;
  display: block;
  width: max-content;
  max-width: 100%;
  overflow: auto
}
body td,
body th {
  padding: 0
}
body details summary {
  cursor: pointer
}
body details:not([open]) > :not(summary) {
  display: none!important
}
body kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 11px ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
  line-height: 10px;
  color: #c9d1d9;
  vertical-align: middle;
  background-color: #161b22;
  border: solid 1px rgba(110,118,129,.4);
  border-bottom-color: rgba(110,118,129,.4);
  border-radius: 6px;
  box-shadow: inset 0 -1px 0 rgba(110,118,129,.4)
}

details > summary {
  font-weight: 600;
  font-size: 1.4em;
  padding-top: .1em;
}


body h1,
body h2,
body h3,
body h4,
body h5,
body h6 {
  margin-top: 24px;
  margin-bottom: 16px;
  font-weight: 600;
  line-height: 1.25
}
body h2 {
  font-weight: 600;
  font-size: 1.6em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h3 {
  font-weight: 600;
  font-size: 1.4em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h4 {
  font-weight: 600;
  font-size: 1.2em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h5 {
  font-weight: 600;
  font-size: 1.0em;
  border-top: 1px solid #21262d;
  padding-top: .2em;
}
body h6 {
  font-weight: 600;
  font-size: 1em;
  color: #8b949e
}
body p {
  margin-top: 0;
  margin-bottom: 10px
}
body blockquote {
  margin: 0;
  padding: 0 1em;
  color: #8b949e;
  border-left: .25em solid #30363d
}
body ol,
body ul {
  margin-top: 0;
  margin-bottom: 0;
  padding-left: 2em
}
body ol ol,
body ul ol {
  list-style-type: lower-roman
}
body ol ol ol,
body ol ul ol,
body ul ol ol,
body ul ul ol {
  list-style-type: lower-alpha
}
body dd {
  margin-left: 0
}
body code,
body tt {
  font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
  font-size: 12px
}
body pre {
  margin-top: 0;
  margin-bottom: 0;
  font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
  font-size: 12px;
  word-wrap: normal
}
body :-ms-input-placeholder {
  color: #484f58;
  opacity: 1
}
body ::-ms-input-placeholder {
  color: #484f58;
  opacity: 1
}
body ::placeholder {
  color: #484f58;
  opacity: 1
}
body .pl-c {
  color: #8b949e
}
body .pl-c1,
body .pl-s .pl-v {
  color: #79c0ff
}
body .pl-e,
body .pl-en {
  color: #d2a8ff
}
body .pl-s .pl-s1,
body .pl-smi {
  color: #c9d1d9
}
body .pl-ent {
  color: #7ee787
}
body .pl-k {
  color: #ff7b72
}
body .pl-pds,
body .pl-s,
body .pl-s .pl-pse .pl-s1,
body .pl-sr,
body .pl-sr .pl-cce,
body .pl-sr .pl-sra,
body .pl-sr .pl-sre {
  color: #a5d6ff
}
body .pl-smw,
body .pl-v {
  color: #ffa657
}
body .pl-bu {
  color: #f85149
}
body .pl-ii {
  color: #f0f6fc;
  background-color: #8e1519
}
body .pl-c2 {
  color: #f0f6fc;
  background-color: #b62324
}
body .pl-sr .pl-cce {
  font-weight: 700;
  color: #7ee787
}
body .pl-ml {
  color: #f2cc60
}
body .pl-mh,
body .pl-mh .pl-en,
body .pl-ms {
  font-weight: 700;
  color: #1f6feb
}
body .pl-mi {
  font-style: italic;
  color: #c9d1d9
}
body .pl-mb {
  font-weight: 700;
  color: #c9d1d9
}
body .pl-md {
  color: #ffdcd7;
  background-color: #67060c
}
body .pl-mi1 {
  color: #aff5b4;
  background-color: #033a16
}
body .pl-mc {
  color: #ffdfb6;
  background-color: #5a1e02
}
body .pl-mi2 {
  color: #c9d1d9;
  background-color: #1158c7
}
body .pl-mdr {
  font-weight: 700;
  color: #d2a8ff
}
body .pl-ba {
  color: #8b949e
}
body .pl-sg {
  color: #484f58
}
body .pl-corl {
  text-decoration: underline;
  color: #a5d6ff
}
body [data-catalyst] {
  display: block
}
body g-emoji {
  font-family: "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
  font-size: 1em;
  font-style: normal!important;
  font-weight: 400;
  line-height: 1;
  vertical-align: -.075em
}
body g-emoji img {
  width: 1em;
  height: 1em
}
body::before {
  display: table;
  content: ""
}
body::after {
  display: table;
  clear: both;
  content: ""
}
body > :first-child {
  margin-top: 0!important
}
body > :last-child {
  margin-bottom: 0!important
}
body a:not([href]) {
  color: inherit;
  text-decoration: none
}
body .absent {
  color: #f85149
}
body .anchor {
  float: left;
  padding-right: 4px;
  margin-left: -20px;
  line-height: 1
}
body .anchor:focus {
  outline: 0
}
body blockquote,
body details,
body dl,
body ol,
body p,
body pre,
body table,
body ul {
  margin-top: 0;
  margin-bottom: 16px
}
body blockquote > :first-child {
  margin-top: 0
}
body blockquote > :last-child {
  margin-bottom: 0
}
body sup > a::before {
  content: "["
}
body sup > a::after {
  content: "]"
}
body h1 .octicon-link,
body h2 .octicon-link,
body h3 .octicon-link,
body h4 .octicon-link,
body h5 .octicon-link,
body h6 .octicon-link {
  color: #c9d1d9;
  vertical-align: middle;
  visibility: hidden
}
body h1:hover .anchor,
body h2:hover .anchor,
body h3:hover .anchor,
body h4:hover .anchor,
body h5:hover .anchor,
body h6:hover .anchor {
  text-decoration: none
}
body h1:hover .anchor .octicon-link,
body h2:hover .anchor .octicon-link,
body h3:hover .anchor .octicon-link,
body h4:hover .anchor .octicon-link,
body h5:hover .anchor .octicon-link,
body h6:hover .anchor .octicon-link {
  visibility: visible
}
body h1 code,
body h1 tt,
body h2 code,
body h2 tt,
body h3 code,
body h3 tt,
body h4 code,
body h4 tt,
body h5 code,
body h5 tt,
body h6 code,
body h6 tt {
  padding: 0 .2em;
  font-size: inherit
}
body ol.no-list,
body ul.no-list {
  padding: 0;
  list-style-type: none
}
body ol[type="1"] {
  list-style-type: decimal
}
body ol[type=a] {
  list-style-type: lower-alpha
}
body ol[type=i] {
  list-style-type: lower-roman
}
body div > ol:not([type]) {
  list-style-type: decimal
}
body ol ol,
body ol ul,
body ul ol,
body ul ul {
  margin-top: 0;
  margin-bottom: 0
}
body li > p {
  margin-top: 16px
}
body li + li {
  margin-top: .25em
}
body dl {
  padding: 0
}
body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: 600
}
body dl dd {
  padding: 0 16px;
  margin-bottom: 16px
}
body table th {
  font-weight: 600
}
body table td,
body table th {
  padding: 6px 13px;
  border: 1px solid #30363d
}
body table tr {
  background-color: #0d1117;
  border-top: 1px solid #21262d
}
body table tr:nth-child(2n) {
  background-color: #161b22
}
body table img {
  background-color: transparent
}
body img[align=right] {
  padding-left: 20px
}
body img[align=left] {
  padding-right: 20px
}
body .emoji {
  max-width: none;
  vertical-align: text-top;
  background-color: transparent
}
body span.frame {
  display: block;
  overflow: hidden
}
body span.frame > span {
  display: block;
  float: left;
  width: auto;
  padding: 7px;
  margin: 13px 0 0;
  overflow: hidden;
  border: 1px solid #30363d
}
body span.frame span img {
  display: block;
  float: left
}
body span.frame span span {
  display: block;
  padding: 5px 0 0;
  clear: both;
  color: #c9d1d9
}
body span.align-center {
  display: block;
  overflow: hidden;
  clear: both
}
body span.align-center > span {
  display: block;
  margin: 13px auto 0;
  overflow: hidden;
  text-align: center
}
body span.align-center span img {
  margin: 0 auto;
  text-align: center
}
body span.align-right {
  display: block;
  overflow: hidden;
  clear: both
}
body span.align-right > span {
  display: block;
  margin: 13px 0 0;
  overflow: hidden;
  text-align: right
}
body span.align-right span img {
  margin: 0;
  text-align: right
}
body span.float-left {
  display: block;
  float: left;
  margin-right: 13px;
  overflow: hidden
}
body span.float-left span {
  margin: 13px 0 0
}
body span.float-right {
  display: block;
  float: right;
  margin-left: 13px;
  overflow: hidden
}
body span.float-right > span {
  display: block;
  margin: 13px auto 0;
  overflow: hidden;
  text-align: right
}
body code,
body tt {
  padding: .2em .4em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(110,118,129,.4);
  border-radius: 6px
}
body code br,
body tt br {
  display: none
}
body del code {
  text-decoration: inherit
}
body pre code {
  font-size: 100%
}
body pre > code {
  padding: 0;
  margin: 0;
  word-break: normal;
  white-space: pre;
  background: 0 0;
  border: 0
}
body .highlight {
  margin-bottom: 16px
}
body .highlight pre {
  margin-bottom: 0;
  word-break: normal
}
body .highlight pre,
body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #161b22;
  border-radius: 6px
}
body pre code,
body pre tt {
  display: inline;
  max-width: auto;
  padding: 0;
  margin: 0;
  overflow: visible;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0
}
body .csv-data td,
body .csv-data th {
  padding: 5px;
  overflow: hidden;
  font-size: 12px;
  line-height: 1;
  text-align: left;
  white-space: nowrap
}
body .csv-data .blob-num {
  padding: 10px 8px 9px;
  text-align: right;
  background: #0d1117;
  border: 0
}
body .csv-data tr {
  border-top: 0
}
body .csv-data th {
  font-weight: 600;
  background: #161b22;
  border-top: 0
}
body .footnotes {
  font-size: 12px;
  color: #8b949e;
  border-top: 1px solid #30363d
}
body .footnotes ol {
  padding-left: 16px
}
body .footnotes li {
  position: relative
}
body .footnotes li:target::before {
  position: absolute;
  top: -8px;
  right: -8px;
  bottom: -8px;
  left: -24px;
  pointer-events: none;
  content: "";
  border: 2px solid #1f6feb;
  border-radius: 6px
}
body .footnotes li:target {
  color: #c9d1d9
}
body .footnotes .data-footnote-backref g-emoji {
  font-family: monospace
}
body [hidden] {
  display: none!important
}
body ::-webkit-calendar-picker-indicator {
  filter: invert(50%)
}

/* node_modules/highlight.js/styles/github-dark.css */
pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!
  Theme: GitHub Dark
  Description: Dark theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-dark
  Current colors taken from GitHub's CSS
*/.hljs{color:#c9d1d9;background:#0d1117}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#ff7b72}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#d2a8ff}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#79c0ff}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#a5d6ff}.hljs-built_in,.hljs-symbol{color:#ffa657}.hljs-code,.hljs-comment,.hljs-formula{color:#8b949e}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#7ee787}.hljs-subst{color:#c9d1d9}.hljs-section{color:#1f6feb;font-weight:700}.hljs-bullet{color:#f2cc60}.hljs-emphasis{color:#c9d1d9;font-style:italic}.hljs-strong{color:#c9d1d9;font-weight:700}.hljs-addition{color:#aff5b4;background-color:#033a16}.hljs-deletion{color:#ffdcd7;background-color:#67060c}

</style>
</head>
<body>
<div class="document">
<div class="header"></div><div class="inner">
<!-- HTML Header End -->
<!-- Header Start -->

<h1>x386.org: Debian and Ubuntu Documentation</h1>
<h4>| &ensp;<a href="index.html">Home</a>&ensp; |&ensp; <a href="about.html">About</a> &ensp;| &ensp;<a href="contact.html">Contact</a>&ensp; | &ensp;<a href="license.html">License</a>&ensp; | &ensp;<a href="privacy_policy.html">Privacy Policy</a>&ensp; |</h4>
<!-- Copyright Start -->
<details>
<summary>Copyright (C) 2020 - 2025 Exforge exforge@x386.org</summary>
<hr />
<p>This document is free text: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or any later version.</p>
<p>This document is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program.  If not, see: <a href="https://www.gnu.org/licenses/">www.gnu.org/licenses/</a>.</p>
<hr />
</details>
<!-- Copyright End -->

<!-- Header End -->
<h5>LVM</h5>
<h1>Logical Volume Manager on Debian and Ubuntu Server</h1>
<details>
<summary>
0. Specs
</summary>
<hr />
<h3>0.1. The What</h3>
<p>Logical Volume Manager (LVM) is a powerful tool for managing disk storage in Linux. It allows system administrators to create, resize, and manage disk partitions more flexibly than traditional partitioning methods.</p>
<p>LVM enables features such as volume resizing, snapshot creation, and effective management of multiple physical storage devices.</p>
<p><strong>Note:</strong> For optimal use, LVM should be configured during OS installation. This allows LVM to manage nearly all disk space (except the boot partition, which cannot be in LVM).</p>
<p>It is also possible to install the OS without LVM and add it later. However, to use LVM for the <code>/</code> (root) partition, it must be set up during OS installation.</p>
<p>If the OS was installed without LVM, you can install the LVM package as follows:</p>
<pre><code>sudo apt update
sudo apt -y install lvm2
</code></pre>
<h3>0.2. Environment</h3>
<p>Tested on the following distributions:</p>
<ul>
<li>Debian 12</li>
<li>Debian 13</li>
<li>Ubuntu 22.04 LTS Server</li>
<li>Ubuntu 24.04 LTS Server</li>
</ul>
<h3>0.3. Sources</h3>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_logical_volumes/index">Red Hat Documentation</a>  </li>
<li><a href="https://www.deepseek.com/">Deepseek</a></li>
<li><a href="https://chatgpt.com/">ChatGPT</a></li>
</ul>
<p><br></p>
</details>
<details>
<summary>
1. Layers of LVM
</summary>
<hr />
<h3>1.0. Abstract</h3>
<p>LVM is structured in three layers:</p>
<ol>
<li><strong>Physical Volumes (PV)</strong> – Created from disks or partitions.</li>
<li><strong>Volume Groups (VG)</strong> – Formed by combining PVs.</li>
<li><strong>Logical Volumes (LV)</strong> – Defined within VGs.</li>
</ol>
<h3>1.1. Physical Volumes (PV)</h3>
<p>Storage devices or partitions used by LVM as building blocks. These can be:</p>
<ul>
<li>A complete hard drive</li>
<li>A disk partition</li>
<li>A RAID array</li>
</ul>
<h3>1.2. Volume Groups (VG)</h3>
<p>Collections of one or more physical volumes. VGs act as a storage pool, aggregating space from multiple PVs. Logical volumes are created within volume groups.</p>
<h3>1.3. Logical Volumes (LV)</h3>
<p>Abstract representations of a portion of a volume group, similar to partitions in traditional disk management. LVs can be resized and moved without affecting stored data.</p>
<p>There are six main types of logical volumes:</p>
<h4>1.3.1. Linear Logical Volume</h4>
<p>The default logical volume type. Data is stored sequentially.</p>
<h4>1.3.2. Mirrored Logical Volume</h4>
<p>Provides data redundancy by maintaining multiple copies (mirrors) of the data. Offers fault tolerance: if one mirror fails, the others remain usable.</p>
<h4>1.3.3. Snapshot Logical Volume</h4>
<p>Creates a point-in-time copy (snapshot) of an existing logical volume. Useful for backups or creating consistent volume images for testing.</p>
<h4>1.3.4. Thin Logical Volume</h4>
<p>Enables efficient storage allocation through thin provisioning. Space is allocated only as needed, allowing more flexible use of storage resources.</p>
<h4>1.3.5. Cache Logical Volume</h4>
<p>Used to cache data for another logical volume, improving performance. Typically used with SSDs to cache data from slower spinning disks.</p>
<h4>1.3.6. Striped Logical Volume</h4>
<p>Stripes data evenly across multiple physical volumes to enhance I/O performance. Allows parallel read and write operations.</p>
<p><br></p>
</details>
<details>
<summary>
2. Physical Volume Commands
</summary>
<hr />
<h3>2.1. pvs</h3>
<p>Displays physical volume information in a configurable format, showing one line per physical volume.</p>
<pre><code>sudo pvs
sudo pvs /dev/sdb
</code></pre>
<h3>2.2. pvscan</h3>
<p>Scans all supported LVM block devices for physical volumes.</p>
<pre><code>sudo pvscan
</code></pre>
<p>Locates and identifies physical volumes on the system and updates the LVM metadata cache.</p>
<h3>2.3. pvdisplay</h3>
<p>Provides a verbose multi-line output for each physical volume.</p>
<pre><code>sudo pvdisplay
sudo pvdisplay /dev/sdb
</code></pre>
<p>Display a mapping of physical extents to corresponding logical volumes:</p>
<pre><code>sudo pvdisplay -m /dev/sdb
</code></pre>
<h3>2.4. pvcreate</h3>
<p>Initializes a physical volume for use by LVM.</p>
<pre><code>sudo pvcreate /dev/sdb
sudo pvcreate /dev/sdb1
</code></pre>
<p><strong>Warning:</strong> Ensure the device or partition is not in use, as it will be erased.</p>
<p>After initialization, you can create or extend volume groups using <code>vgcreate</code> or <code>vgextend</code>, respectively.</p>
<h3>2.5. pvremove</h3>
<p>Removes LVM metadata from a physical volume.</p>
<pre><code>sudo pvremove /dev/sdb
sudo pvremove /dev/sdb1
</code></pre>
<p><strong>Warning:</strong> Ensure you are not removing a PV that is still in use. Remove any associated logical volumes and volume groups before running <code>pvremove</code>.</p>
<p>After removal, the device or partition can be repurposed (e.g., for a new partition or filesystem).</p>
<h3>2.6. pvmove</h3>
<p>Moves allocated physical extents from one physical volume to another within the same volume group.</p>
<p>Move all data from <code>/dev/sda1</code> to <code>/dev/sdb1</code> (both must be in the same VG):</p>
<pre><code>sudo pvmove /dev/sda1 /dev/sdb1
</code></pre>
<h3>2.7. pvresize</h3>
<p>Resizes a physical volume.</p>
<pre><code>sudo pvresize /dev/sdb1
</code></pre>
<p>Used when the underlying block device has been resized.</p>
<h3>2.8. pvchange</h3>
<p>Changes properties (allocatable, UUID, tags, etc.) of a physical volume.</p>
<p>Make <code>/dev/sdb1</code> allocatable:</p>
<pre><code>sudo pvchange -x y /dev/sdb1
</code></pre>
<p>Deactivate (disable) the physical volume in verbose mode:</p>
<pre><code>sudo pvchange -x y /dev/sdb1
</code></pre>
<h3>2.9. pvck</h3>
<p>Checks and repairs LVM metadata on physical volumes.</p>
<p>Check a PV:</p>
<pre><code>sudo pvck /dev/sdb1
</code></pre>
<p><br></p>
</details>
<details>
<summary>
3. Volume Group Commands
</summary>
<hr />
<h3>3.1. vgs</h3>
<p>This command provides volume group information in a configurable form, displaying one line per volume group.</p>
<pre><code>sudo vgs
sudo vgs myvg
</code></pre>
<h3>3.2. vgscan</h3>
<p>Scans all supported LVM block devices in the system for volume groups and updates the LVM metadata cache.</p>
<pre><code>sudo vgscan
</code></pre>
<h3>3.3. vgdisplay</h3>
<p>Displays volume group properties such as size, extents, number of physical volumes, and other details in a fixed format.</p>
<pre><code>sudo vgdisplay
sudo vgdisplay myvg
</code></pre>
<h3>3.4. vgcreate</h3>
<p>Creates a new volume group.</p>
<p>Create a new volume group named <code>myvg</code> using the physical volume <code>/dev/sdb1</code>:</p>
<pre><code>sudo vgcreate myvg /dev/sdb1
</code></pre>
<p><strong>Prerequisite:</strong> The specified physical volumes must be initialized with <code>pvcreate</code>.</p>
<p><strong>Note:</strong> Volume group names are case-sensitive. The new volume group's total capacity will be the sum of the capacities of the specified physical volumes. After creation, you can proceed to create logical volumes within it.</p>
<h3>3.5. vgextend</h3>
<p>Adds physical volumes to an existing volume group.</p>
<p>Add physical volume <code>/dev/sdb2</code> to the volume group <code>myvg</code>:</p>
<pre><code>sudo vgextend myvg /dev/sdb2
</code></pre>
<p><strong>Prerequisite:</strong> The physical volumes to be added must already be initialized using <code>pvcreate</code>. After extending a volume group, you can use the additional space to extend existing logical volumes or create new ones.</p>
<h3>3.6. vgreduce</h3>
<p>Removes one or more physical volumes from a volume group.</p>
<p>Remove <code>/dev/sdb2</code> from volume group <code>myvg</code>:</p>
<pre><code>sudo vgreduce myvg /dev/sdb1
</code></pre>
<p><strong>Note:</strong> You must first ensure the PV contains no allocated extents (use <code>pvmove</code> to relocate data). Otherwise, the command will fail unless forced, which can lead to data loss.</p>
<h3>3.7. vgremove</h3>
<p>Removes a volume group.</p>
<pre><code>sudo vgremove myvg
</code></pre>
<p><strong>Prerequisites:</strong> You must first remove all logical volumes within the volume group using <code>lvremove</code>. Also, ensure any filesystems mounted from those logical volumes are unmounted. After removal, the physical volumes become unallocated and can be repurposed.</p>
<h3>3.8. vgchange</h3>
<p>Changes the attributes of a volume group.</p>
<p>Activate (enable) the volume group <code>myvg</code>:</p>
<pre><code>sudo vgchange -a y myvg
</code></pre>
<p><em>( <code>-a y</code> activates; <code>-a n</code> deactivates the volume group.)</em></p>
<h3>3.9. vgrename</h3>
<p>Renames a volume group.</p>
<pre><code>sudo vgrename oldvg newvg
</code></pre>
<h3>3.10. vgck</h3>
<p>Checks the consistency of volume group metadata.</p>
<pre><code>sudo vgck
</code></pre>
<p>The <code>--updatemetadata</code> flag rewrites VG metadata to correct inconsistencies:</p>
<pre><code>sudo vgck --updatemetadata myvg -v
</code></pre>
<h3>3.11. Other Commands</h3>
<ul>
<li><code>vgcfgbackup</code>: Backs up volume group configurations.</li>
<li><code>vgcfgrestore</code>: Restores volume group configuration.</li>
<li><code>vgconvert</code>: Changes volume group metadata format.</li>
<li><code>vgexport</code>: Unregisters volume group(s) from the system.</li>
<li><code>vgimport</code>: Registers an exported volume group with the system.</li>
<li><code>vgimportclone</code>: Imports a VG from cloned PVs.</li>
<li><code>vgmerge</code>: Merges volume groups.</li>
<li><code>vgmknodes</code>: Creates the special device files for volume groups in <code>/dev</code>.</li>
<li><code>vgsplit</code>: Moves PVs into a new or existing volume group.</li>
</ul>
<p><br></p>
</details>
<details>
<summary>
4. Logical Volume Commands
</summary>
<hr />
<h3>4.1. lvs</h3>
<p>Provides logical volume information in a configurable form, displaying one line per logical volume.</p>
<pre><code>sudo lvs
sudo lvs /dev/vg_name/lv_name
sudo lvs /dev/myvg/mylv
</code></pre>
<p>To list all LVs in a specific VG:</p>
<pre><code>sudo lvs /dev/vg_name
sudo lvs /dev/myvg
</code></pre>
<h3>4.2. lvscan</h3>
<p>Scans for and lists all logical volumes in the system.</p>
<pre><code>sudo lvscan
</code></pre>
<h3>4.3. lvdisplay</h3>
<p>Displays logical volume properties, such as size, layout, and mapping, in a fixed format.</p>
<pre><code>sudo lvdisplay
sudo lvdisplay myvg/mylv
</code></pre>
<p>To display sizes in megabytes:</p>
<pre><code>sudo lvdisplay --unit m myvg/mylv
</code></pre>
<h3>4.4. lvcreate</h3>
<p>Creates a new logical volume within a volume group.</p>
<p>Create a new LV named <code>mylv</code> in the <code>myvg</code> volume group with a size of 11 GB:</p>
<pre><code>sudo lvcreate -L 11G -n mylv myvg
</code></pre>
<p>Format the newly created logical volume:</p>
<pre><code>sudo mkfs -t ext4 /dev/myvg/mylv
</code></pre>
<p>Mount it:</p>
<pre><code>sudo mkdir /mnt/point
sudo mount /dev/myvg/mylv /mnt/point
</code></pre>
<p>Unmount it:</p>
<pre><code>sudo umount /mnt/point
</code></pre>
<h3>4.5. lvextend</h3>
<p>Extends the size of a logical volume.</p>
<p>Extend the <code>mylv</code> logical volume by 2 GB:</p>
<pre><code>sudo lvextend -L +2G myvg/mylv
</code></pre>
<p>Resize the filesystem to use the new space:</p>
<pre><code>sudo resize2fs /dev/myvg/mylv
</code></pre>
<p><strong>Note:</strong> <code>resize2fs</code> may require a clean filesystem. If prompted, run <code>sudo e2fsck -f /dev/myvg/mylv</code> first.</p>
<p>For XFS filesystems, use <code>xfs_growfs</code> instead of <code>resize2fs</code>.</p>
<h3>4.6. lvreduce</h3>
<p>Reduces the size of a logical volume.</p>
<p>Reduce the logical volume mylv in the volume group myvg by 1 GB:</p>
<pre><code>sudo lvreduce -L -1G myvg/mylv
</code></pre>
<p>Resize the file system (you may need to unmount the LV)</p>
<pre><code>sudo resize2fs /dev/myvg/mylv
</code></pre>
<h3>4.7. lvremove</h3>
<p>Removes a logical volume.</p>
<p>Remove the logical volume <code>mylv</code> in the volume group <code>myvg</code>:</p>
<pre><code>sudo lvremove myvg/mylv
</code></pre>
<p><strong>Warning:</strong> This action is irreversible and will permanently destroy all data on the logical volume. Ensure any filesystems mounted from it are unmounted first.</p>
<h3>4.8. lvchange</h3>
<p>Changes the attributes and status of a logical volume, such as activation state or permission flags.</p>
<p>Deactivate the logical volume <code>mylv</code> in the volume group <code>myvg</code>:</p>
<pre><code>sudo lvchange -a n myvg/mylv
</code></pre>
<p>Activate it:</p>
<pre><code>sudo lvchange -a y myvg/mylv
</code></pre>
<p>Set the logical volume to read-only:</p>
<pre><code>sudo lvchange -p r myvg/mylv
</code></pre>
<p>Set it back to read/write:</p>
<pre><code>sudo lvchange -p rw myvg/mylv
</code></pre>
<h3>4.9. lvrename</h3>
<p>Renames a logical volume.</p>
<pre><code>sudo lvrename myvg mylv mynewlv2
</code></pre>
<h3>4.10. Other Commands</h3>
<ul>
<li><code>lvconvert</code>: Changes logical volume layout (e.g., to/from mirrored, snapshot).</li>
<li><code>lvresize</code>: A combined command that can extend or reduce a logical volume (use with the same caution as <code>lvreduce</code>).</li>
</ul>
<p><br></p>
</details>
<details>
<summary>
5. Case Study 1 - Installing LVM and Manipulating Disks, PVs, VGs, LVs
</summary>
<hr />
<h3>5.0. Specs</h3>
<p>We have a system installed without LVM. </p>
<ul>
<li>Add a 20 GB disk and use it as a LV.</li>
<li>Add a 30 GB disk and extend the LV.</li>
<li>Add a 50 GB disk, extend the VG and move data to this disk.</li>
<li>Remove 20 GB and 30 GB disks.</li>
</ul>
<p><strong>The steps:</strong></p>
<ol>
<li>Install LVM.</li>
<li>Add a 20 GB disk.</li>
<li>Create a PV from the disk.</li>
<li>Create a VG from the PV.</li>
<li>Create an LV within the VG.</li>
<li>Create a filesystem on the LV.</li>
<li>Mount the filesystem.</li>
<li>Add a 30 GB disk.</li>
<li>Create a PV from the 2nd disk.</li>
<li>Extend the VG with this PV.</li>
<li>Extend the LV.</li>
<li>Extend the filesystem.</li>
<li>Add a 50 GB disk.</li>
<li>Create a PV from the 3rd disk.</li>
<li>Extend the VG with this PV.</li>
<li>Move data from the 20 GB and 30 GB disks to the 50 GB disk.</li>
<li>Remove the 20 GB and 30 GB disks as PVs.</li>
<li>Physically remove the 20 GB and 30 GB disks and verify everything works.</li>
</ol>
<h3>5.1. Install LVM Packages</h3>
<pre><code>sudo apt update
sudo apt -y install lvm2
</code></pre>
<h3>5.2. Add 20 GB Disk</h3>
<p>Output of <code>lsblk -i</code> command before adding the disk:</p>
<pre><code>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part [SWAP]
</code></pre>
<p><strong>For physical servers</strong>, you need to add the disk to the hardware. <strong>For virtual servers</strong>, you need to define it and attach it to the VM.</p>
<p>I'm adding a 20 GB disk to my VM.</p>
<p>Output of the <code>lsblk -i</code> command after adding the disk:</p>
<pre><code>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part [SWAP]
sdb      8:16   0   20G  0 disk 
</code></pre>
<p>This means my new disk is <code>/dev/sdb</code>. <strong>In the following steps, change <code>/dev/sdb</code> to your actual disk device name.</strong></p>
<h3>5.3. Create a PV from the Disk</h3>
<p>Mark <code>/dev/sdb</code> as a Physical Volume:</p>
<pre><code>sudo pvcreate /dev/sdb
</code></pre>
<h3>5.4. Create a VG from the PV</h3>
<p>Create a Volume Group named <code>myvg</code> using <code>/dev/sdb</code>:</p>
<pre><code>sudo vgcreate myvg /dev/sdb
</code></pre>
<h3>5.5. Create a LV within the VG</h3>
<p>Create the Logical Volume using the maximum available space and name it <code>mylv</code>:</p>
<pre><code>sudo lvcreate -l +100%FREE -n mylv myvg
</code></pre>
<h3>5.6. Create a Filesystem in the LV</h3>
<p>Format it as Ext4:</p>
<pre><code>sudo mkfs -t ext4 /dev/myvg/mylv
</code></pre>
<h3>5.7. Mount the FS</h3>
<p>Create a mount point:</p>
<pre><code>sudo mkdir /mnt/mylv
</code></pre>
<p>Mount <code>mylv</code> to the mount point <code>/mnt/mylv</code>:</p>
<pre><code>sudo mount /dev/myvg/mylv /mnt/mylv
</code></pre>
<p>To make the mount persistent, add it to <code>/etc/fstab</code>:</p>
<pre><code>sudo nano /etc/fstab
</code></pre>
<p>Add this line to the end of the file:</p>
<pre><code>/dev/myvg/mylv    /mnt/mylv    ext4    defaults    0 0
</code></pre>
<p>Check with <code>lsblk</code>:</p>
<pre><code>lsblk -i
</code></pre>
<p>Output:</p>
<pre><code>NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda           8:0    0 22.9G  0 disk 
|-sda1        8:1    0   22G  0 part /
|-sda2        8:2    0    1K  0 part 
`-sda5        8:5    0  976M  0 part [SWAP]
sdb           8:16   0   20G  0 disk 
`-myvg-mylv 254:0    0   20G  0 lvm  /mnt/mylv
</code></pre>
<p>Check with <code>df -h</code>:</p>
<pre><code>df -h
</code></pre>
<p>Output:</p>
<pre><code>Filesystem             Size  Used Avail Use% Mounted on
udev                   457M     0  457M   0% /dev
tmpfs                   97M  544K   96M   1% /run
/dev/sda1               22G  1.8G   19G   9% /
tmpfs                  481M     0  481M   0% /dev/shm
tmpfs                  5.0M     0  5.0M   0% /run/lock
/dev/mapper/myvg-mylv   20G   44K   19G   1% /mnt/mylv
tmpfs                   97M     0   97M   0% /run/user/1000
</code></pre>
<p><strong>Create some large files in the filesystem:</strong></p>
<p>Create a directory for files:</p>
<pre><code>sudo mkdir /mnt/mylv/tmp
</code></pre>
<p>Make it writable for everyone:</p>
<pre><code>sudo chmod 777 /mnt/mylv/tmp
</code></pre>
<p>Create 3 files of 500 MB each:</p>
<pre><code>&lt; /dev/urandom tr -dc &quot;[:space:][:print:]&quot; | head -c500M &gt; /mnt/mylv/tmp/file1
&lt; /dev/urandom tr -dc &quot;[:space:][:print:]&quot; | head -c500M &gt; /mnt/mylv/tmp/file2
&lt; /dev/urandom tr -dc &quot;[:space:][:print:]&quot; | head -c500M &gt; /mnt/mylv/tmp/file3
</code></pre>
<p>Check the contents:</p>
<pre><code>ls -al /mnt/mylv/tmp
</code></pre>
<h3>5.8. Add 30 GB Disk</h3>
<p>I'm adding a 30 GB disk to my VM.</p>
<p>Output of <code>lsblk -i</code> after adding the disk:</p>
<pre><code>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda           8:0    0 22.9G  0 disk 
|-sda1        8:1    0   22G  0 part /
|-sda2        8:2    0    1K  0 part 
`-sda5        8:5    0  976M  0 part [SWAP]
sdb           8:16   0   20G  0 disk 
`-myvg-mylv 254:0    0   20G  0 lvm  /mnt/mylv
sdc           8:32   0   30G  0 disk 
</code></pre>
<p>This means my new disk is <code>/dev/sdc</code>. <strong>Change <code>/dev/sdc</code> to your actual disk device name in the following steps.</strong></p>
<h3>5.9. Create a PV from the Second Disk</h3>
<p>Mark <code>/dev/sdc</code> as a Physical Volume:</p>
<pre><code>sudo pvcreate /dev/sdc
</code></pre>
<h3>5.10. Extend the VG with This PV</h3>
<p>Add <code>/dev/sdc</code> to the Volume Group <code>myvg</code>:</p>
<pre><code>sudo vgextend myvg /dev/sdc
</code></pre>
<h3>5.11. Extend the LV</h3>
<p>Extend the <code>mylv</code> Logical Volume to use all available free space:</p>
<pre><code>sudo lvextend -l +100%FREE  myvg/mylv
</code></pre>
<h3>5.12. Extend the Filesystem</h3>
<p>Resize the filesystem to use the new space:</p>
<pre><code>sudo resize2fs /dev/myvg/mylv
</code></pre>
<p>Check the new size with <code>df -h</code>:</p>
<pre><code>df -h
</code></pre>
<p>Output:</p>
<pre><code>Filesystem             Size  Used Avail Use% Mounted on
udev                   457M     0  457M   0% /dev
tmpfs                   97M  548K   96M   1% /run
/dev/sda1               22G  3.2G   18G  16% /
tmpfs                  481M     0  481M   0% /dev/shm
tmpfs                  5.0M     0  5.0M   0% /run/lock
/dev/mapper/myvg-mylv   50G  1.5G   46G   4% /mnt/mylv
</code></pre>
<p>Add another large file:</p>
<pre><code>&lt; /dev/urandom tr -dc &quot;[:space:][:print:]&quot; | head -c500M &gt; /mnt/mylv/tmp/file4
</code></pre>
<p>Check the contents:</p>
<pre><code>ls -al /mnt/mylv/tmp
</code></pre>
<h3>5.13. Add 50 GB Disk</h3>
<p>I'm adding a 50 GB disk to my VM.</p>
<p>Output of <code>lsblk -i</code> after adding the disk:</p>
<pre><code>NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda           8:0    0 22.9G  0 disk 
|-sda1        8:1    0   22G  0 part /
|-sda2        8:2    0    1K  0 part 
`-sda5        8:5    0  976M  0 part [SWAP]
sdb           8:16   0   20G  0 disk 
`-myvg-mylv 254:0    0   30G  0 lvm  /mnt/mylv
sdc           8:32   0   30G  0 disk 
`-myvg-mylv 254:0    0   30G  0 lvm  /mnt/mylv
sdd           8:48   0   50G  0 disk 
</code></pre>
<p>This means my new disk is <code>/dev/sdd</code>. <strong>Change <code>/dev/sdd</code> to your actual disk device name in the following steps.</strong></p>
<h3>5.14. Create a PV from the 3rd Disk</h3>
<p>Mark <code>/dev/sdd</code> as a Physical Volume:</p>
<pre><code>sudo pvcreate /dev/sdd
</code></pre>
<h3>5.15. Extend the VG with This PV</h3>
<p>Add <code>/dev/sdd</code> to the Volume Group <code>myvg</code>:</p>
<pre><code>sudo vgextend myvg /dev/sdd
</code></pre>
<h3>5.16. Move Data from the 20 GB and 30 GB Disks to the 50 GB Disk</h3>
<p>Move data from the 20 GB disk (<code>sdb</code>) to the 50 GB disk (<code>sdd</code>):</p>
<pre><code>sudo pvmove /dev/sdb /dev/sdd
</code></pre>
<p>Move data from the 30 GB disk (<code>sdc</code>) to the 50 GB disk (<code>sdd</code>):</p>
<pre><code>sudo pvmove /dev/sdc /dev/sdd
</code></pre>
<p><strong>Note:</strong> These operations may take some time, depending on the amount of data.</p>
<h3>5.17. Remove the 20 GB and 30 GB Disks as PVs</h3>
<p>First, remove them from the Volume Group:</p>
<pre><code>sudo vgreduce myvg /dev/sdb
sudo vgreduce myvg /dev/sdc
</code></pre>
<p>Now, remove the Physical Volume metadata from the disks:</p>
<pre><code>sudo pvremove /dev/sdb
sudo pvremove /dev/sdc
</code></pre>
<h3>5.18. Physically Remove the 20 GB and 30 GB Disks and Verify</h3>
<p>At this step, we physically remove (or detach) the 20 GB and 30 GB disks from the system.</p>
<p>Output of <code>lsblk -i</code> after removing the disks:</p>
<pre><code>NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda           8:0    0 22.9G  0 disk 
|-sda1        8:1    0   22G  0 part /
|-sda2        8:2    0    1K  0 part 
`-sda5        8:5    0  976M  0 part [SWAP]
sdb           8:16   0   50G  0 disk 
`-myvg-mylv 254:0    0   30G  0 lvm  /mnt/mylv
</code></pre>
<p>As you can see, <code>/dev/sdd</code> has become <code>/dev/sdb</code>, but this is not a problem. Our LVM configuration is still working correctly.</p>
<p>Check the contents to confirm data integrity:</p>
<pre><code>ls -al /mnt/mylv/tmp
</code></pre>
<p><br></p>
</details>
<details>
<summary>
6. Case Study 2 - LVM and Snapshot
</summary>
<hr />
<p>A snapshot creates a point-in-time copy of a Logical Volume (LV). When files are changed on the original volume after the snapshot is taken, the original data blocks are preserved in the snapshot space. This allows you to revert to the snapshot state if needed.</p>
<p>Because only changed data blocks are stored, snapshots typically require much less space than the original volume.</p>
<p><strong>Important:</strong> If a snapshot becomes full (runs out of space to track changes), it becomes invalid and is automatically dropped, which can lead to data loss. Snapshots are resizable to prevent this.</p>
<h3>6.0. Specs</h3>
<p>We have a system installed with LVM.
- Add a 20 GB disk and use it to extend the system (<code>/</code>) disk.
- Add a 30 GB disk and add it to the existing Volume Group.
- Create a snapshot of the root filesystem using space from the new 30 GB disk.
- Make significant changes to the system and revert using the snapshot.</p>
<p><strong>The steps:</strong></p>
<ol>
<li>Add a 20 GB disk.</li>
<li>Create a PV from the disk.</li>
<li>Extend the VG with this PV.</li>
<li>Extend the root LV.</li>
<li>Extend the filesystem.</li>
<li>Add a 30 GB disk.</li>
<li>Create a PV from the disk.</li>
<li>Extend the VG with this PV.</li>
<li>Create a snapshot of the system (root) disk.</li>
<li>Make some changes to the system disk.</li>
<li>Mount the snapshot and check its content.</li>
<li>Extend the snapshot.</li>
<li>Revert to the snapshot.</li>
</ol>
<h3>6.1. Add 20 GB Disk</h3>
<p>Output of <code>lsblk -i</code> command before adding the disk:</p>
<pre><code>NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda               8:0    0   20G  0 disk 
|-sda1            8:1    0  487M  0 part /boot
|-sda2            8:2    0    1K  0 part 
`-sda5            8:5    0 19.5G  0 part 
  |-myvg-root   254:0    0 18.6G  0 lvm  /
  `-myvg-swap_1 254:1    0  980M  0 lvm  [SWAP]
</code></pre>
<p><strong>Note on Naming:</strong></p>
<p>When installing with LVM, Debian lets you choose the VG name (I chose <code>myvg</code>). Debian names the root LV <code>root</code>. Ubuntu uses <code>ubuntu-vg</code> and <code>lv-root</code> by default.</p>
<p><strong>In this section, replace <code>myvg</code> with your actual Volume Group name (<code>ubuntu-vg</code> for Ubuntu) in all commands.</strong></p>
<p>Output of <code>sudo pvs</code> before adding the disk:</p>
<pre><code>  PV         VG   Fmt  Attr PSize   PFree
  /dev/sda5  myvg lvm2 a--  &lt;19.52g    0 
</code></pre>
<p>Output of <code>sudo lvscan</code> before adding the disk:</p>
<pre><code>  ACTIVE            '/dev/myvg/root' [18.56 GiB] inherit
  ACTIVE            '/dev/myvg/swap_1' [980.00 MiB] inherit
</code></pre>
<p>Output of <code>df -h</code> before adding the disk:</p>
<pre><code>Filesystem             Size  Used Avail Use% Mounted on
udev                   458M     0  458M   0% /dev
tmpfs                   97M  544K   96M   1% /run
/dev/mapper/myvg-root   19G  1.6G   16G  10% /
tmpfs                  481M     0  481M   0% /dev/shm
tmpfs                  5.0M     0  5.0M   0% /run/lock
/dev/sda1              455M   98M  333M  23% /boot
tmpfs                   97M     0   97M   0% /run/user/1000
</code></pre>
<p><strong>For physical servers</strong>, add the disk to the hardware. <strong>For virtual servers</strong>, define and attach it to the VM.</p>
<p>I'm adding a 20 GB disk to my VM.</p>
<p>Output of <code>lsblk -i</code> after adding the disk:</p>
<pre><code>NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda               8:0    0   20G  0 disk 
|-sda1            8:1    0  487M  0 part /boot
|-sda2            8:2    0    1K  0 part 
`-sda5            8:5    0 19.5G  0 part 
  |-myvg-root   254:0    0 18.6G  0 lvm  /
  `-myvg-swap_1 254:1    0  980M  0 lvm  [SWAP]
sdb               8:16   0   20G  0 disk 
</code></pre>
<p>This means my new disk is <code>/dev/sdb</code>. <strong>Change <code>/dev/sdb</code> to your actual disk device name in the following steps.</strong></p>
<h3>6.2. Create a PV from the Disk</h3>
<p>Mark <code>/dev/sdb</code> as a Physical Volume:</p>
<pre><code>sudo pvcreate /dev/sdb
</code></pre>
<h3>6.3. Extend the VG with This PV</h3>
<p>Add <code>/dev/sdb</code> to the Volume Group <code>myvg</code>:</p>
<pre><code>sudo vgextend myvg /dev/sdb
</code></pre>
<h3>6.4. Extend the LV</h3>
<p>Extend the root LV to use all available free space:</p>
<pre><code>sudo lvextend -l +100%FREE  myvg/root
</code></pre>
<h3>6.5. Extend the Filesystem</h3>
<p>Resize the filesystem to use the new space:</p>
<pre><code>sudo resize2fs /dev/myvg/root
</code></pre>
<p>Output of <code>df -h</code> after expanding:</p>
<pre><code>Filesystem             Size  Used Avail Use% Mounted on
udev                   458M     0  458M   0% /dev
tmpfs                   97M  548K   96M   1% /run
/dev/mapper/myvg-root   38G  1.6G   35G   5% /
tmpfs                  481M     0  481M   0% /dev/shm
tmpfs                  5.0M     0  5.0M   0% /run/lock
/dev/sda1              455M   98M  333M  23% /boot
tmpfs                   97M     0   97M   0% /run/user/1000
</code></pre>
<h3>6.6. Add 30 GB Disk</h3>
<p>I'm adding a 30 GB disk to my VM.</p>
<p>Output of <code>lsblk -i</code> command after adding the disk:</p>
<pre><code>sda               8:0    0   20G  0 disk 
|-sda1            8:1    0  487M  0 part /boot
|-sda2            8:2    0    1K  0 part 
`-sda5            8:5    0 19.5G  0 part 
  |-myvg-root   254:0    0 38.6G  0 lvm  /
  `-myvg-swap_1 254:1    0  980M  0 lvm  [SWAP]
sdb               8:16   0   20G  0 disk 
`-myvg-root     254:0    0 38.6G  0 lvm  /
sdc               8:32   0   30G  0 disk 
</code></pre>
<p>This means my new disk is <code>/dev/sdc</code>. <strong>Change <code>/dev/sdc</code> to your actual disk device name in the following steps.</strong></p>
<h3>6.7. Create a PV from the Disk</h3>
<p>Mark <code>/dev/sdc</code> as a Physical Volume:</p>
<pre><code>sudo pvcreate /dev/sdc
</code></pre>
<h3>6.8. Extend the VG with This PV</h3>
<p>Add <code>/dev/sdc</code> to the Volume Group <code>myvg</code>:</p>
<pre><code>sudo vgextend myvg /dev/sdc
</code></pre>
<p><strong>Important:</strong> Snapshots must be created within the same Volume Group as the original Logical Volume.</p>
<h3>6.9. Create a Snapshot of the System Disk</h3>
<p>Create a 2 GB snapshot named <code>mysnapshot</code> of the <code>root</code> LV:</p>
<pre><code>sudo lvcreate --type snapshot -n mysnapshot -L 2G --snapshot /dev/myvg/root
</code></pre>
<p><strong>Tip:</strong> Monitor snapshot usage with <code>sudo lvs -o lv_name,lv_size,snap_percent,origin</code>. If the usage nears 100%, extend it immediately.</p>
<h3>6.10. Make Changes to the System Disk</h3>
<p>To demonstrate the snapshot, we'll make significant changes by installing software:</p>
<pre><code>sudo apt update
sudo apt install -y apache2 mariadb-server
</code></pre>
<p>Check the snapshot status to see if it's tracking changes:</p>
<pre><code>sudo lvs -o lv_name,lv_size,origin
</code></pre>
<h3>6.11. Mount the Snapshot and Check Its Content</h3>
<p>Create a temporary mount point:</p>
<pre><code>sudo mkdir /mnt/mysnapshot
</code></pre>
<p>Mount the snapshot (read-only is safer for inspection):</p>
<pre><code>sudo mount -o ro /dev/myvg/mysnapshot /mnt/mysnapshot
</code></pre>
<p>Browse <code>/mnt/mysnapshot</code> to see the state of the root filesystem at the time the snapshot was taken (you won't see the newly installed packages).</p>
<p>Unmount it:</p>
<pre><code>sudo umount /mnt/mysnapshot
</code></pre>
<h3>6.12. Extend the Snapshot</h3>
<p>If the snapshot is running low on space (check with <code>sudo lvs</code>), extend it to allow more changes to be tracked:</p>
<pre><code>sudo lvextend -L+1G /dev/myvg/mysnapshot
</code></pre>
<h3>6.13. Revert to the Snapshot</h3>
<p>Reverting merges the snapshot back into the original volume, restoring it to the snapshot's state.</p>
<p><strong>⚠️ Critical for Root Volume:</strong> Since the root (<code>/</code>) filesystem cannot be unmounted while the system is running, the merge is scheduled for the next boot.</p>
<p>Schedule the merge:</p>
<pre><code>sudo lvconvert --merge myvg/mysnapshot
</code></pre>
<p>You will see a message like: <em>"Delayed merge scheduled for activation after next activation."</em></p>
<p>Reboot the system. The merge will occur during the early boot process:</p>
<pre><code>sudo reboot
</code></pre>
<p><strong>Note:</strong> The snapshot LV (<code>mysnapshot</code>) will no longer exist after a successful merge.</p>
<p><br></p>
</details>
<details>
<summary>
7. Case Study 3 - Export and Import of LVM
</summary>
<hr />
<p>It is possible to export and import entire Volume Groups (with their Logical Volumes) between systems. The process involves: unmounting the LVs, deactivating and exporting the VG, moving the physical disks to the new system, then importing, activating, and remounting the VG.</p>
<h3>7.0. Specs</h3>
<p>We have two systems installed without LVM: <strong>srva</strong> and <strong>srvb</strong>. We will create an LVM setup on <strong>srva</strong>, fill it with data, and then move the entire setup to <strong>srvb</strong>.</p>
<ul>
<li><strong>A. Prepare the first system (srva)</strong><ul>
<li>-1. Install LVM on srva.</li>
<li>-2. Add 20 GB disk to srva.</li>
<li>-3. Create a PV from the disk.</li>
<li>-4. Create a VG from the PV.</li>
<li>-5. Create 2 LVs within the VG.</li>
<li>-6. Create filesystems in the LV.</li>
<li>-7. Mount the filesystems.</li>
<li>-8. Put test data on the filesystems. </li>
</ul>
</li>
<li>B. <strong>Export</strong><ul>
<li>-9. Unmount the logical volumes.</li>
<li>-10. Deactivate all logical volumes in the VG.</li>
<li>-11. Export the VG and Unplug the disk.</li>
</ul>
</li>
<li>C. <strong>Prepare the second system (srvb)</strong><ul>
<li>-12. Install LVM on srvb.</li>
<li>-13. Plug the disk into srvb.</li>
</ul>
</li>
<li>D. <strong>Import</strong><ul>
<li>-14. Import the volume group.</li>
<li>-15. Activate the volume group.</li>
<li>-16. Mount the logical volumes.</li>
</ul>
</li>
</ul>
<h3>7.1. Install LVM on srva</h3>
<pre><code>sudo apt update
sudo apt -y install lvm2
</code></pre>
<h3>7.2. Add 20 GB Disk to srva</h3>
<p>Output of <code>lsblk -i</code> before adding the disk:</p>
<pre><code>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part [SWAP]
</code></pre>
<p><strong>For physical servers</strong>, add the disk to the hardware. <strong>For virtual servers</strong>, define and attach it to the VM.</p>
<p>I'm adding a 20 GB disk to my VM.</p>
<p>Output of <code>lsblk -i</code> after adding the disk:</p>
<pre><code>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part [SWAP]
sdb      8:16   0   20G  0 disk 
</code></pre>
<p>This means my new disk is <code>/dev/sdb</code>. <strong>Change <code>/dev/sdb</code> to your actual disk device name in the following steps.</strong></p>
<h3>7.3. Create a PV from the Disk</h3>
<p>Mark <code>/dev/sdb</code> as a Physical Volume:</p>
<pre><code>sudo pvcreate /dev/sdb
</code></pre>
<h3>7.4. Create a VG from the PV</h3>
<p>Create a Volume Group named <code>myvg</code> using <code>/dev/sdb</code>:</p>
<pre><code>sudo vgcreate myvg /dev/sdb
</code></pre>
<h3>7.5. Create 2 LVs within the VG</h3>
<p>First LV is 10 GB:</p>
<pre><code>sudo lvcreate -L 10G -n mylv1 myvg
</code></pre>
<p>Second LV uses the remaining space (~10 GB):</p>
<pre><code>sudo lvcreate -l +100%FREE -n mylv2 myvg
</code></pre>
<h3>7.6. Create Filesystems in the LVs</h3>
<pre><code>sudo mkfs -t ext4 /dev/myvg/mylv1
sudo mkfs -t ext4 /dev/myvg/mylv2
</code></pre>
<h3>7.7. Mount the Filesystems</h3>
<p>Create mount points:</p>
<pre><code>sudo mkdir /mnt/mylv1
sudo mkdir /mnt/mylv2
</code></pre>
<p>Mount the LVs:</p>
<pre><code>sudo mount /dev/myvg/mylv1 /mnt/mylv1
sudo mount /dev/myvg/mylv2 /mnt/mylv2
</code></pre>
<h3>7.8. Put Test Data on the Filesystems</h3>
<p>Make the mount points writable for everyone (for testing):</p>
<pre><code>sudo chmod 777 /mnt/mylv1
sudo chmod 777 /mnt/mylv2
</code></pre>
<p>Create 2 files of 100 MB for each LV:</p>
<pre><code>&lt; /dev/urandom tr -dc &quot;[:space:][:print:]&quot; | head -c100M &gt; /mnt/mylv1/d1f1
&lt; /dev/urandom tr -dc &quot;[:space:][:print:]&quot; | head -c100M &gt; /mnt/mylv1/d1f2
&lt; /dev/urandom tr -dc &quot;[:space:][:print:]&quot; | head -c100M &gt; /mnt/mylv2/d2f1
&lt; /dev/urandom tr -dc &quot;[:space:][:print:]&quot; | head -c100M &gt; /mnt/mylv2/d2f2
</code></pre>
<p>Check the contents:</p>
<pre><code>ls -al /mnt/mylv1
ls -al /mnt/mylv2
</code></pre>
<h3>7.9. Unmount Logical Volumes</h3>
<pre><code>sudo umount /mnt/mylv1
sudo umount /mnt/mylv2
</code></pre>
<h3>7.10. Deactivate All Logical Volumes in the VG</h3>
<p>Deactivate the entire Volume Group:</p>
<pre><code>sudo vgchange -an myvg
</code></pre>
<p>Verify with <code>pvscan</code> (it should show the PV as belonging to <code>myvg</code> but not active):</p>
<pre><code>sudo pvscan
</code></pre>
<h3>7.11. Export the VG and Unplug the Disk</h3>
<p>Export the Volume Group (this removes it from the system's LVM metadata cache):</p>
<pre><code>sudo vgexport myvg
</code></pre>
<p>Now you can safely unplug or detach the 20 GB disk from <strong>srva</strong>.</p>
<p>Output of <code>lsblk -i</code> after removing the disk from <strong>srva</strong>:</p>
<pre><code>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part [SWAP]
</code></pre>
<h3>7.12. Install LVM on srvb</h3>
<pre><code>sudo apt update
sudo apt -y install lvm2
</code></pre>
<h3>7.13. Plug the Disk into srvb</h3>
<p>Output of <code>lsblk -i</code> on <strong>srvb</strong> before adding the disk:</p>
<pre><code>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part [SWAP]
</code></pre>
<p><strong>For physical servers</strong>, add the disk to the hardware. <strong>For virtual servers</strong>, define and attach it to the VM.</p>
<p>I'm adding the 20 GB disk to my <strong>srvb</strong> VM.</p>
<p>Output of <code>lsblk -i</code> after adding the disk to <strong>srvb</strong>:</p>
<pre><code>NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part [SWAP]
sdb      8:16   0   20G  0 disk 
</code></pre>
<p>This means the disk is now <code>/dev/sdb</code> on <strong>srvb</strong>.</p>
<h3>7.14. Import the Volume Group</h3>
<p>Scan for and import the exported Volume Group <code>myvg</code>:</p>
<pre><code>sudo vgimport myvg
</code></pre>
<h3>7.15. Activate the Volume Group</h3>
<p>Activate the Volume Group and its logical volumes:</p>
<pre><code>sudo vgchange -ay myvg
</code></pre>
<h3>7.16. Mount the Logical Volumes</h3>
<p>Create mount points and mount the LVs:</p>
<pre><code>sudo mkdir /mnt/mylv1 /mnt/mylv2
sudo mount /dev/myvg/mylv1 /mnt/mylv1
sudo mount /dev/myvg/mylv2 /mnt/mylv2
</code></pre>
<p>Verify the data is intact:</p>
<pre><code>ls -al /mnt/mylv1
ls -al /mnt/mylv2
</code></pre>
<p><br></p>
</details>
<details>
<summary>
8. Uncovered Subjects
</summary>
<hr />
<p>The following LVM subjects are not covered in this tutorial:</p>
<ul>
<li>Striped logical volumes</li>
<li>RAID logical volumes</li>
<li>Thin-provisioned logical volumes</li>
<li>Cache logical volumes</li>
<li>Using shared storage (e.g., with iSCSI or Fibre Channel)</li>
<li>Fine-grained control of logical volume activation</li>
<li>Controlling physical extent allocation policies</li>
<li>LVM object tags</li>
</ul>
</details><!-- HTML Footer Start -->

</body>
</html>

<!-- HTML Footer End -->
