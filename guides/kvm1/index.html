<!DOCTYPE html><html lang="en" dir="ltr" data-theme="dark" data-has-toc data-has-sidebar class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>KVM Virtualization (Beginner) | Debian & Ubuntu Tutorials</title><link rel="shortcut icon" href="/./src/assets/logo.png" type="image/png"/><meta name="generator" content="Astro v5.16.6"/><meta name="generator" content="Starlight v0.37.1"/><meta property="og:title" content="KVM Virtualization (Beginner)"/><meta property="og:type" content="article"/><meta property="og:locale" content="en"/><meta property="og:description" content="Introduction to KVM virtualization"/><meta property="og:site_name" content="Debian &#38; Ubuntu Tutorials"/><meta name="twitter:card" content="summary_large_image"/><meta name="description" content="Introduction to KVM virtualization"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg><svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg><svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg></template><link rel="stylesheet" href="/_astro/print.DNXP8c50.css" media="print"><link rel="stylesheet" href="/_astro/index.0vIKbS8r.css"><script type="module" src="/_astro/page.B1D-nYk3.js"></script></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">Skip to content</a>  <div class="page sl-flex astro-vrdttmbt"> <header class="header astro-vrdttmbt"><div class="header astro-kmkmnagf"> <div class="title-wrapper sl-flex astro-kmkmnagf"> <a href="/" class="site-title sl-flex astro-m46x6ez3">  <img class="astro-m46x6ez3" alt src="/_astro/logo.Br7QL1LC.png" width="734" height="349">  <span class="astro-m46x6ez3" translate="no"> Debian &amp; Ubuntu Tutorials </span> </a>  </div> <div class="sl-flex print:hidden astro-kmkmnagf"> <site-search class="astro-kmkmnagf astro-v37mnknz" data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}"> <button data-open-modal disabled aria-label="Search" aria-keyshortcuts="Control+K" class="astro-v37mnknz"> <svg aria-hidden="true" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg> <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span> <kbd class="sl-hidden md:sl-flex astro-v37mnknz" style="display: none;"> <kbd class="astro-v37mnknz">Ctrl</kbd><kbd class="astro-v37mnknz">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> Cancel </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = '⌘';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.cjYDvRdi.js"></script>   </div> <div class="sl-hidden md:sl-flex print:hidden right-group astro-kmkmnagf"> <div class="sl-flex social-icons astro-kmkmnagf"> <a href="https://github.com/enatsek/" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script> <script type="module">const r="starlight-theme",o=e=>e==="auto"||e==="dark"||e==="light"?e:"auto",c=()=>o(typeof localStorage<"u"&&localStorage.getItem(r));function n(e){typeof localStorage<"u"&&localStorage.setItem(r,e==="light"||e==="dark"?e:"")}const l=()=>matchMedia("(prefers-color-scheme: light)").matches?"light":"dark";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e==="auto"?l():e,n(e)}matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>{c()==="auto"&&t("auto")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector("select")?.addEventListener("change",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define("starlight-theme-select",s);</script> <script type="module">class s extends HTMLElement{constructor(){super();const e=this.querySelector("select");e&&(e.addEventListener("change",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)}),window.addEventListener("pageshow",t=>{if(!t.persisted)return;const n=e.querySelector("option[selected]")?.index;n!==e.selectedIndex&&(e.selectedIndex=n??0)}))}}customElements.define("starlight-lang-select",s);</script> </div> </div> </header> <nav class="sidebar print:hidden astro-vrdttmbt" aria-label="Main"> <starlight-menu-button class="print:hidden astro-jif73yzw"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="open-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg> <svg aria-hidden="true" class="close-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="m13.41 12 6.3-6.29a1.004 1.004 0 1 0-1.42-1.42L12 10.59l-6.29-6.3a1.004 1.004 0 0 0-1.42 1.42l6.3 6.29-6.3 6.29a1 1 0 0 0 0 1.42.998.998 0 0 0 1.42 0l6.29-6.3 6.29 6.3a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.42L13.41 12Z"/></svg> </button> </starlight-menu-button> <script type="module">class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector("button"),this.btn.addEventListener("click",()=>this.toggleExpanded());const t=this.closest("nav");t&&t.addEventListener("keyup",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute("aria-expanded",String(t)),document.body.toggleAttribute("data-mobile-menu-expanded",t)}toggleExpanded(){this.setExpanded(this.getAttribute("aria-expanded")!=="true")}closeOnEscape(t){t.code==="Escape"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define("starlight-menu-button",s);</script>   <div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"> <div class="sidebar-content sl-flex astro-vrdttmbt"> <sl-sidebar-state-persist data-hash="1o07nl4" class="astro-kku4brbg"> <script aria-hidden="true">
		(() => {
			try {
				if (!matchMedia('(min-width: 50em)').matches) return;
				/** @type {HTMLElement | null} */
				const target = document.querySelector('sl-sidebar-state-persist');
				const state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');
				if (!target || !state || target.dataset.hash !== state.hash) return;
				window._starlightScrollRestore = state.scroll;
				customElements.define(
					'sl-sidebar-restore',
					class SidebarRestore extends HTMLElement {
						connectedCallback() {
							try {
								const idx = parseInt(this.dataset.index || '');
								const details = this.closest('details');
								if (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];
							} catch {}
						}
					}
				);
			} catch {}
		})();
	</script>  <ul class="top-level astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Site Info</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="0"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/generics/contact/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Contact</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/generics/license/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">License</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/generics/privacypolicy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Privacy Policy</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Web Services &amp; HTTPS</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="1"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/guides/apache/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Apache Web Server</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/nginx/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Nginx Web Server</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/certbot/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Certbot</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/lamp/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">LAMP Stack</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/lapp/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">LAPP Stack</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/wordpress/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">WordPress</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/adminer/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Adminer Tool</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Database Management</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="2"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/guides/mariadb/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MariaDB</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/mariadbcluster/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MariaDB Cluster</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/postgresdebian/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">PostgreSQL (Debian)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/postgresubuntu/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">PostgreSQL (Ubuntu)</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Networking</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="3"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/guides/networkdebian/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Debian Network Configuration</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/networkubuntu/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Ubuntu Network Configuration</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/ufw/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">UFW (Uncomplicated Firewall)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/shvpn/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Self-Hosted VPN</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/s2svpn/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Site-to-Site VPN</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Infrastructure &amp; Virtualization</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="4"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/guides/kvm1/" aria-current="page" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">KVM Virtualization (Beginner)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/kvm2/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">KVM Virtualization (Networking)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/keepalived/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Keepalived</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/haproxy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">HAProxy</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/ansible/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Ansible</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/lvm/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">LVM (Logical Volume Management)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/dns/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DNS</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/ad/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Active Directory</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/nodejs/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Node.js</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">System Administration Guides</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="5"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/guides/useradministration/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">User and Group Administration</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/etcfolder/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">/etc Folder Contents</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/regex/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Regular Expressions</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/filecompression/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">File Compression</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/fhs/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">FHS (Filesystem Hierarchy Standard)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/systemd/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Systemd Basics</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/systemd2/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Systemd Additional</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/debpackaging/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Debian Packaging</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/otherlinuxes/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Other Linux Distributions</span>  </a> </li> </ul>  </details> </li> </ul>   <script aria-hidden="true">
		(() => {
			const scroller = document.getElementById('starlight__sidebar');
			if (!window._starlightScrollRestore || !scroller) return;
			scroller.scrollTop = window._starlightScrollRestore;
			delete window._starlightScrollRestore;
		})();
	</script> </sl-sidebar-state-persist>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="social-icons astro-wu23bvmt"> <a href="https://github.com/enatsek/" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-vrdttmbt">  <script type="module">const a=document.getElementById("starlight__sidebar"),n=a?.querySelector("sl-sidebar-state-persist"),o="sl-sidebar-state",i=()=>{let t=[];const e=n?.dataset.hash||"";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||"{}");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener("click",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest("summary")?.closest("details");if(!e)return;const s=e.querySelector("sl-sidebar-restore"),r=parseInt(s?.dataset.index||"");isNaN(r)||l(!e.open,r)});addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&d()});addEventListener("pageHide",d);</script> <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container print:hidden astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><span class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></span><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#0-specs" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">0. Specs</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#00-the-what" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.0. The What</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#01-how-it-works" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.1. How It Works</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#02-infrastructure" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.2. Infrastructure</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#03-very-basic-terminology" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.3. (Very) Basic Terminology</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#04-resources" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.4. Resources</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#1-installation-and-configuration" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">1. Installation and Configuration</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#11-installation" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.1. Installation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#12-bridge-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.2. Bridge Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#13-add-our-bridge-to-kvm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.3. Add Our Bridge to KVM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#14-configure-directories" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.4. Configure Directories</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#2-vm-creation" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">2. VM Creation</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#21-create-the-first-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.1. Create the First VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#22-os-variant-list" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.2. OS Variant List</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#23-connecting-to-the-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.3. Connecting to the VM</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#3-remote-graphical-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">3. Remote Graphical Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#4-installing-vms-from-pre-built-images" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">4. Installing VMs from Pre-built Images</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#40-installing-cloud-image-utils" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.0. Installing cloud-image-utils</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#41-acquiring-cloud-images" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.1. Acquiring Cloud Images</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#42-creating-a-new-image-from-the-original-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.2. Creating a New Image From the Original Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#43-cloud-init-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.3. Cloud-init Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#44-cloud-init-network-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.4. Cloud-init Network Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#45-creating-cloud-init-seed-images" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.5. Creating Cloud-init Seed Images</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#46-start-vms-from-cloud-images" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.6. Start VMs from Cloud Images</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#47-disable-cloud-init-after-initial-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.7. Disable Cloud-init After Initial Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#48-automation-with-python-script" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.8. Automation with Python Script</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#5-virsh-shell-based-vm-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">5. virsh: Shell Based VM Management</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#50-environment-variable-set" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.0. Environment Variable Set</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#51-host-information" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.1. Host Information</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#52-list-vms-and-their-states" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.2. List VMs and Their States</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#53-vm-lifecycle-management" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.3. VM Lifecycle Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#54-pause-and-resume-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.4. Pause and Resume VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#55-autostart-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.5. Autostart Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#56-vm-information" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.6. VM Information</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#57-vm-memory-management" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.7. VM Memory Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#58-vm-vcpu-management" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.8. VM vCPU Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#59-snapshots" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.9. Snapshots</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#510-attach-another-disk-to-a-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.10. Attach Another Disk to a VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#511-other-virsh-commands" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.11. Other virsh Commands</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#6-qemu-img-shell-based-image-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">6. qemu-img: Shell Based Image Management</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#61-get-basic-image-information" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.1. Get Basic Image Information</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#62-creating-an-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.2. Creating an Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#63-converting-image-formats" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.3. Converting Image Formats</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#64-resize-a-disk-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.4. Resize a Disk Image.</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#65-check-an-image-for-errors" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.5. Check an Image For Errors</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#7-export-and-import-of-vms" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">7. Export and Import of VMs</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#71-export" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">7.1. Export</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#72-import" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">7.2. Import</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#8-libguestfs-vm-disk-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">8. libguestfs: VM Disk Management</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#81-installation" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.1. Installation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#82-mounting-vms-disks" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.2. Mounting VM’s Disks</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#83-common-libguestfs-commands" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.3. Common libguestfs Commands</span> </a>  </li> </ul>  </li> </ul> </div></details></nav></mobile-starlight-toc><script type="module" src="/_astro/MobileTableOfContents.astro_astro_type_script_index_0_lang.C181hMzK.js"></script></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#0-specs" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">0. Specs</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#00-the-what" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.0. The What</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#01-how-it-works" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.1. How It Works</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#02-infrastructure" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.2. Infrastructure</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#03-very-basic-terminology" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.3. (Very) Basic Terminology</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#04-resources" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.4. Resources</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#1-installation-and-configuration" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">1. Installation and Configuration</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#11-installation" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.1. Installation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#12-bridge-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.2. Bridge Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#13-add-our-bridge-to-kvm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.3. Add Our Bridge to KVM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#14-configure-directories" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.4. Configure Directories</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#2-vm-creation" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">2. VM Creation</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#21-create-the-first-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.1. Create the First VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#22-os-variant-list" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.2. OS Variant List</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#23-connecting-to-the-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.3. Connecting to the VM</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#3-remote-graphical-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">3. Remote Graphical Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#4-installing-vms-from-pre-built-images" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">4. Installing VMs from Pre-built Images</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#40-installing-cloud-image-utils" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.0. Installing cloud-image-utils</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#41-acquiring-cloud-images" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.1. Acquiring Cloud Images</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#42-creating-a-new-image-from-the-original-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.2. Creating a New Image From the Original Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#43-cloud-init-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.3. Cloud-init Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#44-cloud-init-network-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.4. Cloud-init Network Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#45-creating-cloud-init-seed-images" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.5. Creating Cloud-init Seed Images</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#46-start-vms-from-cloud-images" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.6. Start VMs from Cloud Images</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#47-disable-cloud-init-after-initial-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.7. Disable Cloud-init After Initial Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#48-automation-with-python-script" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.8. Automation with Python Script</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#5-virsh-shell-based-vm-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">5. virsh: Shell Based VM Management</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#50-environment-variable-set" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.0. Environment Variable Set</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#51-host-information" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.1. Host Information</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#52-list-vms-and-their-states" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.2. List VMs and Their States</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#53-vm-lifecycle-management" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.3. VM Lifecycle Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#54-pause-and-resume-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.4. Pause and Resume VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#55-autostart-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.5. Autostart Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#56-vm-information" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.6. VM Information</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#57-vm-memory-management" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.7. VM Memory Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#58-vm-vcpu-management" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.8. VM vCPU Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#59-snapshots" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.9. Snapshots</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#510-attach-another-disk-to-a-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.10. Attach Another Disk to a VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#511-other-virsh-commands" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.11. Other virsh Commands</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#6-qemu-img-shell-based-image-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">6. qemu-img: Shell Based Image Management</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#61-get-basic-image-information" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.1. Get Basic Image Information</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#62-creating-an-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.2. Creating an Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#63-converting-image-formats" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.3. Converting Image Formats</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#64-resize-a-disk-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.4. Resize a Disk Image.</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#65-check-an-image-for-errors" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.5. Check an Image For Errors</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#7-export-and-import-of-vms" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">7. Export and Import of VMs</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#71-export" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">7.1. Export</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#72-import" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">7.2. Import</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#8-libguestfs-vm-disk-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">8. libguestfs: VM Disk Management</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#81-installation" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.1. Installation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#82-mounting-vms-disks" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.2. Mounting VM’s Disks</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#83-common-libguestfs-commands" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.3. Common libguestfs Commands</span> </a>  </li> </ul>  </li> </ul> </nav></starlight-toc><script type="module" src="/_astro/TableOfContents.astro_astro_type_script_index_0_lang.CKWWgpjV.js"></script></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main data-pagefind-body class="astro-bguv2lll" lang="en" dir="ltr">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <h1 id="_top" class="astro-j6tvhyss">KVM Virtualization (Beginner)</h1>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content"> <div class="sl-heading-wrapper level-h5"><h5 id="introduction-to-kvm-virtualization">Introduction to KVM virtualization</h5><a class="sl-anchor-link" href="#introduction-to-kvm-virtualization"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Introduction to KVM virtualization”</span></a></div>
<div class="sl-heading-wrapper level-h2"><h2 id="0-specs">0. Specs</h2><a class="sl-anchor-link" href="#0-specs"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0. Specs”</span></a></div>
<hr>
<div class="sl-heading-wrapper level-h3"><h3 id="00-the-what">0.0. The What</h3><a class="sl-anchor-link" href="#00-the-what"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0.0. The What”</span></a></div>
<p>KVM Virtualization Tutorial 1 for Debian and Ubuntu Server.</p>
<p>Our objective is to install and configure a host system for virtual machines.</p>
<p>This tutorial aims to bring you (and me) to a moderate level of virtualization administration proficiency.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="01-how-it-works">0.1. How It Works</h3><a class="sl-anchor-link" href="#01-how-it-works"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0.1. How It Works”</span></a></div>
<p><strong>KVM</strong> (Kernel-based Virtual Machine) is a loadable kernel module that provides virtualization capabilities via APIs.</p>
<p><strong>QEMU</strong> (Quick EMUlator) is a virtualizer that uses the KVM API. QEMU also supports other virtualization solutions.</p>
<p><strong>Libvirt</strong> is a library for managing virtualization hosts. The <code dir="auto">virsh</code> command originates from Libvirt.</p>
<p><strong>Libguestfs</strong> is a collection of tools for accessing and managing virtual machine images.</p>
<p><strong>virt-manager</strong> is a GUI for managing virtual machines. I use it on my workstation for simple tasks.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="02-infrastructure">0.2. Infrastructure</h3><a class="sl-anchor-link" href="#02-infrastructure"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0.2. Infrastructure”</span></a></div>
<ul>
<li><strong>Server (Host)</strong>: Debian (12/13) or Ubuntu (24.04/22.04) Server
<ul>
<li>IP: 192.168.1.121</li>
<li>Name: elma</li>
<li>NIC: enp3s0f0</li>
</ul>
</li>
<li><strong>Workstation</strong>: Debian 13 or Ubuntu 24.04 LTS Desktop</li>
<li><strong>Network</strong>: 192.168.1.0/24 supplied by my internet modem/router</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="03-very-basic-terminology">0.3. (Very) Basic Terminology</h3><a class="sl-anchor-link" href="#03-very-basic-terminology"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0.3. (Very) Basic Terminology”</span></a></div>
<ul>
<li><strong>Domain</strong>: Virtual Machine (VM)</li>
<li><strong>Image</strong>: A file containing a virtual machine or its disk</li>
<li><strong>Host</strong>: A server running virtualization software</li>
<li><strong>Guest</strong>: A virtual machine running on a host</li>
<li><strong>Snapshot</strong>: A saved state of an image that can be restored later</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="04-resources">0.4. Resources</h3><a class="sl-anchor-link" href="#04-resources"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0.4. Resources”</span></a></div>
<ul>
<li><a href="https://ostechnix.com/install-and-configure-kvm-in-ubuntu-20-04-headless-server/">ostechnix.com</a></li>
<li><a href="https://www.qemu.org/docs/master/tools/qemu-img.html">www.qemu.org</a></li>
<li><a href="https://www.libvirt.org/manpages/virsh.html">www.libvirt.org</a></li>
<li><a href="https://docs.fedoraproject.org/en-US/Fedora/18/html/Virtualization_Administration_Guide/index.html">https://docs.fedoraproject.org/en-US/Fedora/18/html/Virtualization_Administration_Guide/index.html</a> (not working now</li>
<li><a href="https://libguestfs.org/">libguestfs.org</a></li>
<li><a href="https://fabianlee.org/2020/02/23/kvm-testing-cloud-init-locally-using-kvm-for-an-ubuntu-cloud-image/">fabianlee.org</a></li>
<li><a href="https://cloudinit.readthedocs.io/en/latest/reference/examples.html">cloudinit.readthedocs.io</a></li>
<li>ISBN: 979-10-91414-20-3 <strong>The Debian Administrator’s Handbook</strong> by Raphaël Hertzog and Roland Mas</li>
<li>ISBN: 978-1-78829-467-6 <strong>KVM Virtualization Cookbook</strong> by Konstantin Ivanov</li>
</ul>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="1-installation-and-configuration">1. Installation and Configuration</h2><a class="sl-anchor-link" href="#1-installation-and-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1. Installation and Configuration”</span></a></div>
<hr>
<div class="sl-heading-wrapper level-h3"><h3 id="11-installation">1.1. Installation</h3><a class="sl-anchor-link" href="#11-installation"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.1. Installation”</span></a></div>
<p>Install necessary packages:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.v4551.css"><script type="module" src="/_astro/ec.0vx5m.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt update</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install libvirt-clients libvirt-daemon-system qemu-kvm \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">virtinst virt-manager virt-viewer bridge-utils --yes</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt updatesudo apt install libvirt-clients libvirt-daemon-system qemu-kvm \     virtinst virt-manager virt-viewer bridge-utils --yes"><div></div></button></div></figure></div>
<p>Add your user to the libvirt group (replace <code dir="auto">exforge</code> with your username):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo usermod -aG libvirt exforge</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo usermod -aG libvirt exforge"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="12-bridge-configuration">1.2. Bridge Configuration</h3><a class="sl-anchor-link" href="#12-bridge-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.2. Bridge Configuration”</span></a></div>
<p>For guest computers to access the network, a bridge configuration on the host is required.</p>
<p>Bridge configuration differs slightly between Debian and Ubuntu, so we’ll handle them separately.</p>
<div class="sl-heading-wrapper level-h4"><h4 id="121-ubuntu-bridge-configuration">1.2.1. Ubuntu Bridge Configuration</h4><a class="sl-anchor-link" href="#121-ubuntu-bridge-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.2.1. Ubuntu Bridge Configuration”</span></a></div>
<p>By default, KVM creates a virtual bridge named <code dir="auto">virbr0</code>. This bridge allows VMs to communicate with each other and the host. However, we want VMs to join our network by obtaining IP addresses from it.</p>
<p>First, disable netfilter (enabled on bridges by default):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/sysctl.d/bridge.conf</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/sysctl.d/bridge.conf"><div></div></button></div></figure></div>
<p>Add the following lines (file is initially empty):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-ip6tables=0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-iptables=0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-arptables=0</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="net.bridge.bridge-nf-call-ip6tables=0net.bridge.bridge-nf-call-iptables=0net.bridge.bridge-nf-call-arptables=0"><div></div></button></div></figure></div>
<p>Create a udev rule to apply these settings:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/udev/rules.d/99-bridge.rules</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/udev/rules.d/99-bridge.rules"><div></div></button></div></figure></div>
<p>Add this line (file is initially empty):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">ACTION=="add", SUBSYSTEM=="module", KERNEL=="br_netfilter", RUN+="/sbin/sysctl -p /etc/sysctl.d/bridge.conf"</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="ACTION==&#x22;add&#x22;, SUBSYSTEM==&#x22;module&#x22;, KERNEL==&#x22;br_netfilter&#x22;, RUN+=&#x22;/sbin/sysctl -p /etc/sysctl.d/bridge.conf&#x22;"><div></div></button></div></figure></div>
<p>Reboot to apply changes:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo reboot</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo reboot"><div></div></button></div></figure></div>
<p>Remove the default KVM bridge. List networks with <code dir="auto">ip link</code> to see <code dir="auto">virbr0</code>.</p>
<p>Delete and undefine KVM networks:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh net-destroy default</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh net-undefine default</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh net-destroy defaultvirsh net-undefine default"><div></div></button></div></figure></div>
<p>If errors occur, force removal:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo ip link delete virbr0 type bridge</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo ip link delete virbr0 type bridge"><div></div></button></div></figure></div>
<p>Run <code dir="auto">ip link</code> again to confirm <code dir="auto">virbr0</code> is removed. Note your physical interface name(s) (e.g., <code dir="auto">enp0s0</code>).</p>
<p>Back up your network configuration file (if <code dir="auto">50-cloud-init.yaml</code> doesn’t exist, look for another <code dir="auto">.yaml</code> file):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo cp /etc/netplan/50-cloud-init.yaml{,.backup}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo cp /etc/netplan/50-cloud-init.yaml{,.backup}"><div></div></button></div></figure></div>
<p>Edit your network configuration:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/netplan/50-cloud-init.yaml</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/netplan/50-cloud-init.yaml"><div></div></button></div></figure></div>
<p>Replace the content with the following (adjust <code dir="auto">enp3s0f0</code> to your interface name, and use your local network IP and gateway):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">network:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">ethernets:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">enp3s0f0:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp4: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp6: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">bridges:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">br0:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">interfaces: [enp3s0f0]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">addresses:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">- 192.168.1.121/24</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">routes:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">- to: default</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">via: 192.168.1.1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">mtu: 1500</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">nameservers:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">addresses:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">- 8.8.8.8</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">- 8.8.4.4</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">parameters:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">stp: true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">forward-delay: 4</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp4: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp6: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">version: 2</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="network:  ethernets:    enp3s0f0:      dhcp4: false      dhcp6: false  bridges:    br0:      interfaces: [enp3s0f0]      addresses:      - 192.168.1.121/24      routes:      - to: default        via: 192.168.1.1      mtu: 1500      nameservers:        addresses:        - 8.8.8.8        - 8.8.4.4      parameters:        stp: true        forward-delay: 4      dhcp4: false      dhcp6: false  version: 2"><div></div></button></div></figure></div>
<p>Apply changes (SSH connection may drop; reconnect if needed):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo netplan apply</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo netplan apply"><div></div></button></div></figure></div>
<p>Verify the bridge with <code dir="auto">ip link</code>; you should see <code dir="auto">br0</code>.</p>
<div class="sl-heading-wrapper level-h4"><h4 id="122-debian-bridge-configuration">1.2.2. Debian Bridge Configuration</h4><a class="sl-anchor-link" href="#122-debian-bridge-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.2.2. Debian Bridge Configuration”</span></a></div>
<p>By default, KVM creates a virtual bridge named <code dir="auto">virbr0</code>. This bridge allows VMs to communicate with each other and the host. However, we want VMs to join our network by obtaining IP addresses from it.</p>
<p>First, disable netfilter (enabled on bridges by default):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/sysctl.d/bridge.conf</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/sysctl.d/bridge.conf"><div></div></button></div></figure></div>
<p>Add the following lines (file is initially empty):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-ip6tables=0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-iptables=0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-arptables=0</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="net.bridge.bridge-nf-call-ip6tables=0net.bridge.bridge-nf-call-iptables=0net.bridge.bridge-nf-call-arptables=0"><div></div></button></div></figure></div>
<p>Create a udev rule to apply these settings:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/udev/rules.d/99-bridge.rules</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/udev/rules.d/99-bridge.rules"><div></div></button></div></figure></div>
<p>Add this line (file is initially empty):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">ACTION=="add", SUBSYSTEM=="module", KERNEL=="br_netfilter", RUN+="/sbin/sysctl -p /etc/sysctl.d/bridge.conf"</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="ACTION==&#x22;add&#x22;, SUBSYSTEM==&#x22;module&#x22;, KERNEL==&#x22;br_netfilter&#x22;, RUN+=&#x22;/sbin/sysctl -p /etc/sysctl.d/bridge.conf&#x22;"><div></div></button></div></figure></div>
<p>Reboot to apply changes:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo reboot</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo reboot"><div></div></button></div></figure></div>
<p>Back up your network configuration file:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo cp /etc/network/interfaces{,.backup}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo cp /etc/network/interfaces{,.backup}"><div></div></button></div></figure></div>
<p>Edit your network configuration:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/network/interfaces</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/network/interfaces"><div></div></button></div></figure></div>
<p>Replace the content with the following (adjust <code dir="auto">enp3s0f0</code> to your interface name, and use your local network IP and gateway):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53"># This file describes the network interfaces available on your system</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53"># and how to activate them. For more information, see interfaces(5).</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">source /etc/network/interfaces.d/*</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53"># The loopback network interface</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">auto lo</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">iface lo inet loopback</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53"># The primary network interface</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">allow-hotplug enp3s0f0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#make sure we don't get addresses on our raw device</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">iface enp3s0f0 inet manual</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#set up bridge and give it a static ip</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">auto br0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">iface br0 inet static</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">address 192.168.1.121</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">netmask 255.255.255.0</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">network 192.168.1.0</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">broadcast 192.168.1.255</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">gateway 192.168.1.1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">bridge_ports enp3s0f0</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">bridge_stp off</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">bridge_fd 0</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">bridge_maxwait 0</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">dns-nameservers 8.8.8.8</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="# This file describes the network interfaces available on your system# and how to activate them. For more information, see interfaces(5).source /etc/network/interfaces.d/*# The loopback network interfaceauto loiface lo inet loopback# The primary network interfaceallow-hotplug enp3s0f0#make sure we don&#x27;t get addresses on our raw deviceiface enp3s0f0 inet manual#set up bridge and give it a static ipauto br0iface br0 inet static        address 192.168.1.121        netmask 255.255.255.0        network 192.168.1.0        broadcast 192.168.1.255        gateway 192.168.1.1        bridge_ports enp3s0f0        bridge_stp off        bridge_fd 0        bridge_maxwait 0        dns-nameservers 8.8.8.8"><div></div></button></div></figure></div>
<p>Apply changes (SSH connection may drop; reconnect if needed):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo systemctl restart networking.service</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo systemctl restart networking.service"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="13-add-our-bridge-to-kvm">1.3. Add Our Bridge to KVM</h3><a class="sl-anchor-link" href="#13-add-our-bridge-to-kvm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.3. Add Our Bridge to KVM”</span></a></div>
<p>Create an XML file for the bridge definition:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">nano host-bridge.xml</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="nano host-bridge.xml"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">&#x3C;network></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">&#x3C;name>host-bridge&#x3C;/name></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">&#x3C;forward mode="bridge"/></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">&#x3C;bridge name="br0"/></span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">&#x3C;/network></span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="<network>  <name>host-bridge</name>  <forward mode=&#x22;bridge&#x22;/>  <bridge name=&#x22;br0&#x22;/></network>"><div></div></button></div></figure></div>
<p>Define, start, and enable autostart for the bridge:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh net-define host-bridge.xml</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh net-start host-bridge</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh net-autostart host-bridge</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh net-define host-bridge.xmlvirsh net-start host-bridgevirsh net-autostart host-bridge"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="14-configure-directories">1.4. Configure Directories</h3><a class="sl-anchor-link" href="#14-configure-directories"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.4. Configure Directories”</span></a></div>
<p>Set up directories for disk images and installation ISOs:</p>
<ul>
<li><code dir="auto">/srv/kvm</code> for VM disk images</li>
<li><code dir="auto">/srv/isos</code> for installation ISO images</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo mkdir /srv/kvm /srv/isos</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo virsh pool-create-as srv-kvm dir --target /srv/kvm</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo mkdir /srv/kvm /srv/isossudo virsh pool-create-as srv-kvm dir --target /srv/kvm"><div></div></button></div></figure></div>
<p>At this point, you may want to copy some installation ISOs to the server’s <code dir="auto">/srv/isos</code> directory.</p>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="2-vm-creation">2. VM Creation</h2><a class="sl-anchor-link" href="#2-vm-creation"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2. VM Creation”</span></a></div>
<hr>
<div class="sl-heading-wrapper level-h3"><h3 id="21-create-the-first-vm">2.1. Create the First VM</h3><a class="sl-anchor-link" href="#21-create-the-first-vm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2.1. Create the First VM”</span></a></div>
<p>Now it’s time to create our first virtual machine.</p>
<p>It will be Ubuntu Server 24.04 LTS with 1 GB RAM and 10 GB HDD.</p>
<p>I’ve already copied the Ubuntu Server ISO <code dir="auto">ubuntu-24.04.2-live-server-amd64.iso</code> to <code dir="auto">/srv/isos</code>.</p>
<p>Install a VM named <code dir="auto">testkvm</code>:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo virt-install --name testkvm \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--connect qemu:///system  --virt-type kvm \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--memory 1024 --vcpus 1 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--disk /srv/kvm/testkvm.qcow2,format=qcow2,size=10 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--cdrom /srv/isos/ubuntu-24.04.2-live-server-amd64.iso  \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--network bridge=br0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--graphics vnc,port=5901,listen=0.0.0.0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--os-variant ubuntu24.04 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--noautoconsole</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo virt-install --name testkvm \    --connect qemu:///system  --virt-type kvm \    --memory 1024 --vcpus 1 \    --disk /srv/kvm/testkvm.qcow2,format=qcow2,size=10 \    --cdrom /srv/isos/ubuntu-24.04.2-live-server-amd64.iso  \    --network bridge=br0 \    --graphics vnc,port=5901,listen=0.0.0.0 \    --os-variant ubuntu24.04 \    --noautoconsole"><div></div></button></div></figure></div>
<p>Parameters explained:</p>
<ul>
<li><code dir="auto">--name</code>: VM name</li>
<li><code dir="auto">--connect</code>: Connection URI (local system)</li>
<li><code dir="auto">--virt-type</code>: Virtualization type (KVM)</li>
<li><code dir="auto">--memory</code>: RAM in MB</li>
<li><code dir="auto">--vcpus</code>: Virtual CPU count</li>
<li><code dir="auto">--disk</code>: Storage location, format, and size (GB)</li>
<li><code dir="auto">--cdrom</code>: Installation media</li>
<li><code dir="auto">--network</code>: Network bridge for VM connectivity</li>
<li><code dir="auto">--graphics</code>: VNC settings (listens on all interfaces)</li>
<li><code dir="auto">--os-variant</code>: Guest OS optimization profile</li>
<li><code dir="auto">--noautoconsole</code>: Don’t automatically connect to console</li>
</ul>
<p><strong>Note</strong>: Ubuntu 22.04 may not recognize <code dir="auto">ubuntu24.04</code> OS variant; use <code dir="auto">ubuntu22.04</code> instead.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="22-os-variant-list">2.2. OS Variant List</h3><a class="sl-anchor-link" href="#22-os-variant-list"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2.2. OS Variant List”</span></a></div>
<p>Many OS variants are available. Find yours with:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install libosinfo-bin --yes</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">osinfo-query os</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt install libosinfo-bin --yesosinfo-query os"><div></div></button></div></figure></div>
<p>This helps the hypervisor optimize for the guest OS. The parameter can be omitted if unsure.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="23-connecting-to-the-vm">2.3. Connecting to the VM</h3><a class="sl-anchor-link" href="#23-connecting-to-the-vm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2.3. Connecting to the VM”</span></a></div>
<p>A graphical desktop is required to connect via VNC. Install <code dir="auto">virt-viewer</code> on your workstation:</p>
<p><strong>Run on your workstation:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt update</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install virt-viewer --yes</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-viewer --connect qemu+ssh://exforge@elma/system testkvm</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt updatesudo apt install virt-viewer --yesvirt-viewer --connect qemu+ssh://exforge@elma/system testkvm"><div></div></button></div></figure></div>
<p>Replace <code dir="auto">exforge</code> with your username on the server and <code dir="auto">elma</code> with your server’s hostname.</p>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="3-remote-graphical-management">3. Remote Graphical Management</h2><a class="sl-anchor-link" href="#3-remote-graphical-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “3. Remote Graphical Management”</span></a></div>
<hr>
<p>Our server lacks a graphical interface (like most servers). For graphical management, install <code dir="auto">virt-manager</code> on your workstation:</p>
<p><strong>Run on your workstation:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt update</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install virt-manager --yes</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-manager</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt updatesudo apt install virt-manager --yesvirt-manager"><div></div></button></div></figure></div>
<p>The application appears in the Applications Menu as “Virtual Machine Manager.”</p>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="4-installing-vms-from-pre-built-images">4. Installing VMs from Pre-built Images</h2><a class="sl-anchor-link" href="#4-installing-vms-from-pre-built-images"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4. Installing VMs from Pre-built Images”</span></a></div>
<hr>
<p>Installing an OS from scratch is time-consuming. An alternative is using pre-built cloud images with cloud-init configuration.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="40-installing-cloud-image-utils">4.0. Installing cloud-image-utils</h3><a class="sl-anchor-link" href="#40-installing-cloud-image-utils"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.0. Installing cloud-image-utils”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt update</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install cloud-image-utils --yes</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt updatesudo apt install cloud-image-utils --yes"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="41-acquiring-cloud-images">4.1. Acquiring Cloud Images</h3><a class="sl-anchor-link" href="#41-acquiring-cloud-images"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.1. Acquiring Cloud Images”</span></a></div>
<p>Search for cloud images:</p>
<ul>
<li><strong>Ubuntu</strong>: <a href="https://cloud-images.ubuntu.com/">cloud-images.ubuntu.com</a></li>
<li><strong>Debian</strong>: <a href="https://cloud.debian.org/images/cloud/">cloud.debian.org</a></li>
</ul>
<p>Download the latest images (e.g., Ubuntu 24.04 Noble and Debian 13 Trixie) to <code dir="auto">/srv/isos</code>.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">cd /srv/isos</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo wget https://cloud-images.ubuntu.com/noble/current/noble-server-cloudimg-amd64.img</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo wget https://cloud.debian.org/images/cloud/trixie/latest/debian-13-generic-amd64.qcow2</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="cd /srv/isossudo wget https://cloud-images.ubuntu.com/noble/current/noble-server-cloudimg-amd64.imgsudo wget https://cloud.debian.org/images/cloud/trixie/latest/debian-13-generic-amd64.qcow2"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="42-creating-a-new-image-from-the-original-image">4.2. Creating a New Image From the Original Image</h3><a class="sl-anchor-link" href="#42-creating-a-new-image-from-the-original-image"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.2. Creating a New Image From the Original Image”</span></a></div>
<p>Create new images with increased size (20 GB) and convert to qcow2 format.</p>
<p><strong>Ubuntu image:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create -b /srv/isos/noble-server-cloudimg-amd64.img \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">-F qcow2 -f qcow2 /srv/kvm/ubuntusrv-cloudimg.qcow2 20G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create -b /srv/isos/noble-server-cloudimg-amd64.img \    -F qcow2 -f qcow2 /srv/kvm/ubuntusrv-cloudimg.qcow2 20G"><div></div></button></div></figure></div>
<p><strong>Debian image:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create -b /srv/isos/debian-13-generic-amd64.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">-F qcow2 -f qcow2 /srv/kvm/debiansrv-cloudimg.qcow2 20G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create -b /srv/isos/debian-13-generic-amd64.qcow2 \    -F qcow2 -f qcow2 /srv/kvm/debiansrv-cloudimg.qcow2 20G"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="43-cloud-init-configuration">4.3. Cloud-init Configuration</h3><a class="sl-anchor-link" href="#43-cloud-init-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.3. Cloud-init Configuration”</span></a></div>
<p>The next step is to crate a cloud-init config file. This file contains instructions for the cloud image. There is a wide range of instructions like; creating a user, creating and filling files, adding apt repositories, running initial commands, installing packages, reboot and poweroff after finishing, disk and configuration. See below url for details:</p>
<p><a href="https://cloudinit.readthedocs.io/en/latest/reference/examples.html">cloudinit.readthedocs.io</a></p>
<p>Our cloud-init file will configure the following:</p>
<ul>
<li>Set hostname and Fully Qualified Domain Name,</li>
<li>Create a user named exforge with sudo privileges,</li>
<li>assign its password,</li>
<li>add it to exforge group as primary,</li>
<li>also add it to users group,</li>
<li>create its home directory as /home/exforge,</li>
<li>and set its shell to bash.</li>
</ul>
<p>First, generate a password hash:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install whois --yes</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">mkpasswd --method=SHA-512 --rounds=4096</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt install whois --yesmkpasswd --method=SHA-512 --rounds=4096"><div></div></button></div></figure></div>
<p>Enter the desired password and copy the hash output.</p>
<p>We will create configuration files in <code dir="auto">/srv/init</code>. Create the folder:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo mkdir /srv/init</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo mkdir /srv/init"><div></div></button></div></figure></div>
<p><strong>Ubuntu cloud-init configuration:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /srv/init/ubuntu-cloud-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /srv/init/ubuntu-cloud-init.cfg"><div></div></button></div></figure></div>
<p>Fill as below (Remember updating password with the hash you get):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#cloud-config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">hostname: ubuntu24</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">fqdn: ubuntu24.x386.org</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">manage_etc_hosts: true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">groups: exforge</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">users:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">- name: exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">sudo: ALL=(ALL) ALL</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">primary_group: exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">groups: users</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">home: /home/exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">shell: /bin/bash</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">lock_passwd: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">passwd: $6$rounds=4096$hVAmry7V/zE8KHCT$Ha.qFtVJLDxRhmKTFY3hFhQqXmWrbF3n39dlWMXnmIAmdm5hJriRWRHVlT7FtaVUHIPeSm5u966vOcXFfXCyI/</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">packages: qemu-guest-agent</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#cloud-confighostname: ubuntu24fqdn: ubuntu24.x386.orgmanage_etc_hosts: truegroups: exforgeusers:   - name: exforge     sudo: ALL=(ALL) ALL     primary_group: exforge     groups: users     home: /home/exforge     shell: /bin/bash     lock_passwd: false     passwd: $6$rounds=4096$hVAmry7V/zE8KHCT$Ha.qFtVJLDxRhmKTFY3hFhQqXmWrbF3n39dlWMXnmIAmdm5hJriRWRHVlT7FtaVUHIPeSm5u966vOcXFfXCyI/packages: qemu-guest-agent"><div></div></button></div></figure></div>
<p><strong>Debian cloud-init configuration:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /srv/init/debian-cloud-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /srv/init/debian-cloud-init.cfg"><div></div></button></div></figure></div>
<p>Fill as below (Again remember updating password with the hash you get):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#cloud-config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">hostname: debian13</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">fqdn: debian13.x386.org</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">manage_etc_hosts: true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">groups: exforge</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">users:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">- name: exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">sudo: ALL=(ALL) ALL</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">primary_group: exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">groups: users</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">home: /home/exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">shell: /bin/bash</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">lock_passwd: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">passwd: $6$rounds=4096$hVAmry7V/zE8KHCT$Ha.qFtVJLDxRhmKTFY3hFhQqXmWrbF3n39dlWMXnmIAmdm5hJriRWRHVlT7FtaVUHIPeSm5u966vOcXFfXCyI/</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">packages: qemu-guest-agent</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#cloud-confighostname: debian13fqdn: debian13.x386.orgmanage_etc_hosts: truegroups: exforgeusers:   - name: exforge     sudo: ALL=(ALL) ALL     primary_group: exforge     groups: users     home: /home/exforge     shell: /bin/bash     lock_passwd: false     passwd: $6$rounds=4096$hVAmry7V/zE8KHCT$Ha.qFtVJLDxRhmKTFY3hFhQqXmWrbF3n39dlWMXnmIAmdm5hJriRWRHVlT7FtaVUHIPeSm5u966vOcXFfXCyI/packages: qemu-guest-agent"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="44-cloud-init-network-configuration">4.4. Cloud-init Network Configuration</h3><a class="sl-anchor-link" href="#44-cloud-init-network-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.4. Cloud-init Network Configuration”</span></a></div>
<p>For static IP configuration, create network config files.</p>
<p><strong>Ubuntu network configuration:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /srv/init/ubuntu-network-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /srv/init/ubuntu-network-init.cfg"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#cloud-config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">version: 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">ethernets:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">enp1s0:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp4: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">addresses: [ 192.168.1.243/24 ]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">gateway4: 192.168.1.1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">nameservers:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">       </span></span><span style="--0:#d6deeb;--1:#403f53">addresses: [ 192.168.1.1,8.8.8.8 ]</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#cloud-configversion: 2ethernets:  enp1s0:     dhcp4: false     addresses: [ 192.168.1.243/24 ]     gateway4: 192.168.1.1     nameservers:       addresses: [ 192.168.1.1,8.8.8.8 ]"><div></div></button></div></figure></div>
<p><strong>Debian network configuration:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /srv/init/debian-network-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /srv/init/debian-network-init.cfg"><div></div></button></div></figure></div>
<p>Fill as below:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#cloud-config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">version: 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">ethernets:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">enp1s0:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp4: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">addresses: [ 192.168.1.244/24 ]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">gateway4: 192.168.1.1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">nameservers:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">       </span></span><span style="--0:#d6deeb;--1:#403f53">addresses: [ 192.168.1.1,8.8.8.8 ]</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#cloud-configversion: 2ethernets:  enp1s0:     dhcp4: false     addresses: [ 192.168.1.244/24 ]     gateway4: 192.168.1.1     nameservers:       addresses: [ 192.168.1.1,8.8.8.8 ]"><div></div></button></div></figure></div>
<p>Adjust IP addresses according to your network.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="45-creating-cloud-init-seed-images">4.5. Creating Cloud-init Seed Images</h3><a class="sl-anchor-link" href="#45-creating-cloud-init-seed-images"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.5. Creating Cloud-init Seed Images”</span></a></div>
<p>Create seed images containing cloud-init and network configurations.</p>
<p><strong>Ubuntu seed image:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo cloud-localds --network-config /srv/init/ubuntu-network-init.cfg \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/kvm/ubuntu24-seed.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/init/ubuntu-cloud-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo cloud-localds --network-config /srv/init/ubuntu-network-init.cfg \   /srv/kvm/ubuntu24-seed.qcow2 \   /srv/init/ubuntu-cloud-init.cfg"><div></div></button></div></figure></div>
<p><strong>Debian seed image:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo cloud-localds --network-config /srv/init/debian-network-init.cfg \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/kvm/debian13-seed.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/init/debian-cloud-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo cloud-localds --network-config /srv/init/debian-network-init.cfg \   /srv/kvm/debian13-seed.qcow2 \   /srv/init/debian-cloud-init.cfg"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="46-start-vms-from-cloud-images">4.6. Start VMs from Cloud Images</h3><a class="sl-anchor-link" href="#46-start-vms-from-cloud-images"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.6. Start VMs from Cloud Images”</span></a></div>
<p><strong>Ubuntu Server VM:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-install --name ubuntu24 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--connect qemu:///system \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--virt-type kvm --memory 2048 --vcpus 2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--boot hd,menu=on \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/ubuntu24-seed.qcow2,device=cdrom \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/ubuntusrv-cloudimg.qcow2,device=disk \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--graphics vnc,port=5902,listen=0.0.0.0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--os-variant ubuntu24.04 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--network bridge=br0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--noautoconsole \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--install no_install=yes</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virt-install --name ubuntu24 \  --connect qemu:///system \  --virt-type kvm --memory 2048 --vcpus 2 \  --boot hd,menu=on \  --disk path=/srv/kvm/ubuntu24-seed.qcow2,device=cdrom \  --disk path=/srv/kvm/ubuntusrv-cloudimg.qcow2,device=disk \  --graphics vnc,port=5902,listen=0.0.0.0 \  --os-variant ubuntu24.04 \  --network bridge=br0 \  --noautoconsole \  --install no_install=yes"><div></div></button></div></figure></div>
<p><strong>Debian Server VM:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-install --name debian13 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--connect qemu:///system \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--virt-type kvm --memory 2048 --vcpus 2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--boot hd,menu=on \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/debian13-seed.qcow2,device=cdrom \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/debiansrv-cloudimg.qcow2,device=disk \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--graphics vnc,port=5903,listen=0.0.0.0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--os-variant debian13 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--network bridge=br0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--noautoconsole \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--install no_install=yes</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virt-install --name debian13 \  --connect qemu:///system \  --virt-type kvm --memory 2048 --vcpus 2 \  --boot hd,menu=on \  --disk path=/srv/kvm/debian13-seed.qcow2,device=cdrom \  --disk path=/srv/kvm/debiansrv-cloudimg.qcow2,device=disk \  --graphics vnc,port=5903,listen=0.0.0.0 \  --os-variant debian13 \  --network bridge=br0 \  --noautoconsole \  --install no_install=yes"><div></div></button></div></figure></div>
<p><strong>Note</strong>: If <code dir="auto">--os-variant debian13</code> fails on Ubuntu servers, try <code dir="auto">--os-variant debian11</code>.</p>
<p>Cloud-init may take several minutes to complete. Connect via virt-viewer:</p>
<p>** Run on your workstation **</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-viewer --connect qemu+ssh://exforge@elma/system ubuntu24</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-viewer --connect qemu+ssh://exforge@elma/system debian13</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virt-viewer --connect qemu+ssh://exforge@elma/system ubuntu24virt-viewer --connect qemu+ssh://exforge@elma/system debian13"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="47-disable-cloud-init-after-initial-configuration">4.7. Disable Cloud-init After Initial Configuration</h3><a class="sl-anchor-link" href="#47-disable-cloud-init-after-initial-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.7. Disable Cloud-init After Initial Configuration”</span></a></div>
<p>On each VM, run:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo touch /etc/cloud/cloud-init.disabled</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo touch /etc/cloud/cloud-init.disabled"><div></div></button></div></figure></div>
<p>This prevents cloud-init from running on subsequent boots.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="48-automation-with-python-script">4.8. Automation with Python Script</h3><a class="sl-anchor-link" href="#48-automation-with-python-script"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.8. Automation with Python Script”</span></a></div>
<p>The entire process (except step 4.7) can be automated with a Python script:</p>
<ol>
<li>Download the latest cloud image (or use cached)</li>
<li>Create a new base image with <code dir="auto">qemu-img create</code></li>
<li>Generate password hash and create cloud-init files</li>
<li>Create seed image with <code dir="auto">cloud-localds</code></li>
<li>Launch VM with <code dir="auto">virt-install</code></li>
</ol>
<p>Script parameters could include:</p>
<ul>
<li>Image name and size</li>
<li>Username and password</li>
<li>Network properties (IP, gateway, DNS)</li>
<li>Memory size and vCPU count</li>
<li>VNC port number</li>
</ul>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="5-virsh-shell-based-vm-management">5. virsh: Shell Based VM Management</h2><a class="sl-anchor-link" href="#5-virsh-shell-based-vm-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5. virsh: Shell Based VM Management”</span></a></div>
<hr>
<p>virt-manager handles basic management tasks, but advanced administration requires the command-line interface.</p>
<p>The <code dir="auto">virsh</code> command offers extensive capabilities. I’ll cover the most useful commands here (in my opinion).</p>
<p>For complete documentation, visit: <a href="https://www.libvirt.org/manpages/virsh.html">www.libvirt.org</a></p>
<p>In all examples, replace <code dir="auto">NAME</code> with your VM’s name.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="50-environment-variable-set">5.0. Environment Variable Set</h3><a class="sl-anchor-link" href="#50-environment-variable-set"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.0. Environment Variable Set”</span></a></div>
<p>On Debian, to run <code dir="auto">virsh</code> commands without <code dir="auto">sudo</code>, set an environment variable:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">export LIBVIRT_DEFAULT_URI='qemu:///system'</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="export LIBVIRT_DEFAULT_URI=&#x27;qemu:///system&#x27;"><div></div></button></div></figure></div>
<p>For permanent setup, add to your shell profile:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">nano ~/.bashrc</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="nano ~/.bashrc"><div></div></button></div></figure></div>
<p>Add this line:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">export LIBVIRT_DEFAULT_URI='qemu:///system'</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="export LIBVIRT_DEFAULT_URI=&#x27;qemu:///system&#x27;"><div></div></button></div></figure></div>
<p>Then reload:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">source ~/.bashrc</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="source ~/.bashrc"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="51-host-information">5.1. Host Information</h3><a class="sl-anchor-link" href="#51-host-information"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.1. Host Information”</span></a></div>
<p>Display host system details:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh nodeinfo</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh nodeinfo"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="52-list-vms-and-their-states">5.2. List VMs and Their States</h3><a class="sl-anchor-link" href="#52-list-vms-and-their-states"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.2. List VMs and Their States”</span></a></div>
<p>List running VMs:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh list</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh list"><div></div></button></div></figure></div>
<p>List all VMs (running and stopped):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh list --all</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh list --all"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="53-vm-lifecycle-management">5.3. VM Lifecycle Management</h3><a class="sl-anchor-link" href="#53-vm-lifecycle-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.3. VM Lifecycle Management”</span></a></div>
<p>Start, stop, reboot, force stop, or remove a VM:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh start NAME                  # Start VM</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh shutdown NAME               # Graceful shutdown</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh reboot NAME                 # Reboot VM</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh destroy NAME                # Force shutdown (power off)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh undefine NAME               # Remove VM definition</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh undefine NAME --remove-all-storage  # Remove VM with all storage</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh start NAME                  # Start VMvirsh shutdown NAME               # Graceful shutdownvirsh reboot NAME                 # Reboot VMvirsh destroy NAME                # Force shutdown (power off)virsh undefine NAME               # Remove VM definitionvirsh undefine NAME --remove-all-storage  # Remove VM with all storage"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="54-pause-and-resume-vm">5.4. Pause and Resume VM</h3><a class="sl-anchor-link" href="#54-pause-and-resume-vm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.4. Pause and Resume VM”</span></a></div>
<p>Suspend and resume VM execution:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh suspend NAME                # Pause VM</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh resume NAME                 # Resume VM</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh suspend NAME                # Pause VMvirsh resume NAME                 # Resume VM"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="55-autostart-configuration">5.5. Autostart Configuration</h3><a class="sl-anchor-link" href="#55-autostart-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.5. Autostart Configuration”</span></a></div>
<p>Configure VM to start automatically with host boot:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh autostart NAME              # Enable autostart</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh autostart --disable NAME    # Disable autostart</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh autostart NAME              # Enable autostartvirsh autostart --disable NAME    # Disable autostart"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="56-vm-information">5.6. VM Information</h3><a class="sl-anchor-link" href="#56-vm-information"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.6. VM Information”</span></a></div>
<p>Display various VM details:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh dominfo NAME                # General VM information</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh domid NAME                  # VM ID</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh domuuid NAME                # VM UUID</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh domstate NAME               # Current state (running, shut off, etc.)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh domdisplay NAME             # VNC/display connection details</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh dominfo NAME                # General VM informationvirsh domid NAME                  # VM IDvirsh domuuid NAME                # VM UUIDvirsh domstate NAME               # Current state (running, shut off, etc.)virsh domdisplay NAME             # VNC/display connection details"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="57-vm-memory-management">5.7. VM Memory Management</h3><a class="sl-anchor-link" href="#57-vm-memory-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.7. VM Memory Management”</span></a></div>
<p>VMs have two memory parameters:</p>
<ul>
<li><strong>Current Memory</strong>: Currently allocated RAM</li>
<li><strong>Maximum Memory</strong>: Maximum allocatable RAM</li>
</ul>
<p>View current allocation:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh dominfo NAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh dominfo NAME"><div></div></button></div></figure></div>
<p>Change maximum memory (requires shutdown and start to activate):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmaxmem NAME 2G --config</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setmaxmem NAME 2G --config"><div></div></button></div></figure></div>
<p><strong>Note</strong>: Size can be specified as <code dir="auto">2G</code>, <code dir="auto">1536M</code>, etc.</p>
<p>Change current memory allocation:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmem NAME 2G              # Current session only</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmem NAME 2G --live       # Live change (immediate)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmem NAME 2G --config     # Persistent after shutdown/start</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmem NAME 2G --live --config  # Immediate + persistent</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setmem NAME 2G              # Current session onlyvirsh setmem NAME 2G --live       # Live change (immediate)virsh setmem NAME 2G --config     # Persistent after shutdown/startvirsh setmem NAME 2G --live --config  # Immediate + persistent"><div></div></button></div></figure></div>
<p><strong>Warning</strong>: Decreasing memory on a running VM is not recommended.</p>
<p><strong>Beware of Shutdown and Start. Reboots do not count.</strong></p>
<div class="sl-heading-wrapper level-h3"><h3 id="58-vm-vcpu-management">5.8. VM vCPU Management</h3><a class="sl-anchor-link" href="#58-vm-vcpu-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.8. VM vCPU Management”</span></a></div>
<p>VMs have two vCPU parameters:</p>
<ul>
<li><strong>Current</strong>: Active vCPUs</li>
<li><strong>Maximum</strong>: Maximum allocatable vCPUs</li>
</ul>
<p>Two states exist:</p>
<ul>
<li><strong>Config</strong>: Persistent state (after shutdown and start)</li>
<li><strong>Live</strong>: Current running state</li>
</ul>
<p>A cartesian product gives us 4 values:</p>
<ul>
<li><strong>maximum config</strong>: Max number of vCPUs, valid after shutdown and start.</li>
<li><strong>maximum live</strong>: Max number of vCPUs, valid now (while running).</li>
<li><strong>current config</strong>: Active number of vCPUs, valid after shutdown and start.</li>
<li><strong>current live</strong>: Active number of vCPUs, valid now (while running).</li>
</ul>
<p>View vCPU information:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh vcpucount NAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh vcpucount NAME"><div></div></button></div></figure></div>
<p>I keep saying shutdown and start instead of restart or reboot, because kvm, qemu or whatever it is, acts differently when you reboot or shutdown  and then start the VM.</p>
<p>So when I say shutdown and start, I mean shutdown first, wait a while (from 0.001 miliseconds to as long as you want) and then start the VM.</p>
<p>Change maximum vCPUs (config state only - requires shutdown and start to activate):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME NUMBER --maximum --config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3 --maximum --config</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setvcpus NAME NUMBER --maximum --configvirsh setvcpus ubuntu24 3 --maximum --config"><div></div></button></div></figure></div>
<p>Change current vCPU count:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME 3             # Current session</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME 3 --live      # Live change</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME 3 --config    # Persistent change</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME 3 --live --config  # Both immediate and persistent</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3 --live</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3 --current</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3 --live --config</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setvcpus NAME 3             # Current sessionvirsh setvcpus NAME 3 --live      # Live changevirsh setvcpus NAME 3 --config    # Persistent changevirsh setvcpus NAME 3 --live --config  # Both immediate and persistentvirsh setvcpus ubuntu24 3virsh setvcpus ubuntu24 3 --livevirsh setvcpus ubuntu24 3 --currentvirsh setvcpus ubuntu24 3 --live --config"><div></div></button></div></figure></div>
<p><strong>Important</strong>: After increasing vCPUs on a running VM, new vCPUs may be offline. Check online status on the VM:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">lscpu | head</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="lscpu | head"><div></div></button></div></figure></div>
<p>Activate offline vCPU (on the VM):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo sh -c 'echo 1 > /sys/devices/system/cpu/cpu2/online'</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo sh -c &#x27;echo 1 > /sys/devices/system/cpu/cpu2/online&#x27;"><div></div></button></div></figure></div>
<p>Replace <code dir="auto">cpu2</code> with the appropriate vCPU number (starting from 0).</p>
<div class="sl-heading-wrapper level-h3"><h3 id="59-snapshots">5.9. Snapshots</h3><a class="sl-anchor-link" href="#59-snapshots"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.9. Snapshots”</span></a></div>
<p>Create a live snapshot:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-create-as VMNAME \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--name SNAPSHOTNAME \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--description "Description text"</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh snapshot-create-as VMNAME \  --name SNAPSHOTNAME \  --description &#x22;Description text&#x22;"><div></div></button></div></figure></div>
<p>Example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-create-as ubuntu24 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--name ss1-ubuntu24 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--description "First snapshot of Ubuntu24"</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh snapshot-create-as ubuntu24 \  --name ss1-ubuntu24 \  --description &#x22;First snapshot of Ubuntu24&#x22;"><div></div></button></div></figure></div>
<p>Manage snapshots:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-revert VMNAME --current            # Revert to current snapshot</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-revert VMNAME --snapshotname SNAPSHOTNAME  # Revert to specific</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-current VMNAME --name              # Show current snapshot</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-delete VMNAME --current            # Delete current snapshot</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-delete VMNAME --snapshotname SNAPSHOTNAME  # Delete specific</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-list VMNAME                        # List all snapshots</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh snapshot-revert VMNAME --current            # Revert to current snapshotvirsh snapshot-revert VMNAME --snapshotname SNAPSHOTNAME  # Revert to specificvirsh snapshot-current VMNAME --name              # Show current snapshotvirsh snapshot-delete VMNAME --current            # Delete current snapshotvirsh snapshot-delete VMNAME --snapshotname SNAPSHOTNAME  # Delete specificvirsh snapshot-list VMNAME                        # List all snapshots"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="510-attach-another-disk-to-a-vm">5.10. Attach Another Disk to a VM</h3><a class="sl-anchor-link" href="#510-attach-another-disk-to-a-vm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.10. Attach Another Disk to a VM”</span></a></div>
<p>Add a secondary disk to a VM (e.g., 20GB for Ubuntu24).</p>
<p>Create a new disk image:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create -f qcow2 /srv/kvm/ubuntu24-disk2.qcow2 20G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create -f qcow2 /srv/kvm/ubuntu24-disk2.qcow2 20G"><div></div></button></div></figure></div>
<p>Identify disk naming on VM (run on VM):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">lsblk -o name -d | grep vd</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="lsblk -o name -d | grep vd"><div></div></button></div></figure></div>
<p>Typical names: <code dir="auto">vda</code> (primary), <code dir="auto">vdb</code> (secondary), etc.</p>
<p>Attach disk to VM:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh attach-disk ubuntu24 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/kvm/ubuntu24-disk2.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">vdb \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--persistent</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh attach-disk ubuntu24 \  /srv/kvm/ubuntu24-disk2.qcow2 \  vdb \  --persistent"><div></div></button></div></figure></div>
<p>Options:</p>
<ul>
<li><code dir="auto">--persistent</code>: Survives shutdown/start</li>
<li><code dir="auto">--live</code>: Current session only</li>
<li><code dir="auto">--config</code>: Persistent but not immediate</li>
</ul>
<p>Detach disk:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh detach-disk ubuntu24 vdb --persistent</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh detach-disk ubuntu24 vdb --persistent"><div></div></button></div></figure></div>
<p>As in virsh attach-disk, you can change —persistent option to —live or  —config.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="511-other-virsh-commands">5.11. Other virsh Commands</h3><a class="sl-anchor-link" href="#511-other-virsh-commands"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.11. Other virsh Commands”</span></a></div>
<p>Get the list of all virsh subcommands:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh --help</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh --help"><div></div></button></div></figure></div>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="6-qemu-img-shell-based-image-management">6. qemu-img: Shell Based Image Management</h2><a class="sl-anchor-link" href="#6-qemu-img-shell-based-image-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6. qemu-img: Shell Based Image Management”</span></a></div>
<hr>
<p><code dir="auto">qemu-img</code> manipulates VM disk images. <strong>Important</strong>: Always stop the VM before using <code dir="auto">qemu-img</code> on its images.</p>
<p>Complete documentation: <a href="https://www.qemu.org/docs/master/tools/qemu-img.html">www.qemu.org</a></p>
<div class="sl-heading-wrapper level-h3"><h3 id="61-get-basic-image-information">6.1. Get Basic Image Information</h3><a class="sl-anchor-link" href="#61-get-basic-image-information"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6.1. Get Basic Image Information”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">qemu-img info FILENAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="qemu-img info FILENAME"><div></div></button></div></figure></div>
<p>Example for Ubuntu24 VM:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">qemu-img info /srv/kvm/ubuntusrv-cloudimg.qcow2</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="qemu-img info /srv/kvm/ubuntusrv-cloudimg.qcow2"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="62-creating-an-image">6.2. Creating an Image</h3><a class="sl-anchor-link" href="#62-creating-an-image"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6.2. Creating an Image”</span></a></div>
<p>Create a new image:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">qemu-img create -f FORMAT FILENAME SIZE</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="qemu-img create -f FORMAT FILENAME SIZE"><div></div></button></div></figure></div>
<p>Example (from section 5.10):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create -f qcow2 /srv/kvm/ubuntu24-disk2.qcow2 20G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create -f qcow2 /srv/kvm/ubuntu24-disk2.qcow2 20G"><div></div></button></div></figure></div>
<p>Create an image backed by another image (differencing image):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">-b BACKINGFILENAME \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">-F BACKINGFILEFORMAT \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">-f OUTPUTFILEFORMAT \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">OUTPUTFILENAME \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">SIZE</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create \  -b BACKINGFILENAME \  -F BACKINGFILEFORMAT \  -f OUTPUTFILEFORMAT \  OUTPUTFILENAME \  SIZE"><div></div></button></div></figure></div>
<p>Example (from section 4.2):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">-b /srv/isos/noble-server-cloudimg-amd64.img \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">-F qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">-f qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/kvm/ubuntusrv2-cloudimg.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">20G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create \  -b /srv/isos/noble-server-cloudimg-amd64.img \  -F qcow2 \  -f qcow2 \  /srv/kvm/ubuntusrv2-cloudimg.qcow2 \  20G"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="63-converting-image-formats">6.3. Converting Image Formats</h3><a class="sl-anchor-link" href="#63-converting-image-formats"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6.3. Converting Image Formats”</span></a></div>
<p>Common formats:</p>
<ul>
<li><strong>raw</strong>: Simple, unformatted binary</li>
<li><strong>qcow2</strong>: QEMU format with snapshots, compression, encryption</li>
<li><strong>qcow</strong>: Older QEMU format</li>
<li><strong>vdi</strong>: VirtualBox format</li>
<li><strong>vmdk</strong>: VMware format</li>
<li><strong>vhdx</strong>: Microsoft Hyper-V format</li>
<li><strong>dmg</strong>: Apple Disk Image</li>
</ul>
<p>Convert between formats:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">qemu-img convert \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">-f SOURCEFORMAT \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">-O DESTINATIONFORMAT \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">SOURCEFILE \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">DESTFILE</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="qemu-img convert \  -f SOURCEFORMAT \  -O DESTINATIONFORMAT \  SOURCEFILE \  DESTFILE"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="64-resize-a-disk-image">6.4. Resize a Disk Image.</h3><a class="sl-anchor-link" href="#64-resize-a-disk-image"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6.4. Resize a Disk Image.”</span></a></div>
<p>Increase or decrease image size:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img resize FILENAME [+|-]SIZE</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img resize FILENAME [+|-]SIZE"><div></div></button></div></figure></div>
<p>Increase Ubuntu24 image by 5GB:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img resize /srv/kvm/ubuntusrv-cloudimg.qcow2 +5G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img resize /srv/kvm/ubuntusrv-cloudimg.qcow2 +5G"><div></div></button></div></figure></div>
<p><strong>Warning</strong>: To shrink an image:</p>
<ol>
<li>Use <code dir="auto">--shrink</code> flag: <code dir="auto">qemu-img resize --shrink FILENAME -SIZE</code></li>
<li>Shrink partitions/filesystem inside VM first</li>
<li>Verify disk usage before shrinking</li>
</ol>
<div class="sl-heading-wrapper level-h3"><h3 id="65-check-an-image-for-errors">6.5. Check an Image For Errors</h3><a class="sl-anchor-link" href="#65-check-an-image-for-errors"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6.5. Check an Image For Errors”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">qemu-img check FILENAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="qemu-img check FILENAME"><div></div></button></div></figure></div>
<p>Use if you suspect image corruption.</p>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="7-export-and-import-of-vms">7. Export and Import of VMs</h2><a class="sl-anchor-link" href="#7-export-and-import-of-vms"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “7. Export and Import of VMs”</span></a></div>
<hr>
<p>Migrate VMs between hosts or create backups.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="71-export">7.1. Export</h3><a class="sl-anchor-link" href="#71-export"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “7.1. Export”</span></a></div>
<hr>
<p><strong>Important</strong>: Shut down the VM before export for data consistency.</p>
<p>Create backup directory:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">mkdir /tmp/kvmbackup</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="mkdir /tmp/kvmbackup"><div></div></button></div></figure></div>
<p>Export VM definition (XML):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh dumpxml ubuntu24 > /tmp/kvmbackup/ubuntu24.xml</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh dumpxml ubuntu24 > /tmp/kvmbackup/ubuntu24.xml"><div></div></button></div></figure></div>
<p>Identify disk images from XML:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">grep "source file" /tmp/kvmbackup/ubuntu24.xml</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="grep &#x22;source file&#x22; /tmp/kvmbackup/ubuntu24.xml"><div></div></button></div></figure></div>
<p>Example output:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">&#x3C;source file='/srv/kvm/ubuntu24-seed.qcow2'/></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">&#x3C;source file='/srv/kvm/ubuntusrv-cloudimg.qcow2'/></span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="      <source file=&#x27;/srv/kvm/ubuntu24-seed.qcow2&#x27;/>      <source file=&#x27;/srv/kvm/ubuntusrv-cloudimg.qcow2&#x27;/>"><div></div></button></div></figure></div>
<p>Copy disk images to backup location:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">cp /srv/kvm/ubuntu24-seed.qcow2 /srv/kvm/ubuntusrv-cloudimg.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/tmp/kvmbackup</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="cp /srv/kvm/ubuntu24-seed.qcow2 /srv/kvm/ubuntusrv-cloudimg.qcow2 \   /tmp/kvmbackup"><div></div></button></div></figure></div>
<p>Create archive:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">tar -cf /tmp/ubuntu24.tar -C /tmp/kvmbackup .</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="tar -cf /tmp/ubuntu24.tar -C /tmp/kvmbackup ."><div></div></button></div></figure></div>
<p>You have to copy this file to another server, before importing there.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="72-import">7.2. Import</h3><a class="sl-anchor-link" href="#72-import"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “7.2. Import”</span></a></div>
<p><strong>Important</strong>: Remove or rename VM on source host to avoid IP conflicts.</p>
<p>Copy archive to new host, then:</p>
<p>Create import directory:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">mkdir /tmp/import</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="mkdir /tmp/import"><div></div></button></div></figure></div>
<p>Extract archive:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">tar -xf /tmp/ubuntu24.tar -C /tmp/import</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="tar -xf /tmp/ubuntu24.tar -C /tmp/import"><div></div></button></div></figure></div>
<p>Copy disk images to storage location:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo cp \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">/tmp/import/ubuntu24-seed.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">/tmp/import/ubuntusrv-cloudimg.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/kvm/</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo cp \  /tmp/import/ubuntu24-seed.qcow2 \  /tmp/import/ubuntusrv-cloudimg.qcow2 \  /srv/kvm/"><div></div></button></div></figure></div>
<p>Define VM from XML:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh define /tmp/import/ubuntu24.xml</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh define /tmp/import/ubuntu24.xml"><div></div></button></div></figure></div>
<p>Start VM:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh start ubuntu24</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh start ubuntu24"><div></div></button></div></figure></div>
<p><strong>Note</strong>: If using different directory structure, edit XML file paths before defining.</p>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="8-libguestfs-vm-disk-management">8. libguestfs: VM Disk Management</h2><a class="sl-anchor-link" href="#8-libguestfs-vm-disk-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “8. libguestfs: VM Disk Management”</span></a></div>
<hr>
<p>Tools for accessing and modifying VM disk images without starting the VM.</p>
<p>Documentation: <a href="https://libguestfs.org/">libguestfs.org</a></p>
<div class="sl-heading-wrapper level-h3"><h3 id="81-installation">8.1. Installation</h3><a class="sl-anchor-link" href="#81-installation"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “8.1. Installation”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt update</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt-get --yes install libguestfs-tools</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt updatesudo apt-get --yes install libguestfs-tools"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="82-mounting-vms-disks">8.2. Mounting VM’s Disks</h3><a class="sl-anchor-link" href="#82-mounting-vms-disks"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “8.2. Mounting VM’s Disks”</span></a></div>
<p>Mount VM disk read-only (safer):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo guestmount -d ubuntu24 -i --ro /mnt</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo guestmount -d ubuntu24 -i --ro /mnt"><div></div></button></div></figure></div>
<p>Mount with write access (use with caution -  VM must be shut down):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo guestmount -d ubuntu24 -i /mnt</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo guestmount -d ubuntu24 -i /mnt"><div></div></button></div></figure></div>
<p>Unmount:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo guestunmount /mnt</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo guestunmount /mnt"><div></div></button></div></figure></div>
<p>Details for guestmount and guestunmount commands:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">guestmount --help</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">guestunmount --help</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="guestmount --helpguestunmount --help"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="83-common-libguestfs-commands">8.3. Common libguestfs Commands</h3><a class="sl-anchor-link" href="#83-common-libguestfs-commands"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “8.3. Common libguestfs Commands”</span></a></div>
<ul>
<li><strong>guestfish</strong>: Interactive shell for disk manipulation</li>
<li><strong>guestmount</strong>: Mount guest filesystem on host</li>
<li><strong>guestunmount</strong>: Unmount guest filesystem</li>
<li><strong>virt-cat</strong>: Display file from VM</li>
<li><strong>virt-copy-in</strong>: Copy files into VM</li>
<li><strong>virt-copy-out</strong>: Copy files from VM</li>
<li><strong>virt-edit</strong>: Edit file in VM</li>
<li><strong>virt-ls</strong>: List files in VM</li>
<li><strong>virt-df</strong>: Show disk usage</li>
<li><strong>virt-filesystems</strong>: List filesystems and partitions</li>
<li><strong>virt-inspector</strong>: Inspect VM image contents</li>
<li><strong>virt-resize</strong>: Resize disk partitions</li>
<li><strong>virt-sparsify</strong>: Make VM disks sparse (thin-provisioned)</li>
<li><strong>virt-sysprep</strong>: Prepare VM for cloning</li>
</ul>
<p><strong>Example</strong>: Copy file from VM:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo virt-copy-out -d ubuntu24 /etc/hostname /tmp/</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo virt-copy-out -d ubuntu24 /etc/hostname /tmp/"><div></div></button></div></figure></div>
<p><strong>Example</strong>: List files in VM:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo virt-ls -d ubuntu24 /etc/</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo virt-ls -d ubuntu24 /etc/"><div></div></button></div></figure></div>
<p><strong>Security Note</strong>: These tools allow host administrators to access VM data without VM knowledge—consider encryption for sensitive VMs.</p>
<br> </div> <footer class="sl-flex astro-3yyafb3n"> <div class="meta sl-flex astro-3yyafb3n">   </div> <div class="pagination-links print:hidden astro-u2l5gyhi" dir="ltr">   </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>