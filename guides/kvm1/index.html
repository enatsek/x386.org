<!DOCTYPE html><html lang="en" dir="ltr" data-theme="dark" data-has-toc data-has-sidebar class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>KVM Virtualization (Beginner) | Debian & Ubuntu Tutorials</title><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v5.16.6"/><meta name="generator" content="Starlight v0.37.1"/><meta property="og:title" content="KVM Virtualization (Beginner)"/><meta property="og:type" content="article"/><meta property="og:locale" content="en"/><meta property="og:description" content="Introduction to KVM virtualization"/><meta property="og:site_name" content="Debian &#38; Ubuntu Tutorials"/><meta name="twitter:card" content="summary_large_image"/><meta name="description" content="Introduction to KVM virtualization"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg><svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg><svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg></template><link rel="stylesheet" href="/_astro/print.DNXP8c50.css" media="print"><link rel="stylesheet" href="/_astro/index.0vIKbS8r.css"><script type="module" src="/_astro/page.B1D-nYk3.js"></script></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">Skip to content</a>  <div class="page sl-flex astro-vrdttmbt"> <header class="header astro-vrdttmbt"><div class="header astro-kmkmnagf"> <div class="title-wrapper sl-flex astro-kmkmnagf"> <a href="/" class="site-title sl-flex astro-m46x6ez3">  <span class="astro-m46x6ez3" translate="no"> Debian &amp; Ubuntu Tutorials </span> </a>  </div> <div class="sl-flex print:hidden astro-kmkmnagf"> <site-search class="astro-kmkmnagf astro-v37mnknz" data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}"> <button data-open-modal disabled aria-label="Search" aria-keyshortcuts="Control+K" class="astro-v37mnknz"> <svg aria-hidden="true" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg> <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span> <kbd class="sl-hidden md:sl-flex astro-v37mnknz" style="display: none;"> <kbd class="astro-v37mnknz">Ctrl</kbd><kbd class="astro-v37mnknz">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> Cancel </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = '⌘';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.cjYDvRdi.js"></script>   </div> <div class="sl-hidden md:sl-flex print:hidden right-group astro-kmkmnagf"> <div class="sl-flex social-icons astro-kmkmnagf"> <a href="https://github.com/enatsek/" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script> <script type="module">const r="starlight-theme",o=e=>e==="auto"||e==="dark"||e==="light"?e:"auto",c=()=>o(typeof localStorage<"u"&&localStorage.getItem(r));function n(e){typeof localStorage<"u"&&localStorage.setItem(r,e==="light"||e==="dark"?e:"")}const l=()=>matchMedia("(prefers-color-scheme: light)").matches?"light":"dark";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e==="auto"?l():e,n(e)}matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>{c()==="auto"&&t("auto")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector("select")?.addEventListener("change",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define("starlight-theme-select",s);</script> <script type="module">class s extends HTMLElement{constructor(){super();const e=this.querySelector("select");e&&(e.addEventListener("change",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)}),window.addEventListener("pageshow",t=>{if(!t.persisted)return;const n=e.querySelector("option[selected]")?.index;n!==e.selectedIndex&&(e.selectedIndex=n??0)}))}}customElements.define("starlight-lang-select",s);</script> </div> </div> </header> <nav class="sidebar print:hidden astro-vrdttmbt" aria-label="Main"> <starlight-menu-button class="print:hidden astro-jif73yzw"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="open-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg> <svg aria-hidden="true" class="close-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="m13.41 12 6.3-6.29a1.004 1.004 0 1 0-1.42-1.42L12 10.59l-6.29-6.3a1.004 1.004 0 0 0-1.42 1.42l6.3 6.29-6.3 6.29a1 1 0 0 0 0 1.42.998.998 0 0 0 1.42 0l6.29-6.3 6.29 6.3a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.42L13.41 12Z"/></svg> </button> </starlight-menu-button> <script type="module">class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector("button"),this.btn.addEventListener("click",()=>this.toggleExpanded());const t=this.closest("nav");t&&t.addEventListener("keyup",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute("aria-expanded",String(t)),document.body.toggleAttribute("data-mobile-menu-expanded",t)}toggleExpanded(){this.setExpanded(this.getAttribute("aria-expanded")!=="true")}closeOnEscape(t){t.code==="Escape"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define("starlight-menu-button",s);</script>   <div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"> <div class="sidebar-content sl-flex astro-vrdttmbt"> <sl-sidebar-state-persist data-hash="1ngezmu" class="astro-kku4brbg"> <script aria-hidden="true">
		(() => {
			try {
				if (!matchMedia('(min-width: 50em)').matches) return;
				/** @type {HTMLElement | null} */
				const target = document.querySelector('sl-sidebar-state-persist');
				const state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');
				if (!target || !state || target.dataset.hash !== state.hash) return;
				window._starlightScrollRestore = state.scroll;
				customElements.define(
					'sl-sidebar-restore',
					class SidebarRestore extends HTMLElement {
						connectedCallback() {
							try {
								const idx = parseInt(this.dataset.index || '');
								const details = this.closest('details');
								if (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];
							} catch {}
						}
					}
				);
			} catch {}
		})();
	</script>  <ul class="top-level astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Site Info</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="0"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/generics/about/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">About</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/generics/contact/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Contact</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/generics/license/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">License</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Web Services &amp; HTTPS</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="1"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/guides/apache/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Apache Web Server</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/nginx/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Nginx Web Server</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/certbot/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Certbot</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/lamp/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">LAMP Stack</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/lapp/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">LAPP Stack</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/wordpress/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">WordPress</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/adminer/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Adminer Tool</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Database Management</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="2"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/guides/mariadb/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MariaDB</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/mariadbcluster/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MariaDB Cluster</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/postgresdebian/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">PostgreSQL (Debian)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/postgresubuntu/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">PostgreSQL (Ubuntu)</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Networking</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="3"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/guides/networkdebian/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Debian Network Configuration</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/networkubuntu/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Ubuntu Network Configuration</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/ufw/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">UFW (Uncomplicated Firewall)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/shvpn/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Self-Hosted VPN</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/s2svpn/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Site-to-Site VPN</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Infrastructure &amp; Virtualization</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="4"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/guides/kvm1/" aria-current="page" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">KVM Virtualization (Beginner)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/kvm2/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">KVM Virtualization (Networking)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/keepalived/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Keepalived</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/haproxy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">HAProxy</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/ansible/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Ansible</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/lvm/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">LVM (Logical Volume Management)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/dns/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DNS</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/ad/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Active Directory</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/nodejs/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Node.js</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <span class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">System Administration Guides</span>  </span> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <sl-sidebar-restore data-index="5"></sl-sidebar-restore> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/guides/useradministration/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">User and Group Administration</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/etcfolder/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">/etc Folder Contents</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/regex/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Regular Expressions</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/filecompression/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">File Compression</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/fhs/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">FHS (Filesystem Hierarchy Standard)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/systemd/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Systemd Basics</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/systemd2/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Systemd Additional</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/debpackaging/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Debian Packaging</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/guides/otherlinuxes/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Other Linux Distributions</span>  </a> </li> </ul>  </details> </li> </ul>   <script aria-hidden="true">
		(() => {
			const scroller = document.getElementById('starlight__sidebar');
			if (!window._starlightScrollRestore || !scroller) return;
			scroller.scrollTop = window._starlightScrollRestore;
			delete window._starlightScrollRestore;
		})();
	</script> </sl-sidebar-state-persist>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="social-icons astro-wu23bvmt"> <a href="https://github.com/enatsek/" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-vrdttmbt">  <script type="module">const a=document.getElementById("starlight__sidebar"),n=a?.querySelector("sl-sidebar-state-persist"),o="sl-sidebar-state",i=()=>{let t=[];const e=n?.dataset.hash||"";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||"{}");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener("click",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest("summary")?.closest("details");if(!e)return;const s=e.querySelector("sl-sidebar-restore"),r=parseInt(s?.dataset.index||"");isNaN(r)||l(!e.open,r)});addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&d()});addEventListener("pageHide",d);</script> <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container print:hidden astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><span class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></span><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#0-specs" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">0. Specs</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#00-start" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.0. Start</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#01-how-it-works" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.1. How It Works</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#02-infrastructure" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.2. Infrastructure</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#03-very-basic-terminology" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.3. (Very) Basic Terminology</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#04-resources" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.4. Resources</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#1-installation-and-configuration" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">1. Installation and Configuration</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#11-installation" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.1. Installation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#12-bridge-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.2. Bridge Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#13-add-our-bridge-to-kvm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.3. Add Our Bridge to KVM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#14-configure-directories" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.4. Configure Directories</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#2-vm-creation" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">2. VM Creation</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#21-create-the-1st-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.1. Create the 1st VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#22-os-variant-list" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.2. os-variant List</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#23-connecting-to-the-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.3. Connecting to the VM</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#3-remote-graphical-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">3. Remote Graphical Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#4-installing-vms-from-ready-images" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">4. Installing VMs from Ready Images</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#40-installing-cloud-image-utils" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.0. Installing cloud-image-utils</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#41-acquiring-cloud-images" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.1. Acquiring Cloud Images</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#42-creating-a-new-image-from-the-original-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.2. Creating a New Image From the Original Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#43-cloud-init-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.3. Cloud-init Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#44-cloud-init-network-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.4. Cloud-init Network Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#45-creating-cloud-seed-images" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.5. Creating Cloud Seed Images</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#46-start-our-images-as-a-new-vms" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.6. Start Our Images as a New VMs</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#47-clean-up-tasks-for-cloud-init" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.7. Clean-up Tasks for Cloud-init</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#48-the-whole-process-except-47-can-be-automated-by-a-python-script" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.8. The whole process except 4.7. can be automated by a python script.</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#5-virsh-shell-based-vm-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">5. virsh: Shell Based VM Management</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#50-environment-variable-set" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.0. Environment Variable Set</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#51-info-about-host" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.1. Info about host</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#52-list-vms-and-their-states" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.2. List VMs and their states</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#53-start-shutdown-reboot-force-shutdown-remove-a-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.3. Start, shutdown, reboot, force shutdown, remove a VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#54-pause-and-resume-a-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.4. Pause and resume a VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#55-autostart-a-vm-starts-when-the-host-starts" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.5. Autostart a VM (starts when the host starts)</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#56-information-about-a-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.6. Information about a VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#57-vm-memory-management" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.7. VM Memory Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#58-vm-vcpu-management" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.8. VM vCPU Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#59-snapshots" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.9. Snapshots</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#510-attach-another-disk-to-a-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.10. Attach Another Disk to a VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#511-other-virsh-commands" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.11. Other virsh Commands</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#6-qemu-img-shell-based-image-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">6. qemu-img: Shell Based Image Management</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#61-get-basic-info-about-an-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.1. Get Basic Info About an Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#62-creating-an-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.2. Creating an Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#63-changing-the-format-of-an-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.3. Changing the Format of an Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#64-resize-a-disk-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.4. Resize a Disk Image.</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#65-check-an-image-for-errors" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.5. Check an Image For Errors</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#7-export-and-import-of-vms" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">7. Export and Import of VMs</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#71-export" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">7.1. Export</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#72-import" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">7.2. Import</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#8-libguestfs-vm-disk-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">8. libguestfs: VM Disk Management</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#81-installation" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.1. Installation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#82-mounting-vms-disks" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.2. Mounting VM’s Disks</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#83-all-commands" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.3. All Commands</span> </a>  </li> </ul>  </li> </ul> </div></details></nav></mobile-starlight-toc><script type="module" src="/_astro/MobileTableOfContents.astro_astro_type_script_index_0_lang.C181hMzK.js"></script></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#0-specs" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">0. Specs</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#00-start" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.0. Start</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#01-how-it-works" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.1. How It Works</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#02-infrastructure" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.2. Infrastructure</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#03-very-basic-terminology" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.3. (Very) Basic Terminology</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#04-resources" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">0.4. Resources</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#1-installation-and-configuration" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">1. Installation and Configuration</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#11-installation" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.1. Installation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#12-bridge-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.2. Bridge Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#13-add-our-bridge-to-kvm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.3. Add Our Bridge to KVM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#14-configure-directories" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">1.4. Configure Directories</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#2-vm-creation" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">2. VM Creation</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#21-create-the-1st-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.1. Create the 1st VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#22-os-variant-list" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.2. os-variant List</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#23-connecting-to-the-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">2.3. Connecting to the VM</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#3-remote-graphical-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">3. Remote Graphical Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#4-installing-vms-from-ready-images" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">4. Installing VMs from Ready Images</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#40-installing-cloud-image-utils" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.0. Installing cloud-image-utils</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#41-acquiring-cloud-images" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.1. Acquiring Cloud Images</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#42-creating-a-new-image-from-the-original-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.2. Creating a New Image From the Original Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#43-cloud-init-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.3. Cloud-init Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#44-cloud-init-network-configuration" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.4. Cloud-init Network Configuration</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#45-creating-cloud-seed-images" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.5. Creating Cloud Seed Images</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#46-start-our-images-as-a-new-vms" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.6. Start Our Images as a New VMs</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#47-clean-up-tasks-for-cloud-init" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.7. Clean-up Tasks for Cloud-init</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#48-the-whole-process-except-47-can-be-automated-by-a-python-script" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">4.8. The whole process except 4.7. can be automated by a python script.</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#5-virsh-shell-based-vm-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">5. virsh: Shell Based VM Management</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#50-environment-variable-set" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.0. Environment Variable Set</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#51-info-about-host" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.1. Info about host</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#52-list-vms-and-their-states" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.2. List VMs and their states</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#53-start-shutdown-reboot-force-shutdown-remove-a-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.3. Start, shutdown, reboot, force shutdown, remove a VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#54-pause-and-resume-a-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.4. Pause and resume a VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#55-autostart-a-vm-starts-when-the-host-starts" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.5. Autostart a VM (starts when the host starts)</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#56-information-about-a-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.6. Information about a VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#57-vm-memory-management" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.7. VM Memory Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#58-vm-vcpu-management" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.8. VM vCPU Management</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#59-snapshots" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.9. Snapshots</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#510-attach-another-disk-to-a-vm" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.10. Attach Another Disk to a VM</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#511-other-virsh-commands" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">5.11. Other virsh Commands</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#6-qemu-img-shell-based-image-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">6. qemu-img: Shell Based Image Management</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#61-get-basic-info-about-an-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.1. Get Basic Info About an Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#62-creating-an-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.2. Creating an Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#63-changing-the-format-of-an-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.3. Changing the Format of an Image</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#64-resize-a-disk-image" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.4. Resize a Disk Image.</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#65-check-an-image-for-errors" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">6.5. Check an Image For Errors</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#7-export-and-import-of-vms" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">7. Export and Import of VMs</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#71-export" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">7.1. Export</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#72-import" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">7.2. Import</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#8-libguestfs-vm-disk-management" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">8. libguestfs: VM Disk Management</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#81-installation" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.1. Installation</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#82-mounting-vms-disks" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.2. Mounting VM’s Disks</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#83-all-commands" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">8.3. All Commands</span> </a>  </li> </ul>  </li> </ul> </nav></starlight-toc><script type="module" src="/_astro/TableOfContents.astro_astro_type_script_index_0_lang.CKWWgpjV.js"></script></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main data-pagefind-body class="astro-bguv2lll" lang="en" dir="ltr">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <h1 id="_top" class="astro-j6tvhyss">KVM Virtualization (Beginner)</h1>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content"> <div class="sl-heading-wrapper level-h5"><h5 id="introduction-to-kvm-virtualization">Introduction to KVM virtualization</h5><a class="sl-anchor-link" href="#introduction-to-kvm-virtualization"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Introduction to KVM virtualization”</span></a></div>
<div class="sl-heading-wrapper level-h2"><h2 id="0-specs">0. Specs</h2><a class="sl-anchor-link" href="#0-specs"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0. Specs”</span></a></div>
<hr>
<div class="sl-heading-wrapper level-h3"><h3 id="00-start">0.0. Start</h3><a class="sl-anchor-link" href="#00-start"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0.0. Start”</span></a></div>
<p>KVM Virtualization Tutorial 1 on Debian and Ubuntu Server.</p>
<p>Our aim is to install and configure a host computer for virtual  machines.</p>
<p>This tutorial aims to bring you (and me) to a moderate level of  Virtualization Administration.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="01-how-it-works">0.1. How It Works</h3><a class="sl-anchor-link" href="#01-how-it-works"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0.1. How It Works”</span></a></div>
<p><strong>KVM</strong> (Kernel-based Virtual Machine) is a loadable kernel module which  supply virtualization with APIs.</p>
<p><strong>QEMU</strong> (Quick EMUlator) is a virtualizer which uses KVM API. QEMU supports other  virtualization solutions too.</p>
<p><strong>Libvirt</strong> is a library for managing virtualization hosts. virsh command  comes from Libvirt.</p>
<p><strong>Libguestfs</strong> is a collection of tools for accessing and managing VM  images.</p>
<p><strong>virt-manager</strong> is a GUI for managing VMs. I use it on my workstation for simple tasks.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="02-infrastructure">0.2. Infrastructure</h3><a class="sl-anchor-link" href="#02-infrastructure"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0.2. Infrastructure”</span></a></div>
<ul>
<li>Server (Host): Debian (12/11) or Ubuntu (24.04/22.04) Server
<ul>
<li>IP: 192.168.1.121</li>
<li>Name: elma</li>
<li>NIC: enp3s0f0</li>
</ul>
</li>
<li>Workstation: Debian 12 or Ubuntu 24.04 LTS Desktop</li>
<li>Network: 192.168.1.0/24 which is supplied by my internet modem</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="03-very-basic-terminology">0.3. (Very) Basic Terminology</h3><a class="sl-anchor-link" href="#03-very-basic-terminology"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0.3. (Very) Basic Terminology”</span></a></div>
<p><strong>Domain</strong>: Virtual Machine (VM)<br>
<strong>Image</strong>: A file in which a VM (or a disk of VM) is stored.<br>
<strong>Host</strong>: A server which runs virtualization software<br>
<strong>Guest</strong>: A VM running on a host<br>
<strong>Snapshot</strong>: A saved state of an image. You can revert to that stage later.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="04-resources">0.4. Resources</h3><a class="sl-anchor-link" href="#04-resources"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “0.4. Resources”</span></a></div>
<p><a href="https://ostechnix.com/install-and-configure-kvm-in-ubuntu-20-04-headless-server/">ostechnix.com</a><br>
<a href="https://www.qemu.org/docs/master/tools/qemu-img.html">www.qemu.org</a><br>
<a href="https://www.libvirt.org/manpages/virsh.html">www.libvirt.org</a><br>
<a href="https://docs.fedoraproject.org/en-US/Fedora/18/html/Virtualization_Administration_Guide/index.html">https://docs.fedoraproject.org/en-US/Fedora/18/html/Virtualization_Administration_Guide/index.html</a> (not working now)<br>
<a href="https://libguestfs.org/">libguestfs.org</a><br>
<a href="https://fabianlee.org/2020/02/23/kvm-testing-cloud-init-locally-using-kvm-for-an-ubuntu-cloud-image/">fabianlee.org</a><br>
<a href="https://cloudinit.readthedocs.io/en/latest/reference/examples.html">cloudinit.readthedocs.io</a><br>
ISBN: 979-10-91414-20-3 <strong>The Debian Administrator’s Handbook</strong> by Raphaël Hertzog and Roland Mas<br>
ISBN: 978-1-78829-467-6 <strong>KVM Virtualization Cookbook</strong> by Konstantin Ivanov</p>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="1-installation-and-configuration">1. Installation and Configuration</h2><a class="sl-anchor-link" href="#1-installation-and-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1. Installation and Configuration”</span></a></div>
<hr>
<div class="sl-heading-wrapper level-h3"><h3 id="11-installation">1.1. Installation</h3><a class="sl-anchor-link" href="#11-installation"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.1. Installation”</span></a></div>
<p>Install necessary packages</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.v4551.css"><script type="module" src="/_astro/ec.0vx5m.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt update</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install libvirt-clients libvirt-daemon-system qemu-kvm \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">virtinst virt-manager virt-viewer bridge-utils --yes</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt updatesudo apt install libvirt-clients libvirt-daemon-system qemu-kvm \     virtinst virt-manager virt-viewer bridge-utils --yes"><div></div></button></div></figure></div>
<p>Add your user to libvirt group:
(Change exforge to your user name)</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo usermod -aG libvirt exforge</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo usermod -aG libvirt exforge"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="12-bridge-configuration">1.2. Bridge Configuration</h3><a class="sl-anchor-link" href="#12-bridge-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.2. Bridge Configuration”</span></a></div>
<p>For the guest computers to reach a network, a bridge configuration on the host computer is needed.</p>
<p>Bridge Configuration differs slighty for Debian and Ubuntu. So it is  better to handle them in different sections.</p>
<div class="sl-heading-wrapper level-h4"><h4 id="121-ubuntu-bridge-configuration">1.2.1. Ubuntu Bridge Configuration</h4><a class="sl-anchor-link" href="#121-ubuntu-bridge-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.2.1. Ubuntu Bridge Configuration”</span></a></div>
<p>By default KVM creates a virtual bridge named virbr0. This bridge allows  the VMs to communicate between each other and the host. But we prefer that the VMs join to our network by getting IP address from our network.</p>
<p>That is we will create a public filter.</p>
<p>First we need to disable netfilter, which is enabled on bridges by  default.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/sysctl.d/bridge.conf</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/sysctl.d/bridge.conf"><div></div></button></div></figure></div>
<p>File is empty, add the following lines</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-ip6tables=0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-iptables=0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-arptables=0</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="net.bridge.bridge-nf-call-ip6tables=0net.bridge.bridge-nf-call-iptables=0net.bridge.bridge-nf-call-arptables=0"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/udev/rules.d/99-bridge.rules</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/udev/rules.d/99-bridge.rules"><div></div></button></div></figure></div>
<p>File is empty, the add following line</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">ACTION=="add", SUBSYSTEM=="module", KERNEL=="br_netfilter", RUN+="/sbin/sysctl -p /etc/sysctl.d/bridge.conf"</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="ACTION==&#x22;add&#x22;, SUBSYSTEM==&#x22;module&#x22;, KERNEL==&#x22;br_netfilter&#x22;, RUN+=&#x22;/sbin/sysctl -p /etc/sysctl.d/bridge.conf&#x22;"><div></div></button></div></figure></div>
<p>A reboot is necessary</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo reboot</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo reboot"><div></div></button></div></figure></div>
<p>Now we need to remove the bridge created by KVM</p>
<p>With “ip link” command we see all the networks. KVM network is named as  virbr0.</p>
<p>Delete and undefine KVM networks</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh net-destroy default</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh net-undefine default</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh net-destroy defaultvirsh net-undefine default"><div></div></button></div></figure></div>
<p>If in any case an error occurs, you can try the following command:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo ip link delete virbr0 type bridge</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo ip link delete virbr0 type bridge"><div></div></button></div></figure></div>
<p>Now if you run “ip link” again, you will see that virbr0 is removed.</p>
<p>When you run “ip link”, take a note of your interface name(s), it must  be something like enp0s0. If you have more than 1 interface there will be  more than 1 name.</p>
<p>Backup your network configuration file<br>
If that file does not exist, there must be another file there with yaml  extension. Proceed with that file.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo cp /etc/netplan/50-cloud-init.yaml{,.backup}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo cp /etc/netplan/50-cloud-init.yaml{,.backup}"><div></div></button></div></figure></div>
<p>Edit your network config file</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/netplan/50-cloud-init.yaml</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/netplan/50-cloud-init.yaml"><div></div></button></div></figure></div>
<p>Remove its content , fill it as below, beware of changing enp3s0f0 to  your interface name. If you have more than 1 interfaces, add them too.</p>
<p>Also you should add an IP address and default gateway from your local  network.</p>
<p>Mine are 192.168.1.121 and 192.168.1.1</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">network:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">ethernets:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">enp3s0f0:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp4: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp6: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">bridges:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">br0:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">interfaces: [enp3s0f0]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">addresses:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">- 192.168.1.121/24</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">routes:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">- to: default</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">via: 192.168.1.1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">mtu: 1500</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">nameservers:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">addresses:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">- 8.8.8.8</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">- 8.8.4.4</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">parameters:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">stp: true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">forward-delay: 4</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp4: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp6: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">version: 2</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="network:  ethernets:    enp3s0f0:      dhcp4: false      dhcp6: false  bridges:    br0:      interfaces: [enp3s0f0]      addresses:      - 192.168.1.121/24      routes:      - to: default        via: 192.168.1.1      mtu: 1500      nameservers:        addresses:        - 8.8.8.8        - 8.8.4.4      parameters:        stp: true        forward-delay: 4      dhcp4: false      dhcp6: false  version: 2"><div></div></button></div></figure></div>
<p>Apply the changes. If you connect through ssh, you connection may break. In this case, close the terminal and reconnect.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo netplan apply</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo netplan apply"><div></div></button></div></figure></div>
<p>If you run “ip link” now, you can see our bridge br0</p>
<div class="sl-heading-wrapper level-h4"><h4 id="122-debian-bridge-configuration">1.2.2. Debian Bridge Configuration</h4><a class="sl-anchor-link" href="#122-debian-bridge-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.2.2. Debian Bridge Configuration”</span></a></div>
<p>By default KVM creates a virtual bridge named virbr0. This bridge allows  the VMs to communicate between each other and the host. But we want the  VMs join to our network by getting IP address from our network.</p>
<p>First we need to disable netfilter, which is enabled on bridges by  default.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/sysctl.d/bridge.conf</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/sysctl.d/bridge.conf"><div></div></button></div></figure></div>
<p>File is empty, add following lines</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-ip6tables=0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-iptables=0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">net.bridge.bridge-nf-call-arptables=0</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="net.bridge.bridge-nf-call-ip6tables=0net.bridge.bridge-nf-call-iptables=0net.bridge.bridge-nf-call-arptables=0"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/udev/rules.d/99-bridge.rules</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/udev/rules.d/99-bridge.rules"><div></div></button></div></figure></div>
<p>File is empty, add following line</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">ACTION=="add", SUBSYSTEM=="module", KERNEL=="br_netfilter", RUN+="/sbin/sysctl -p /etc/sysctl.d/bridge.conf"</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="ACTION==&#x22;add&#x22;, SUBSYSTEM==&#x22;module&#x22;, KERNEL==&#x22;br_netfilter&#x22;, RUN+=&#x22;/sbin/sysctl -p /etc/sysctl.d/bridge.conf&#x22;"><div></div></button></div></figure></div>
<p>A reboot is necessary</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo reboot</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo reboot"><div></div></button></div></figure></div>
<p>Now it is time to create a Bridge configuration for the KVM</p>
<p>Backup your network configuration file</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo cp /etc/network/interfaces{,.backup}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo cp /etc/network/interfaces{,.backup}"><div></div></button></div></figure></div>
<p>Edit your network config file</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /etc/network/interfaces</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /etc/network/interfaces"><div></div></button></div></figure></div>
<p>Remove its content , fill it as below, beware of changing enp3s0f0 to  your interface name. If you have more than 1 interfaces, add them too.</p>
<p>Also you should add an IP address and default gateway from your local  network.</p>
<p>Mine are 192.168.1.121 and 192.168.1.1</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">auto lo</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">iface lo inet loopback</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53"># The primary network interface</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">auto enp3s0f0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#make sure we don't get addresses on our raw device</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">iface enp3s0f0 inet manual</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#set up bridge and give it a static ip</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">auto br0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">iface br0 inet static</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">address 192.168.1.121</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">netmask 255.255.255.0</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">network 192.168.1.0</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">broadcast 192.168.1.255</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">gateway 192.168.1.1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">bridge_ports enp3s0f0</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">bridge_stp off</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">bridge_fd 0</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">bridge_maxwait 0</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">        </span></span><span style="--0:#d6deeb;--1:#403f53">dns-nameservers 8.8.8.8</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="auto loiface lo inet loopback# The primary network interfaceauto enp3s0f0#make sure we don&#x27;t get addresses on our raw deviceiface enp3s0f0 inet manual#set up bridge and give it a static ipauto br0iface br0 inet static        address 192.168.1.121        netmask 255.255.255.0        network 192.168.1.0        broadcast 192.168.1.255        gateway 192.168.1.1        bridge_ports enp3s0f0        bridge_stp off        bridge_fd 0        bridge_maxwait 0        dns-nameservers 8.8.8.8"><div></div></button></div></figure></div>
<p>Apply the changes. If you connect through ssh, your connection may break. In this case, close the terminal and reconnect.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo systemctl restart networking.service</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo systemctl restart networking.service"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="13-add-our-bridge-to-kvm">1.3. Add Our Bridge to KVM</h3><a class="sl-anchor-link" href="#13-add-our-bridge-to-kvm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.3. Add Our Bridge to KVM”</span></a></div>
<p>Adding our Bridge to KVM. We have to create an XML file for the bridge  definition:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">nano host-bridge.xml</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="nano host-bridge.xml"><div></div></button></div></figure></div>
<p>Fill as below:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">&#x3C;network></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">&#x3C;name>host-bridge&#x3C;/name></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">&#x3C;forward mode="bridge"/></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">&#x3C;bridge name="br0"/></span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">&#x3C;/network></span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="<network>  <name>host-bridge</name>  <forward mode=&#x22;bridge&#x22;/>  <bridge name=&#x22;br0&#x22;/></network>"><div></div></button></div></figure></div>
<p>Define the bridge, start it and make it autostart.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh net-define host-bridge.xml</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh net-start host-bridge</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh net-autostart host-bridge</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh net-define host-bridge.xmlvirsh net-start host-bridgevirsh net-autostart host-bridge"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="14-configure-directories">1.4. Configure Directories</h3><a class="sl-anchor-link" href="#14-configure-directories"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1.4. Configure Directories”</span></a></div>
<p>Set places for disk images and installation isos</p>
<p>/srv/kvm for VM disk images<br>
/srv/isos for installation iso images</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo mkdir /srv/kvm /srv/isos</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo virsh pool-create-as srv-kvm dir --target /srv/kvm</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo mkdir /srv/kvm /srv/isossudo virsh pool-create-as srv-kvm dir --target /srv/kvm"><div></div></button></div></figure></div>
<p>At this point, you may want to copy some installation isos to server’s /srv/isos dir</p>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="2-vm-creation">2. VM Creation</h2><a class="sl-anchor-link" href="#2-vm-creation"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2. VM Creation”</span></a></div>
<hr>
<div class="sl-heading-wrapper level-h3"><h3 id="21-create-the-1st-vm">2.1. Create the 1st VM</h3><a class="sl-anchor-link" href="#21-create-the-1st-vm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2.1. Create the 1st VM”</span></a></div>
<p>Now it is time to create our first vm</p>
<p>It will be Ubuntu Server 22.04 LTS with 1 GB RAM and 10 GB HDD</p>
<p>I already copied Ubuntu server iso ubuntu-22.04.2-live-server-amd64.iso  to /srv/isos</p>
<p>Install a VM named testkvm:</p>
<ul>
<li>through QEMU with KVM virtualization,</li>
<li>with 1024MiB memory and 1 vcpu,</li>
<li>prepare a qcow2 format disk of 10GiB,</li>
<li>connect a CDROM drive to it with the specified image,</li>
<li>use the server’s network bridge br0,</li>
<li>allow VNC connections to the VM through the server,</li>
<li>optimize it as Ubuntu 22.04 server and</li>
<li>don’t try to attach a console from server.</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo virt-install --name testkvm \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--connect qemu:///system  --virt-type kvm \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--memory 1024 --vcpus 1 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--disk /srv/kvm/testkvm.qcow2,format=qcow2,size=10 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--cdrom /srv/isos/ubuntu-22.04.2-live-server-amd64.iso  \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--network bridge=br0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--graphics vnc,port=5901,listen=0.0.0.0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--os-variant ubuntu22.04 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">--noautoconsole</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo virt-install --name testkvm \    --connect qemu:///system  --virt-type kvm \    --memory 1024 --vcpus 1 \    --disk /srv/kvm/testkvm.qcow2,format=qcow2,size=10 \    --cdrom /srv/isos/ubuntu-22.04.2-live-server-amd64.iso  \    --network bridge=br0 \    --graphics vnc,port=5901,listen=0.0.0.0 \    --os-variant ubuntu22.04 \    --noautoconsole"><div></div></button></div></figure></div>
<p>Debian 11 does not recognize ubuntu22.04 os variant, so you can change  it as —os-variant ubuntu20.04</p>
<div class="sl-heading-wrapper level-h3"><h3 id="22-os-variant-list">2.2. os-variant List</h3><a class="sl-anchor-link" href="#22-os-variant-list"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2.2. os-variant List”</span></a></div>
<p>There are lots of OS Variant selections. You can find yours with the  following command. It helps hypervisor to optimize the system for the  guest OS. It can be skipped.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install libosinfo-bin --yes</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">osinfo-query os</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt install libosinfo-bin --yesosinfo-query os"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="23-connecting-to-the-vm">2.3. Connecting to the VM</h3><a class="sl-anchor-link" href="#23-connecting-to-the-vm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2.3. Connecting to the VM”</span></a></div>
<p>A graphical desktop is needed to connect to the VM. You can install  virt-viewer package on your Debian or Ubuntu workstation and connect to the VM.</p>
<p><strong>Run on your workstation:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt update</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install virt-viewer --yes</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-viewer --connect qemu+ssh://exforge@elma/system testkvm</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt updatesudo apt install virt-viewer --yesvirt-viewer --connect qemu+ssh://exforge@elma/system testkvm"><div></div></button></div></figure></div>
<p>Remember to replace exforge with your user name on the server and elma  with your server’s hostname</p>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="3-remote-graphical-management">3. Remote Graphical Management</h2><a class="sl-anchor-link" href="#3-remote-graphical-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “3. Remote Graphical Management”</span></a></div>
<hr>
<p>Our server has no graphical interface (like the most servers). If you  really want a graphical management, you can install virt-manager on your  workstation and manage your VMs from there.</p>
<p><strong>Run on your workstation:</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt update</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install virt-manager --yes</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-manager</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt updatesudo apt install virt-manager --yesvirt-manager"><div></div></button></div></figure></div>
<p>The application is added to Applications Menu with the name “Virtual Machine Manager”</p>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="4-installing-vms-from-ready-images">4. Installing VMs from Ready Images</h2><a class="sl-anchor-link" href="#4-installing-vms-from-ready-images"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4. Installing VMs from Ready Images”</span></a></div>
<hr>
<p>Starting a new VM and installing OS into it is a good but time consuming way. Another way would be preparing an installed image and start it as a  new VM.</p>
<p>Most server distros supply cloud images. By adding them some necessary  configurations (user and network definitions), you can use them as ready  images.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="40-installing-cloud-image-utils">4.0. Installing cloud-image-utils</h3><a class="sl-anchor-link" href="#40-installing-cloud-image-utils"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.0. Installing cloud-image-utils”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt update</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install cloud-image-utils --yes</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt updatesudo apt install cloud-image-utils --yes"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="41-acquiring-cloud-images">4.1. Acquiring Cloud Images</h3><a class="sl-anchor-link" href="#41-acquiring-cloud-images"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.1. Acquiring Cloud Images”</span></a></div>
<p>A search for “ubuntu cloud image” in duckduck2 gives the following  address:<br>
<a href="https://cloud-images.ubuntu.com/">cloud-images.ubuntu.com</a></p>
<p>Following noble and current, download kvm image noble-server-cloudimg-amd64.img, and put it in the server’s /srv/isos folder.</p>
<p>Similarly a search for “debian cloud images” in duckduck2 gives the  following address:<br>
<a href="https://cloud.debian.org/images/cloud/">cloud.debian.org</a></p>
<p>Following bookworm and latest, download debian-12-generic-amd64.qcow2 and put it in the server’s /srv/isos folder.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="42-creating-a-new-image-from-the-original-image">4.2. Creating a New Image From the Original Image</h3><a class="sl-anchor-link" href="#42-creating-a-new-image-from-the-original-image"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.2. Creating a New Image From the Original Image”</span></a></div>
<p>We will create new images from the images we downloaded. Image sizes will be increased to 20 GiB and the Ubuntu image will be converted to qcow2, the preferred format for KVM.</p>
<p>Ubuntu image:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create -b /srv/isos/noble-server-cloudimg-amd64.img \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">-F qcow2 -f qcow2 /srv/kvm/ubuntusrv-cloudimg.qcow2 20G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create -b /srv/isos/noble-server-cloudimg-amd64.img \    -F qcow2 -f qcow2 /srv/kvm/ubuntusrv-cloudimg.qcow2 20G"><div></div></button></div></figure></div>
<p>Debian image:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create -b /srv/isos/debian-12-generic-amd64.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">-F qcow2 -f qcow2 /srv/kvm/debiansrv-cloudimg.qcow2 20G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create -b /srv/isos/debian-12-generic-amd64.qcow2 \    -F qcow2 -f qcow2 /srv/kvm/debiansrv-cloudimg.qcow2 20G"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="43-cloud-init-configuration">4.3. Cloud-init Configuration</h3><a class="sl-anchor-link" href="#43-cloud-init-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.3. Cloud-init Configuration”</span></a></div>
<p>The next step is to crate a cloud-init config file. This file contains  instructions for the cloud image. There is a wide range of instructions  like; creating a user, creating and filling files, adding apt  repositories, running initial commands, installing  packages, reboot and  poweroff after finishing, disk and configuration. See below url for  details:</p>
<p><a href="https://cloudinit.readthedocs.io/en/latest/reference/examples.html">cloudinit.readthedocs.io</a></p>
<p>Our cloud-init file will configure the following:</p>
<ul>
<li>Set hostname and Fully Qualified Domain Name,</li>
<li>Create a user named exforge with sudo privileges,</li>
<li>assign its password,</li>
<li>add it to exforge group as primary,</li>
<li>also add it to users group,</li>
<li>create its home directory as /home/exforge,</li>
<li>and set its shell to bash.</li>
</ul>
<p>To add our user’s password, we need to have the hash of it.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt install whois --yes</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">mkpasswd --method=SHA-512 --rounds=4096</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt install whois --yesmkpasswd --method=SHA-512 --rounds=4096"><div></div></button></div></figure></div>
<p>Enter the user’s assigned password here, it will display the hash, copy  the hash, we will use it later.</p>
<p>Create a place for our cloud-init files. /srv/init would be fine.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo mkdir /srv/init</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo mkdir /srv/init"><div></div></button></div></figure></div>
<p>Create our ubuntu server’s cloud-init file</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /srv/init/ubuntu-cloud-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /srv/init/ubuntu-cloud-init.cfg"><div></div></button></div></figure></div>
<p>Fill as below (Remember updating password with the hash you get):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#cloud-config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">hostname: ubuntu24</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">fqdn: ubuntu24.x386.org</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">manage_etc_hosts: true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">groups: exforge</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">users:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">- name: exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">sudo: ALL=(ALL) ALL</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">primary_group: exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">groups: users</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">home: /home/exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">shell: /bin/bash</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">lock_passwd: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">passwd: $6$rounds=4096$u5D5VbBZD7NcG/8Y$sc8WH5R9YU/xx1QqjQnMzNbQJOptj33DQGJqyHHju5EzJkvGF913gPVhjw.CsL8QLX5G79C0312tAuGIhWEhf1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">packages: qemu-guest-agent</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#cloud-confighostname: ubuntu24fqdn: ubuntu24.x386.orgmanage_etc_hosts: truegroups: exforgeusers:   - name: exforge     sudo: ALL=(ALL) ALL     primary_group: exforge     groups: users     home: /home/exforge     shell: /bin/bash     lock_passwd: false     passwd: $6$rounds=4096$u5D5VbBZD7NcG/8Y$sc8WH5R9YU/xx1QqjQnMzNbQJOptj33DQGJqyHHju5EzJkvGF913gPVhjw.CsL8QLX5G79C0312tAuGIhWEhf1packages: qemu-guest-agent"><div></div></button></div></figure></div>
<p>Create our debian server’s cloud-init file</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /srv/init/debian-cloud-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /srv/init/debian-cloud-init.cfg"><div></div></button></div></figure></div>
<p>Fill as below:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#cloud-config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">hostname: debian12</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">fqdn: debian12.x386.org</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">manage_etc_hosts: true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">groups: exforge</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">users:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">- name: exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">sudo: ALL=(ALL) ALL</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">primary_group: exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">groups: users</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">home: /home/exforge</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">shell: /bin/bash</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">lock_passwd: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">passwd: $6$rounds=4096$u5D5VbBZD7NcG/8Y$sc8WH5R9YU/xx1QqjQnMzNbQJOptj33DQGJqyHHju5EzJkvGF913gPVhjw.CsL8QLX5G79C0312tAuGIhWEhf1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">packages: qemu-guest-agent</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#cloud-confighostname: debian12fqdn: debian12.x386.orgmanage_etc_hosts: truegroups: exforgeusers:   - name: exforge     sudo: ALL=(ALL) ALL     primary_group: exforge     groups: users     home: /home/exforge     shell: /bin/bash     lock_passwd: false     passwd: $6$rounds=4096$u5D5VbBZD7NcG/8Y$sc8WH5R9YU/xx1QqjQnMzNbQJOptj33DQGJqyHHju5EzJkvGF913gPVhjw.CsL8QLX5G79C0312tAuGIhWEhf1packages: qemu-guest-agent"><div></div></button></div></figure></div>
<p>Do not forget to change passwd value with your copied hash.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="44-cloud-init-network-configuration">4.4. Cloud-init Network Configuration</h3><a class="sl-anchor-link" href="#44-cloud-init-network-configuration"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.4. Cloud-init Network Configuration”</span></a></div>
<p>If a network configuration other than DHCP is needed, a network  configuration file is necessary.</p>
<p>Remember to change IP addresses as needed by your VM</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /srv/init/ubuntu-network-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /srv/init/ubuntu-network-init.cfg"><div></div></button></div></figure></div>
<p>Fill as below:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#cloud-config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">version: 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">ethernets:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">enp1s0:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp4: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">addresses: [ 192.168.1.243/24 ]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">gateway4: 192.168.1.1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">nameservers:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">       </span></span><span style="--0:#d6deeb;--1:#403f53">addresses: [ 192.168.1.1,8.8.8.8 ]</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#cloud-configversion: 2ethernets:  enp1s0:     dhcp4: false     addresses: [ 192.168.1.243/24 ]     gateway4: 192.168.1.1     nameservers:       addresses: [ 192.168.1.1,8.8.8.8 ]"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /srv/init/debian-network-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /srv/init/debian-network-init.cfg"><div></div></button></div></figure></div>
<p>Fill as below:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">#cloud-config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">version: 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">ethernets:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">enp1s0:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">dhcp4: false</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">addresses: [ 192.168.1.244/24 ]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">gateway4: 192.168.1.1</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">     </span></span><span style="--0:#d6deeb;--1:#403f53">nameservers:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">       </span></span><span style="--0:#d6deeb;--1:#403f53">addresses: [ 192.168.1.1,8.8.8.8 ]</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#cloud-configversion: 2ethernets:  enp1s0:     dhcp4: false     addresses: [ 192.168.1.244/24 ]     gateway4: 192.168.1.1     nameservers:       addresses: [ 192.168.1.1,8.8.8.8 ]"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="45-creating-cloud-seed-images">4.5. Creating Cloud Seed Images</h3><a class="sl-anchor-link" href="#45-creating-cloud-seed-images"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.5. Creating Cloud Seed Images”</span></a></div>
<p>Now we will create image files cloud-init and network-init inside.</p>
<p>For Ubuntu server:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo cloud-localds --network-config /srv/init/ubuntu-network-init.cfg \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/kvm/ubuntu24-seed.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/init/ubuntu-cloud-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo cloud-localds --network-config /srv/init/ubuntu-network-init.cfg \   /srv/kvm/ubuntu24-seed.qcow2 \   /srv/init/ubuntu-cloud-init.cfg"><div></div></button></div></figure></div>
<p>For Debian server:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo cloud-localds --network-config /srv/init/debian-network-init.cfg \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/kvm/debian12-seed.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/init/debian-cloud-init.cfg</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo cloud-localds --network-config /srv/init/debian-network-init.cfg \   /srv/kvm/debian12-seed.qcow2 \   /srv/init/debian-cloud-init.cfg"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="46-start-our-images-as-a-new-vms">4.6. Start Our Images as a New VMs</h3><a class="sl-anchor-link" href="#46-start-our-images-as-a-new-vms"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.6. Start Our Images as a New VMs”</span></a></div>
<p>Ubuntu Server:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-install --name ubuntu24 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--connect qemu:///system \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--virt-type kvm --memory 2048 --vcpus 2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--boot hd,menu=on \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/ubuntu24-seed.qcow2,device=cdrom \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/ubuntusrv-cloudimg.qcow2,device=disk \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--graphics vnc,port=5902,listen=0.0.0.0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--os-variant ubuntu24.04 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--network bridge=br0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--noautoconsole \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--install no_install=yes</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virt-install --name ubuntu24 \  --connect qemu:///system \  --virt-type kvm --memory 2048 --vcpus 2 \  --boot hd,menu=on \  --disk path=/srv/kvm/ubuntu24-seed.qcow2,device=cdrom \  --disk path=/srv/kvm/ubuntusrv-cloudimg.qcow2,device=disk \  --graphics vnc,port=5902,listen=0.0.0.0 \  --os-variant ubuntu24.04 \  --network bridge=br0 \  --noautoconsole \  --install no_install=yes"><div></div></button></div></figure></div>
<p>Debian Server</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-install --name debian12 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--connect qemu:///system \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--virt-type kvm --memory 2048 --vcpus 2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--boot hd,menu=on \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/debian12-seed.qcow2,device=cdrom \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/debiansrv-cloudimg.qcow2,device=disk \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--graphics vnc,port=5903,listen=0.0.0.0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--os-variant debian12 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--network bridge=br0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--noautoconsole \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--install no_install=yes</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virt-install --name debian12 \  --connect qemu:///system \  --virt-type kvm --memory 2048 --vcpus 2 \  --boot hd,menu=on \  --disk path=/srv/kvm/debian12-seed.qcow2,device=cdrom \  --disk path=/srv/kvm/debiansrv-cloudimg.qcow2,device=disk \  --graphics vnc,port=5903,listen=0.0.0.0 \  --os-variant debian12 \  --network bridge=br0 \  --noautoconsole \  --install no_install=yes"><div></div></button></div></figure></div>
<p>Ironically, on Debian 12, —os-variant debian12 gives an error. In that  case, try the following command:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-install --name debian12 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--connect qemu:///system \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--virt-type kvm --memory 2048 --vcpus 2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--boot hd,menu=on \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/debian12-seed.qcow2,device=cdrom \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/debiansrv-cloudimg.qcow2,device=disk \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--graphics vnc,port=5903,listen=0.0.0.0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--os-variant debian11 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--network bridge=br0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--noautoconsole \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--install no_install=yes</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virt-install --name debian12 \  --connect qemu:///system \  --virt-type kvm --memory 2048 --vcpus 2 \  --boot hd,menu=on \  --disk path=/srv/kvm/debian12-seed.qcow2,device=cdrom \  --disk path=/srv/kvm/debiansrv-cloudimg.qcow2,device=disk \  --graphics vnc,port=5903,listen=0.0.0.0 \  --os-variant debian11 \  --network bridge=br0 \  --noautoconsole \  --install no_install=yes"><div></div></button></div></figure></div>
<ul>
<li>It might take a few minutes for cloud-init to finish. You can connect to your VM from your workstation.</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-viewer --connect qemu+ssh://exforge@elma/system ubuntu24</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-viewer --connect qemu+ssh://exforge@elma/system debian12</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virt-viewer --connect qemu+ssh://exforge@elma/system ubuntu24virt-viewer --connect qemu+ssh://exforge@elma/system debian12"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="47-clean-up-tasks-for-cloud-init">4.7. Clean-up Tasks for Cloud-init</h3><a class="sl-anchor-link" href="#47-clean-up-tasks-for-cloud-init"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.7. Clean-up Tasks for Cloud-init”</span></a></div>
<p>On your VMs run:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo touch /etc/cloud/cloud-init.disabled</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo touch /etc/cloud/cloud-init.disabled"><div></div></button></div></figure></div>
<p>If the file /etc/cloud/cloud-init.disabled exists, cloud-init does not run again.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="48-the-whole-process-except-47-can-be-automated-by-a-python-script">4.8. The whole process except 4.7. can be automated by a python script.</h3><a class="sl-anchor-link" href="#48-the-whole-process-except-47-can-be-automated-by-a-python-script"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4.8. The whole process except 4.7. can be automated by a python script.”</span></a></div>
<ul>
<li>Download latest focal current cloud image (or use an already downloaded  one) 4.1.</li>
<li>A system call to run a command to create a new image 4.2.
<ul>
<li>Image size (and name) can be a parameter</li>
</ul>
</li>
<li>Create password hash and init files 4.3. and 4.4.
<ul>
<li>User name can be a parameter</li>
<li>Password can be obtained at run time</li>
<li>Network properties (IP, GW etc) can be parameters</li>
</ul>
</li>
<li>A system call to run a command to create seed image 4.5.</li>
<li>A system call to run a command to start the new image 4.6.
<ul>
<li>Memory size, vcpu count can be parameters.</li>
</ul>
</li>
</ul>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="5-virsh-shell-based-vm-management">5. virsh: Shell Based VM Management</h2><a class="sl-anchor-link" href="#5-virsh-shell-based-vm-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5. virsh: Shell Based VM Management”</span></a></div>
<hr>
<p>virt-manager can only help with the basic management tasks. If you want  to dive deep, you need the old-style shell.</p>
<p>There are countless options to do with virsh command. I can only list a  handfull of most useful ones (IMHO) here.</p>
<p>For a complete list of virsh command usage, see the following web page:<br>
<a href="https://www.libvirt.org/manpages/virsh.html">www.libvirt.org</a></p>
<p>In all examples, NAME is the name of your VM.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="50-environment-variable-set">5.0. Environment Variable Set</h3><a class="sl-anchor-link" href="#50-environment-variable-set"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.0. Environment Variable Set”</span></a></div>
<p>For Debian, in order to run virsh command without sudo, we need to set an environment variable.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">export LIBVIRT_DEFAULT_URI='qemu:///system'</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="export LIBVIRT_DEFAULT_URI=&#x27;qemu:///system&#x27;"><div></div></button></div></figure></div>
<p>Instead of setting everytime, we can add it to the .bashrc file:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">nano ~/.bashrc</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="nano ~/.bashrc"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">export LIBVIRT_DEFAULT_URI='qemu:///system'</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="export LIBVIRT_DEFAULT_URI=&#x27;qemu:///system&#x27;"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="51-info-about-host">5.1. Info about host</h3><a class="sl-anchor-link" href="#51-info-about-host"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.1. Info about host”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh nodeinfo</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh nodeinfo"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="52-list-vms-and-their-states">5.2. List VMs and their states</h3><a class="sl-anchor-link" href="#52-list-vms-and-their-states"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.2. List VMs and their states”</span></a></div>
<p>Running VMs</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh list</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh list"><div></div></button></div></figure></div>
<p>All VMs</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh list --all</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh list --all"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="53-start-shutdown-reboot-force-shutdown-remove-a-vm">5.3. Start, shutdown, reboot, force shutdown, remove a VM</h3><a class="sl-anchor-link" href="#53-start-shutdown-reboot-force-shutdown-remove-a-vm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.3. Start, shutdown, reboot, force shutdown, remove a VM”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh start NAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh shutdown NAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh reboot NAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh destroy NAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh undefine NAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh undefine NAME --remove-all-storage</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh reboot ubuntu24</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh start NAMEvirsh shutdown NAMEvirsh reboot NAMEvirsh destroy NAMEvirsh undefine NAMEvirsh undefine NAME --remove-all-storagevirsh reboot ubuntu24"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="54-pause-and-resume-a-vm">5.4. Pause and resume a VM</h3><a class="sl-anchor-link" href="#54-pause-and-resume-a-vm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.4. Pause and resume a VM”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh suspend NAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh resume NAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh suspend NAMEvirsh resume NAME"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="55-autostart-a-vm-starts-when-the-host-starts">5.5. Autostart a VM (starts when the host starts)</h3><a class="sl-anchor-link" href="#55-autostart-a-vm-starts-when-the-host-starts"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.5. Autostart a VM (starts when the host starts)”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh autostart NAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh autostart --disable NAME   # Disable autostart</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh autostart NAMEvirsh autostart --disable NAME   # Disable autostart"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="56-information-about-a-vm">5.6. Information about a VM</h3><a class="sl-anchor-link" href="#56-information-about-a-vm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.6. Information about a VM”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh dominfo NAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh domid NAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh domuuid NAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh domstate NAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh dominfo NAMEvirsh domid NAMEvirsh domuuid NAMEvirsh domstate NAME"><div></div></button></div></figure></div>
<p>Display VNC connection settings of VM</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh domdisplay NAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh domdisplay NAME"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="57-vm-memory-management">5.7. VM Memory Management</h3><a class="sl-anchor-link" href="#57-vm-memory-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.7. VM Memory Management”</span></a></div>
<p>VMs have 2 memory parameters: Max Memory and Used Memory.</p>
<p>Used memory is the amount of mem allocated to the VM.<br>
Max memory is the max amount of mem to be allocated to the VM.</p>
<p>See current memory allocation:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh dominfo NAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh dominfo NAME"><div></div></button></div></figure></div>
<p>Change Max memory (Activated after shutdown and start)</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmaxmem NAME 2G --config</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setmaxmem NAME 2G --config"><div></div></button></div></figure></div>
<p>size could be something like 2G 1536M etc</p>
<p>Used memory can be changed when the VM is running (decreasing is not  advised).</p>
<p>Change memory for this session only (reverts after shutdown and start):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmem NAME 2536M</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmem NAME 2536M --live</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmem NAME 2536M --current</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setmem NAME 2536Mvirsh setmem NAME 2536M --livevirsh setmem NAME 2536M --current"><div></div></button></div></figure></div>
<p>Change memory after the next shutdown and start</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmem NAME 2536M --config</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setmem NAME 2536M --config"><div></div></button></div></figure></div>
<p>Activate immediately and keep the changes after the next shutdown and  start</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmem NAME 1536M --live --config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setmem ubuntu24 2536M --live --config</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setmem NAME 1536M --live --configvirsh setmem ubuntu24 2536M --live --config"><div></div></button></div></figure></div>
<p><strong>Beware of Shutdown and Start. Reboots do not count.</strong></p>
<div class="sl-heading-wrapper level-h3"><h3 id="58-vm-vcpu-management">5.8. VM vCPU Management</h3><a class="sl-anchor-link" href="#58-vm-vcpu-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.8. VM vCPU Management”</span></a></div>
<p>Just like memory, VMs have 2 virtual CPU parameters. Maximum and Current.</p>
<p><strong>Current</strong> is the number of vcpus that VM uses actively (on-line).<br>
<strong>Maximum</strong> is the max number of vcpus can be allocated to the VM.</p>
<p>Also, there are 2 states. Config and Live.</p>
<p><strong>Config</strong> is the permanent state, it will be active after shutdown and start.<br>
<strong>Live</strong> is the running VM’s state, it may not be active after shutdown and start.</p>
<p>A cartesian product gives us 4 values:</p>
<p><strong>maximum config</strong>: Max number of vcpus, valid after shutdown and start.<br>
<strong>maximum live</strong>: Max number of vcpus, valid now (while running).<br>
<strong>current config</strong>: Active number of vcpus, valid after shutdown and start.<br>
<strong>current live</strong>: Active number of vcpus, valid now (while running).</p>
<p>To see these values for your VM:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh vcpucount NAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh vcpucount NAME"><div></div></button></div></figure></div>
<p>I keep saying shutdown and start instead of restart or reboot, because kvm, qemu or whatever it is, acts differently when you reboot or shutdown  and then start the VM.</p>
<p>So when I say shutdown and start, I mean shutdown first, wait a while (from 0.001 miliseconds to as long as you want) and then start the VM.</p>
<p>There is no way (AFAIK) to change maximum live value, you can change  maximum config as:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME NUMBER --maximum --config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3 --maximum --config</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setvcpus NAME NUMBER --maximum --configvirsh setvcpus ubuntu24 3 --maximum --config"><div></div></button></div></figure></div>
<p>To change current vcpu count for the current state (all options are valid)</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME NUMBER</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME NUMBER --current</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME NUMBER --live</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3 --current</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3 --live</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setvcpus NAME NUMBERvirsh setvcpus NAME NUMBER --currentvirsh setvcpus NAME NUMBER --livevirsh setvcpus ubuntu24 3virsh setvcpus ubuntu24 3 --currentvirsh setvcpus ubuntu24 3 --live"><div></div></button></div></figure></div>
<p>To change current vcpu count for the config state</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME NUMBER --config</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3 --config</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setvcpus NAME NUMBER --configvirsh setvcpus ubuntu24 3 --config"><div></div></button></div></figure></div>
<p>To do it both together</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus NAME NUMBER --config --live</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh setvcpus ubuntu24 3 --config --live</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh setvcpus NAME NUMBER --config --livevirsh setvcpus ubuntu24 3 --config --live"><div></div></button></div></figure></div>
<p>You can both increase and decrease the vcpu count. But beware that  decreasing vcpu count of a running VM could be dangerous.</p>
<p>When you increase the current live vcpu count, the increased vcpus becomes offline. That means you cannot use them right away. At least that is what happened to me. You can see online and offline vcpu  information of your VM with the following command (<strong>run it on your VM</strong>):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">lscpu | head</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="lscpu | head"><div></div></button></div></figure></div>
<p>To activate an offline cpu, first you have to know its number. cpu  numbering starts from 0, so if you had 2 vcpus and increased them by 1, the number for the 3rd vcpu will be 2. You need to edit the following file and change the 0 inside to 1:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo nano /sys/devices/system/cpu/cpu2/online</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo nano /sys/devices/system/cpu/cpu2/online"><div></div></button></div></figure></div>
<p>The number 2 after cpu means the cpu with number 2 i.e. 3rd cpu. When  you change the file, magically that vcpu will become online. For more vcpus, you have to change that file for each vcpu you added.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="59-snapshots">5.9. Snapshots</h3><a class="sl-anchor-link" href="#59-snapshots"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.9. Snapshots”</span></a></div>
<p>When you take a snapshot, current disk and memory state is saved.</p>
<p>Take a live snapshot</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-create-as VMNAME --name SNAPSHOTNAME --description DESCRIPTION</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-create-as ubuntu24 --name ss1-ubuntu24 --description "First Snapshot of Ubuntu24"</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh snapshot-create-as VMNAME --name SNAPSHOTNAME --description DESCRIPTIONvirsh snapshot-create-as ubuntu24 --name ss1-ubuntu24 --description &#x22;First Snapshot of Ubuntu24&#x22;"><div></div></button></div></figure></div>
<p>The snapshot becomes the current one and everything after is built onto  this snapshot. If you want to revert to that snapshot:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-revert VMNAME --current</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh snapshot-revert VMNAME --current"><div></div></button></div></figure></div>
<p>If you want to revert to a specific snapshot:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-revert VMNAME --snapshotname SNAPSHOTNAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh snapshot-revert VMNAME --snapshotname SNAPSHOTNAME"><div></div></button></div></figure></div>
<p>To see which snapshot is current:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-current VMNAME --name</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh snapshot-current VMNAME --name"><div></div></button></div></figure></div>
<p>To delete the current snapshot</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-delete VMNAME --current</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh snapshot-delete VMNAME --current"><div></div></button></div></figure></div>
<p>To delete a specific snapshot</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-delete VMNAME --snapshotname SNAPSHOTNAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh snapshot-delete VMNAME --snapshotname SNAPSHOTNAME"><div></div></button></div></figure></div>
<p>To list all snapshots of a VM</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh snapshot-list VMNAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh snapshot-list VMNAME"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="510-attach-another-disk-to-a-vm">5.10. Attach Another Disk to a VM</h3><a class="sl-anchor-link" href="#510-attach-another-disk-to-a-vm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.10. Attach Another Disk to a VM”</span></a></div>
<p>Suppose that, for our ubuntu24 VM, we need another disk of 20GB size.  Because, we need to keep some data on another disk.</p>
<p>We need to create a new image and attach it to the VM.</p>
<p>Create a 20GB image in qcow2 format:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create -f qcow2 /srv/kvm/ubuntu24-disk2.qcow2 20G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create -f qcow2 /srv/kvm/ubuntu24-disk2.qcow2 20G"><div></div></button></div></figure></div>
<p>Now our image is ready to be attached to our VM. Before attaching it to  the VM, we have to decide its name on the VM.</p>
<p>VM disks are named as vda, vdb, vdc … so on. We have to give it a name  that follows the last disk name. Because my ubuntu24 VM has only one  disk, name for the second one will be vdb. To see your disks on your VM, type the following command (On your VM):</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">lsblk -o name -d | grep vd</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="lsblk -o name -d | grep vd"><div></div></button></div></figure></div>
<p>Most probably you will only have vda, in that case you can use the name  vdb. Otherwise use a name just after the last disk name.</p>
<p>Add the new image as a second disk to my ubuntu24 VM:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh attach-disk ubuntu24 /srv/kvm/ubuntu24-disk2.qcow2 vdb --persistent</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh attach-disk ubuntu24 /srv/kvm/ubuntu24-disk2.qcow2 vdb --persistent"><div></div></button></div></figure></div>
<p>The disk is added persistently, that is it is added alive and it will be there after shutdown and and start. If you want to add the disk for the session only, you can change —persistent to —live. Also, if you want to  add the disk after shutdown and start you can change —persistent to —config.</p>
<p>Needless to say that, you are going to have to mount the new disk before  using it.</p>
<p>In any case, if you want to detach the added disk, solution is easy:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh detach-disk ubuntu24 vdb --persistent</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh detach-disk ubuntu24 vdb --persistent"><div></div></button></div></figure></div>
<p>As in virsh attach-disk, you can change —persistent option to —live or  —config.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="511-other-virsh-commands">5.11. Other virsh Commands</h3><a class="sl-anchor-link" href="#511-other-virsh-commands"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5.11. Other virsh Commands”</span></a></div>
<p>Get the list of all virsh subcommands:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh --help</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh --help"><div></div></button></div></figure></div>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="6-qemu-img-shell-based-image-management">6. qemu-img: Shell Based Image Management</h2><a class="sl-anchor-link" href="#6-qemu-img-shell-based-image-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6. qemu-img: Shell Based Image Management”</span></a></div>
<hr>
<p>qemu-img allows us to manipulate images. The command is expected to work  offline. That means, before you start using qemu-img, you have to shut  down the VM associated with it.</p>
<p><strong>Do not use qemu-img with an image of running VM</strong></p>
<p>A full documentation can be found at the below site:
<a href="https://www.qemu.org/docs/master/tools/qemu-img.html">www.qemu.org</a></p>
<div class="sl-heading-wrapper level-h3"><h3 id="61-get-basic-info-about-an-image">6.1. Get Basic Info About an Image</h3><a class="sl-anchor-link" href="#61-get-basic-info-about-an-image"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6.1. Get Basic Info About an Image”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">qemu-img info FILENAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="qemu-img info FILENAME"><div></div></button></div></figure></div>
<p>FILENAME is the name of the file which is the image for the VM.</p>
<p>For my ubuntu24 VM’s image info:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">qemu-img info /srv/kvm/ubuntusrv-cloudimg.qcow2</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="qemu-img info /srv/kvm/ubuntusrv-cloudimg.qcow2"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="62-creating-an-image">6.2. Creating an Image</h3><a class="sl-anchor-link" href="#62-creating-an-image"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6.2. Creating an Image”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">qemu-img create -f FORMAT FILENAME SIZE</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="qemu-img create -f FORMAT FILENAME SIZE"><div></div></button></div></figure></div>
<p>Remember, at 5.10. we created an empty disk image to add as another disk  to a VM:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create -f qcow2 /srv/kvm/ubuntu24-disk2.qcow2 20G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create -f qcow2 /srv/kvm/ubuntu24-disk2.qcow2 20G"><div></div></button></div></figure></div>
<p>An image also can be created by backing from another image. In that way, we will have another image from an image, differentiating its format and size:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create -b BACKINGFILENAME -F BACKINGFILEFORMAT \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">-f OUTPUTFILEFORMAT OUTPUTFILENAME SIZE</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create -b BACKINGFILENAME -F BACKINGFILEFORMAT \    -f OUTPUTFILEFORMAT OUTPUTFILENAME SIZE"><div></div></button></div></figure></div>
<p>Remember, at 4.2. we created a new cloud image from the cloud image we downloaded:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img create -b /srv/isos/focal-server-cloudimg-amd64.img \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">-F qcow2 -f qcow2 /srv/kvm/ubuntusrv-cloudimg.qcow2 20G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img create -b /srv/isos/focal-server-cloudimg-amd64.img \    -F qcow2 -f qcow2 /srv/kvm/ubuntusrv-cloudimg.qcow2 20G"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="63-changing-the-format-of-an-image">6.3. Changing the Format of an Image</h3><a class="sl-anchor-link" href="#63-changing-the-format-of-an-image"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6.3. Changing the Format of an Image”</span></a></div>
<p>There are a lot of formats for images. For us, the 2 most important ones are raw and qcow2.</p>
<ul>
<li>raw   : As the name implies.</li>
<li>qcow2 : Feature rich, allows snapshots, compression and encrytion.</li>
<li>qcow  : Older version of qcow2.</li>
<li>dmg   : Mac format.</li>
<li>nbd   : Network block device, used to access remote storages</li>
<li>vdi   : Virtualbox format</li>
<li>vmdk  : VMW*re format</li>
<li>vhdx  : Micros*ft HyperV format</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">qemu-img convert -f SOURCEFORMAT -O DESTINATIONFORMAT SOURCEFILE DESTFILE</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="qemu-img convert -f SOURCEFORMAT -O DESTINATIONFORMAT SOURCEFILE DESTFILE"><div></div></button></div></figure></div>
<p>I have Virtualbox installed on my workstation (Ubuntu 24.04 LTS). There  is a Windows 10 installed on it for testing purposes. I’ll copy its image  (obviously in vdi format) to my server to /srv/kvm directory, convert it to qcow2 and run it on my server using KVM.</p>
<p>Copy Windows 10 image to the server<br>
<strong>Run on my workstation</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">scp windows10.vdi exforge@elma:/tmp</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="scp windows10.vdi exforge@elma:/tmp"><div></div></button></div></figure></div>
<p>On my server
Convert image to qcow2</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img convert -f vdi -O qcow2 /tmp/windows10.vdi \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/kvm/windows10.qcow2</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img convert -f vdi -O qcow2 /tmp/windows10.vdi \   /srv/kvm/windows10.qcow2"><div></div></button></div></figure></div>
<p>If we want to display the progress percentage while converting the image, add -p option.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img convert -p -f vdi -O qcow2 /tmp/windows10.vdi \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/srv/kvm/windows10.qcow2</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img convert -p -f vdi -O qcow2 /tmp/windows10.vdi \   /srv/kvm/windows10.qcow2"><div></div></button></div></figure></div>
<p>Now we can add it as a KVM image</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virt-install --name windows10 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--connect qemu:///system \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--virt-type kvm --memory 2048 --vcpus 2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--boot hd,menu=on \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--disk path=/srv/kvm/windows10.qcow2,device=disk \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--graphics vnc,port=5904,listen=0.0.0.0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--os-variant win10 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--network bridge=br0 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">--noautoconsole</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virt-install --name windows10 \  --connect qemu:///system \  --virt-type kvm --memory 2048 --vcpus 2 \  --boot hd,menu=on \  --disk path=/srv/kvm/windows10.qcow2,device=disk \  --graphics vnc,port=5904,listen=0.0.0.0 \  --os-variant win10 \  --network bridge=br0 \  --noautoconsole"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="64-resize-a-disk-image">6.4. Resize a Disk Image.</h3><a class="sl-anchor-link" href="#64-resize-a-disk-image"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6.4. Resize a Disk Image.”</span></a></div>
<p>If you need extra disk space for your VM, you can increase the size of the image file.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img resize FILENAME +SIZE</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img resize FILENAME +SIZE"><div></div></button></div></figure></div>
<p>Resize an image, FILENAME is the name of the file which is the image for the VM.</p>
<p>SIZE could be something like +10G. Image size will be increased by (not to) this amount. it is possible to shrink with -</p>
<p>You must use the parameter —shrink to shrink the image</p>
<p>You must use partitioning tools in the VM to resize the disk to shrinked  size before shrinking.</p>
<p>To increase the size of my ubuntu20 VM’s image by 5GB:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo qemu-img resize /srv/kvm/ubuntusrv-cloudimg.qcow2 +5G</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo qemu-img resize /srv/kvm/ubuntusrv-cloudimg.qcow2 +5G"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="65-check-an-image-for-errors">6.5. Check an Image For Errors</h3><a class="sl-anchor-link" href="#65-check-an-image-for-errors"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6.5. Check an Image For Errors”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">qemu-img check FILENAME</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="qemu-img check FILENAME"><div></div></button></div></figure></div>
<p>In any case if you suspect the integrity of the image file</p>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="7-export-and-import-of-vms">7. Export and Import of VMs</h2><a class="sl-anchor-link" href="#7-export-and-import-of-vms"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “7. Export and Import of VMs”</span></a></div>
<hr>
<p>If you want to move your VM to another host, or in a way you want to backup and restore your VM; there might be a lot of ways to do it. I’m  going to demonstrate a very simple  method which requires shutting down the VM (you can try while it is running, but with no success guaranteed).</p>
<div class="sl-heading-wrapper level-h3"><h3 id="71-export">7.1. Export</h3><a class="sl-anchor-link" href="#71-export"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “7.1. Export”</span></a></div>
<hr>
<p>First of all, let’s prepare a place for our backup files, /tmp/kvmbackup  would be fine.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">mkdir /tmp/kvmbackup</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="mkdir /tmp/kvmbackup"><div></div></button></div></figure></div>
<p>We need the definition file of our VM and the image file it is using. “virsh dumpxml” command creates the definition file in xml format, we can  save it with the VM’s name.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh dumpxml ubuntu24 > /tmp/kvmbackup/ubuntu24.xml</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh dumpxml ubuntu24 > /tmp/kvmbackup/ubuntu24.xml"><div></div></button></div></figure></div>
<p>This file contains all the necessary metadata information about our VM.</p>
<p>If our VM was installed from the scratch as in 2.1. there will be only 1 image file. But if it was installed from a cloud image as we did in 4. or if another disk was added as in 5.10; there would be more than 1 images.</p>
<p>We need to copy all the images.</p>
<p>Images used by the VM is listed in the xml file. Let’s find them:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">grep "source file" /tmp/kvmbackup/ubuntu24.xml</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="grep &#x22;source file&#x22; /tmp/kvmbackup/ubuntu24.xml"><div></div></button></div></figure></div>
<p>For my ubuntu24 VM, output is listed below:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">&#x3C;source file='/srv/kvm/ubuntu24-seed.qcow2'/></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">      </span></span><span style="--0:#d6deeb;--1:#403f53">&#x3C;source file='/srv/kvm/ubuntusrv-cloudimg.qcow2'/></span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="      <source file=&#x27;/srv/kvm/ubuntu24-seed.qcow2&#x27;/>      <source file=&#x27;/srv/kvm/ubuntusrv-cloudimg.qcow2&#x27;/>"><div></div></button></div></figure></div>
<p>That means I need to prepare 2 files: /srv/kvm/ubuntu24-seed.qcow2 and /srv/kvm/ubuntusrv-cloudimg.qcow2 .</p>
<p>Lets copy them to our backup locations.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">cp /srv/kvm/ubuntu24-seed.qcow2 /srv/kvm/ubuntusrv-cloudimg.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">   </span></span><span style="--0:#d6deeb;--1:#403f53">/tmp/kvmbackup</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="cp /srv/kvm/ubuntu24-seed.qcow2 /srv/kvm/ubuntusrv-cloudimg.qcow2 \   /tmp/kvmbackup"><div></div></button></div></figure></div>
<p><strong>Beware:</strong> You can copy the files while the VM is running, but it is  advised to shutdown (or at least suspend your VM) before copying. Continue at your own risk.</p>
<p>Let’s package them</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">tar -cf /tmp/ubuntu24.tar -C /tmp/kvmbackup .</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="tar -cf /tmp/ubuntu24.tar -C /tmp/kvmbackup ."><div></div></button></div></figure></div>
<p>Now we have /tmp/ubuntu24.tar, it has all the necessary data to import our VM anywhere.</p>
<p>You have to copy this file to another server, before importing there.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="72-import">7.2. Import</h3><a class="sl-anchor-link" href="#72-import"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “7.2. Import”</span></a></div>
<p>Assuming we have another virtualization server and we have copied  ubuntu20.tar there, we are going to import it and make it operational.</p>
<p><strong>Beware:</strong> Before importing your VM to another server, you have to remove it on the original server, otherwise you would have 2 guests with the same IP and that may cause unexpected (and unpleasant) results.</p>
<p>ubuntu24.tar is copied to the server’s /tmp directory as /tmp/ubuntu24.tar</p>
<p>Create a place for our import files</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">mkdir /tmp/import</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="mkdir /tmp/import"><div></div></button></div></figure></div>
<p>Extract tar file there</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">tar -xf /tmp/ubuntu24.tar -C /tmp/import</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="tar -xf /tmp/ubuntu24.tar -C /tmp/import"><div></div></button></div></figure></div>
<p>Now we need to move our image files to their directories as in the original server. If you have a different directory structure on your new server, and you want to copy files to different directories you have to  edit the xml file and change directories there.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo cp /tmp/import/ubuntu24-seed.qcow2 \</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">    </span></span><span style="--0:#d6deeb;--1:#403f53">/tmp/import/ubuntusrv-cloudimg.qcow2 /srv/kvm</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo cp /tmp/import/ubuntu24-seed.qcow2 \    /tmp/import/ubuntusrv-cloudimg.qcow2 /srv/kvm"><div></div></button></div></figure></div>
<p>It is time to define our server. Remember the xml file? We will use it  to define our ubuntu24 server.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh define /tmp/import/ubuntu24.xml</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh define /tmp/import/ubuntu24.xml"><div></div></button></div></figure></div>
<p>Now we can start it</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">virsh start ubuntu24</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="virsh start ubuntu24"><div></div></button></div></figure></div>
<br>
<div class="sl-heading-wrapper level-h2"><h2 id="8-libguestfs-vm-disk-management">8. libguestfs: VM Disk Management</h2><a class="sl-anchor-link" href="#8-libguestfs-vm-disk-management"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “8. libguestfs: VM Disk Management”</span></a></div>
<hr>
<p>A set of commands for managing VM disks. Full documentation:<br>
<a href="https://libguestfs.org/">libguestfs.org</a></p>
<p>Normally, as a system admin, you won’t need to reach to VM’s disks. But there may happen a need once in a while.</p>
<p>I think you already understand that when you have a VPS on a cloud server, the administrators of that cloud environment can reach your VPS’ data.</p>
<p>There are many tools, I’m going to try to explain only mounting commands.</p>
<div class="sl-heading-wrapper level-h3"><h3 id="81-installation">8.1. Installation</h3><a class="sl-anchor-link" href="#81-installation"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “8.1. Installation”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt update</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo apt-get --yes install libguestfs-tools</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo apt updatesudo apt-get --yes install libguestfs-tools"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="82-mounting-vms-disks">8.2. Mounting VM’s Disks</h3><a class="sl-anchor-link" href="#82-mounting-vms-disks"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “8.2. Mounting VM’s Disks”</span></a></div>
<p>Works online (While the VM is running) Mount my VMs disk on my host’s /mnt directory:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo guestmount -d ubuntu24 -i --ro /mnt</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo guestmount -d ubuntu24 -i --ro /mnt"><div></div></button></div></figure></div>
<p>/mnt directory holds all the files of my VM. If you remove —ro, you can mount it with write permissions. But be very careful.</p>
<p>Unmount it:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">sudo guestunmount /mnt</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="sudo guestunmount /mnt"><div></div></button></div></figure></div>
<p>I prefer mounting with readonly permissions just to be safe.</p>
<p>Details for guestmount and guestunmount commands:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">guestmount --help</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">guestunmount --help</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="guestmount --helpguestunmount --help"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="83-all-commands">8.3. All Commands</h3><a class="sl-anchor-link" href="#83-all-commands"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “8.3. All Commands”</span></a></div>
<p>guestfish(1) — interactive shell<br>
guestmount(1) — mount guest filesystem in host<br>
guestunmount(1) — unmount guest filesystem<br>
virt-alignment-scan(1) — check alignment of virtual machine partitions<br>
virt-builder(1) — quick image builder<br>
virt-builder-repository(1) — create virt-builder repositories<br>
virt-cat(1) — display a file<br>
virt-copy-in(1) — copy files and directories into a VM<br>
virt-copy-out(1) — copy files and directories out of a VM<br>
virt-customize(1) — customize virtual machines<br>
virt-df(1) — free space<br>
virt-dib(1) — safe diskimage-builder<br>
virt-diff(1) — differences<br>
virt-edit(1) — edit a file<br>
virt-filesystems(1) — display information about filesystems, devices, LVM<br>
virt-format(1) — erase and make blank disks<br>
virt-get-kernel(1) — get kernel from disk<br>
virt-inspector(1) — inspect VM images<br>
virt-list-filesystems(1) — list filesystems<br>
virt-list-partitions(1) — list partitions<br>
virt-log(1) — display log files<br>
virt-ls(1) — list files<br>
virt-make-fs(1) — make a filesystem<br>
virt-p2v(1) — convert physical machine to run on KVM<br>
virt-p2v-make-disk(1) — make P2V ISO<br>
virt-p2v-make-kickstart(1) — make P2V kickstart<br>
virt-rescue(1) — rescue shell<br>
virt-resize(1) — resize virtual machines<br>
virt-sparsify(1) — make virtual machines sparse (thin-provisioned)<br>
virt-sysprep(1) — unconfigure a virtual machine before cloning<br>
virt-tail(1) — follow log file<br>
virt-tar(1) — archive and upload files<br>
virt-tar-in(1) — archive and upload files<br>
virt-tar-out(1) — archive and download files</p>
<br> </div> <footer class="sl-flex astro-3yyafb3n"> <div class="meta sl-flex astro-3yyafb3n">   </div> <div class="pagination-links print:hidden astro-u2l5gyhi" dir="ltr">   </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>